# TaskMate ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆå®Œå…¨ä¿®æ­£ç‰ˆï¼‰

**æœ€çµ‚æ›´æ–°**: 2026-02-13ï¼ˆå†æ¤œè¨¼å®Œäº†ï¼‰
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.2
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æœ¬ç•ªé‹ç”¨ä¸­ + AIç›¸è«‡æ©Ÿèƒ½é–‹ç™ºä¸­
**æ¤œè¨¼æ—¥**: 2026-02-13ï¼ˆã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å®Œå…¨ç…§åˆ + å®Ÿè£…è©³ç´°ç¢ºèªï¼‰

---

## âš ï¸ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: â˜…â˜…â˜…â˜…â˜…

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã¨**2å›ã®å¾¹åº•æ¤œè¨¼**ã‚’çµŒã¦å®Œå…¨ç…§åˆæ¸ˆã¿ã§ã™ã€‚

### æ¤œè¨¼æ¸ˆã¿é …ç›®ï¼ˆå®Ÿæ¸¬å€¤ï¼‰
- âœ… ã‚·ã‚¹ãƒ†ãƒ æ•°: å®Ÿéš›ã®IDç¢ºèªï¼ˆ39ã‚·ã‚¹ãƒ†ãƒ ã€ID 15æ¬ ç•ªï¼‰
- âœ… ç’°å¢ƒå¤‰æ•°: grepå…¨æ¤œç´¢ï¼ˆ44å€‹ï¼‰
- âœ… APIæ•°: route.tsã‚«ã‚¦ãƒ³ãƒˆï¼ˆ23å€‹ï¼‰
- âœ… Netlify Functions: ãƒ•ã‚¡ã‚¤ãƒ«ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ32å€‹ï¼‰
- âœ… ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸: package.jsonå®Ÿç‰©
- âœ… ã‚µã‚¤ã‚º: duå®Ÿæ¸¬ï¼ˆ678MB/312MBï¼‰
- âœ… è¨­å®šå€¤: config.tså®Ÿç‰©
- âœ… Rediså®Ÿè£…: ã‚³ãƒ¼ãƒ‰ç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³å®Ÿè£…ã€ç’°å¢ƒå¤‰æ•°ã§æœ‰åŠ¹åŒ–ï¼‰
- âœ… SendGrid: grepæ¤œç´¢ï¼ˆã‚³ãƒ¼ãƒ‰å†…æœªä½¿ç”¨ã€å‰Šé™¤æ¨å¥¨ï¼‰

### ä¿®æ­£å±¥æ­´
- **v2.1**: åˆå›å¾¹åº•æ¤œè¨¼ã€42â†’39ã‚·ã‚¹ãƒ†ãƒ ä¿®æ­£ã€ç’°å¢ƒå¤‰æ•°44å€‹è¿½åŠ 
- **v2.2**: å†æ¤œè¨¼ã€Rediså®Ÿè£…çŠ¶æ³æ˜ç¢ºåŒ–ã€.nextã‚µã‚¤ã‚ºæ³¨è¨˜ã€SendGridå‰Šé™¤æ¨å¥¨æ˜è¨˜

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“å›³](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“å›³)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
4. [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ](#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
6. [APIè¨­è¨ˆ](#apiè¨­è¨ˆ)
7. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
8. [ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ](#ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ)
9. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
10. [ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£](#ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£)
11. [ç›£è¦–ãƒ»ãƒ­ã‚°](#ç›£è¦–ãƒ­ã‚°)
12. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥)
13. [ã‚³ã‚¹ãƒˆæ§‹é€ ](#ã‚³ã‚¹ãƒˆæ§‹é€ )
14. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š)
15. [ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](#ãƒ†ã‚¹ãƒˆæˆ¦ç•¥)

---

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ãƒ“ã‚¸ãƒã‚¹ç›®çš„

TaskMateï¼ˆæ­£å¼å: gas-generatorï¼‰ã¯ã€ä¸­å°ä¼æ¥­å‘ã‘ã®Google Apps Scriptï¼ˆGASï¼‰è‡ªå‹•åŒ–ã‚³ãƒ¼ãƒ‰ç”ŸæˆSaaSãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€‚LINE Botã‚’é€šã˜ã¦AIãŒãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ã‚»ã‚¹ã®è‡ªå‹•åŒ–ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€**39ç¨®é¡**ã®æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã™ã‚‹ã€‚

### ä¸»è¦æ©Ÿèƒ½

| æ©Ÿèƒ½ | èª¬æ˜ | å„ªå…ˆåº¦ |
|------|------|--------|
| **LINE Bot GASç”Ÿæˆ** | Claude Sonnet 4ã§GASã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆ | æœ€é«˜ |
| **ã‚·ã‚¹ãƒ†ãƒ ã‚«ã‚¿ãƒ­ã‚°** | 39ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | é«˜ |
| **RAGã‚·ã‚¹ãƒ†ãƒ ** | ã‚·ã‚¹ãƒ†ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ã®è‡ªå‹•Q&A | é«˜ |
| **Stripeæ±ºæ¸ˆ** | ã‚µãƒ–ã‚¹ã‚¯èª²é‡‘ãƒ»å˜ç™ºè³¼å…¥ | é«˜ |
| **ãƒ‰ãƒªãƒƒãƒ—ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³** | 7æ—¥é–“ã‚¹ãƒ†ãƒƒãƒ—é…ä¿¡ | ä¸­ |
| **ä»£ç†åº—ç®¡ç†** | ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒªãƒ³ã‚¯ãƒ»æˆæœå ±é…¬ | ä¸­ |
| **AIç›¸è«‡æ©Ÿèƒ½** | ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ï¼ˆé–‹ç™ºä¸­ï¼‰ | ä¸­ |
| **ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ç›¸è«‡** | LINEçµŒç”±ã§ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚°ãƒ«ãƒ¼ãƒ—ã¸è»¢é€ | ä¸­ |

### ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ—ãƒ©ãƒ³          â”‚ æœˆé¡     â”‚ å¥‘ç´„æœŸé–“ â”‚ æ©Ÿèƒ½                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç„¡æ–™ä¼šå“¡        â”‚ Â¥0       â”‚ -        â”‚ åŸºæœ¬Q&Aã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â”‚
â”‚ ãƒ™ãƒ¼ã‚·ãƒƒã‚¯      â”‚ Â¥10,000  â”‚ 6ãƒ¶æœˆ    â”‚ 3ã‚·ã‚¹ãƒ†ãƒ ã€æœˆ1DL    â”‚
â”‚ ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«â”‚ Â¥50,000 â”‚ 6ãƒ¶æœˆ    â”‚ å…¨ã‚·ã‚¹ãƒ†ãƒ ã€æœˆ5DL   â”‚
â”‚ å˜ç™ºè³¼å…¥        â”‚ å€‹åˆ¥     â”‚ -        â”‚ ã‚·ã‚¹ãƒ†ãƒ æ°¸ä¹…åˆ©ç”¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 39ã‚·ã‚¹ãƒ†ãƒ ä¸€è¦§ï¼ˆå®Ÿæ¸¬ï¼‰

**æ³¨**: ID 15ã€ŒWebã‚¢ãƒ—ãƒªé–‹ç™ºãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã€ã¯å‰Šé™¤æ¸ˆã¿ï¼ˆCLAUDE.mdè¨˜è¼‰ï¼‰

| IDç¯„å›² | ã‚·ã‚¹ãƒ†ãƒ æ•° | ã‚«ãƒ†ã‚´ãƒª |
|--------|-----------|---------|
| 01-14 | 14ã‚·ã‚¹ãƒ†ãƒ  | å–¶æ¥­ãƒ»é¡§å®¢ç®¡ç†ã€æœŸé™ç®¡ç†ã€åˆ†æ |
| **15** | **æ¬ ç•ª** | **å‰Šé™¤æ¸ˆã¿** |
| 16-26 | 11ã‚·ã‚¹ãƒ†ãƒ  | çµŒè²»ç²¾ç®—ã€è«‹æ±‚æ›¸ã€å£²ä¸Šã€å¥‘ç´„ |
| 27-40 | 14ã‚·ã‚¹ãƒ†ãƒ  | å¼•ç¶™ãã€å®šå‹é€£çµ¡ã€è§£ç´„åˆ†æç­‰ |
| **åˆè¨ˆ** | **39ã‚·ã‚¹ãƒ†ãƒ ** |

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LINE App       â”‚  Web Browser      â”‚  Admin Dashboard          â”‚
â”‚  (Mobile/Desktop)â”‚  (LP + Catalog)   â”‚  (ç®¡ç†ç”»é¢)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                       â”‚
         â”‚ Webhook          â”‚ HTTPS                 â”‚ HTTPS
         â”‚                  â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APPLICATION LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Next.js 14 (App Router)                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ LINE Bot   â”‚ Web App    â”‚ RAG System â”‚ AI Consult   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Webhook    â”‚ Pages      â”‚ Q&A        â”‚ Recommend    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Stripe     â”‚ Drip       â”‚ Agency     â”‚ Admin        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Payment    â”‚ Campaign   â”‚ Tracking   â”‚ Management   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                      â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUSINESS LOGIC â”‚  â”‚  EXTERNAL APIs  â”‚  â”‚  DATA LAYER         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ AIProvider    â”‚  â”‚ â€¢ Claude Sonnet â”‚  â”‚ Supabase PostgreSQL â”‚
â”‚   Manager       â”‚  â”‚   4 (primary)   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â€¢ RAG Service   â”‚  â”‚ â€¢ Gemini 3 Pro  â”‚  â”‚ â”‚ â€¢ users         â”‚ â”‚
â”‚ â€¢ Conversation  â”‚  â”‚   (fallback)    â”‚  â”‚ â”‚ â€¢ conversations â”‚ â”‚
â”‚   Manager       â”‚  â”‚ â€¢ LINE API      â”‚  â”‚ â”‚ â€¢ sessions      â”‚ â”‚
â”‚ â€¢ Premium Check â”‚  â”‚ â€¢ Stripe API    â”‚  â”‚ â”‚ â€¢ subscriptions â”‚ â”‚
â”‚ â€¢ Code Gen      â”‚  â”‚                 â”‚  â”‚ â”‚ â€¢ systems       â”‚ â”‚
â”‚ â€¢ Session Mgmt  â”‚  â”‚                 â”‚  â”‚ â”‚ â€¢ embeddings    â”‚ â”‚
â”‚ â€¢ Drip Service  â”‚  â”‚                 â”‚  â”‚ â”‚ â€¢ stripe_events â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â€¢ drip_logs     â”‚ â”‚
                                           â”‚ â”‚ â€¢ agencies      â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  CACHE LAYER     â”‚  â”‚  STATIC ASSETS  â”‚ â”‚ â€¢ pgvector (RAG)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â€¢ Row Level Sec   â”‚
â”‚ Redis (optional) â”‚  â”‚ Netlify CDN     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ or Memory Store  â”‚  â”‚ â€¢ LP (HTML)     â”‚
â”‚ â€»ç’°å¢ƒå¤‰æ•°ã§åˆ‡æ›¿ â”‚  â”‚ â€¢ Agency Portal â”‚
â”‚ â€¢ Session Cache  â”‚  â”‚ â€¢ 32 Functions  â”‚
â”‚ â€¢ Rate Limit     â”‚  â”‚   (JS)          â”‚
â”‚ â€¢ TTL: 30min     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” | å‚™è€ƒ |
|------|-----------|------|------|
| **Next.js** | 14.2.35 | ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆApp Routerï¼‰ | - |
| **React** | 18.3.1 | UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª | - |
| **TypeScript** | 5.7.3 | å‹å®‰å…¨æ€§ | - |
| **Tailwind CSS** | 3.4.14 | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ï¼ˆNeumorphic Soft UIï¼‰ | - |
| **Three.js** | 0.182.0 | LPãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«èƒŒæ™¯ | - |

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆå®Ÿæ¸¬ package.jsonï¼‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” | å‚™è€ƒ |
|------|-----------|------|------|
| **Node.js** | 18.17.0 | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  | RenderæŒ‡å®š |
| **@anthropic-ai/sdk** | 0.24.3 | Claude 4 API | ãƒ—ãƒ©ã‚¤ãƒãƒªAI |
| **è‡ªå‰Gemini Client** | - | Gemini 3 Pro API | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€RESTç›´æ¥ |
| **@line/bot-sdk** | 7.5.2 | LINE Messaging API | - |
| **stripe** | 14.10.0 | æ±ºæ¸ˆå‡¦ç† | - |
| **@supabase/supabase-js** | 2.43.5 | DBæ“ä½œ | - |
| **ioredis** | 5.3.2 | Redis ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ç’°å¢ƒå¤‰æ•°ã§æœ‰åŠ¹åŒ– |
| **@sendgrid/mail** | 8.1.6 | ãƒ¡ãƒ¼ãƒ«é€ä¿¡ | **æœªä½¿ç”¨ï¼ˆå‰Šé™¤æ¨å¥¨ï¼‰** |
| **qrcode** | 1.5.3 | QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ | å…±æœ‰ãƒªãƒ³ã‚¯ç”¨ |
| **zod** | 3.23.8 | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | - |
| **bcryptjs** | 3.0.2 | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ | - |
| **jsonwebtoken** | 9.0.2 | JWTç”Ÿæˆ | - |
| **nanoid** | 5.1.5 | çŸ­ç¸®URLç”Ÿæˆ | - |

**é‡è¦**:
- `@google/generative-ai` ã¯æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚`lib/gemini/client.ts` ã§è‡ªå‰å®Ÿè£…ã€‚
- `@sendgrid/mail` ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã ãŒ**ã‚³ãƒ¼ãƒ‰å†…ã§ä¸€åˆ‡ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„**ï¼ˆå‰Šé™¤æ¨å¥¨ï¼‰ã€‚

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

| æŠ€è¡“ | ç”¨é€” | ãƒ—ãƒ©ãƒ³ |
|------|------|--------|
| **Supabase PostgreSQL** | ãƒ¡ã‚¤ãƒ³DBï¼ˆTokyo ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ | Free/Pro |
| **pgvector** | ãƒ™ã‚¯ãƒˆãƒ«é¡ä¼¼åº¦æ¤œç´¢ï¼ˆRAGï¼‰ | æ‹¡å¼µæ©Ÿèƒ½ |
| **Redis** | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | **ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆç’°å¢ƒå¤‰æ•°ã§æœ‰åŠ¹åŒ–ï¼‰** |

### ã‚¤ãƒ³ãƒ•ãƒ©

| ã‚µãƒ¼ãƒ“ã‚¹ | ç”¨é€” | ãƒ—ãƒ©ãƒ³ | å®Ÿæ¸¬å€¤ |
|---------|------|--------|--------|
| **Render** | ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | Standard (2GB RAM) | node: 678MB, .next: 312MB |
| **Netlify** | LP + ä»£ç†åº—ãƒãƒ¼ã‚¿ãƒ« + Functions | ç„¡æ–™ | 32 Functions |
| **GitHub** | ã‚³ãƒ¼ãƒ‰ç®¡ç† | Privateï¼ˆIKEMENLTD orgï¼‰ | 336ã‚³ãƒŸãƒƒãƒˆ |

### é–‹ç™ºãƒ„ãƒ¼ãƒ«

- **ESLint** 8.57.0 + **TypeScript**: ã‚³ãƒ¼ãƒ‰å“è³ª
- **Git**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆIKEMENLTD/gasgeneratorï¼‰
- **Claude Code**: AIé–‹ç™ºæ”¯æ´ï¼ˆã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆï¼‰

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚ºï¼ˆå®Ÿæ¸¬ 2026-02-13ã€é–‹ç™ºç’°å¢ƒï¼‰

```bash
Total: 1.1GB
â”œâ”€â”€ node_modules/   678MB  â† å®Ÿæ¸¬ï¼ˆpackage.json: 16 dependencies + 4 devDependenciesï¼‰
â”œâ”€â”€ .next/          312MB  â† ãƒ“ãƒ«ãƒ‰æˆæœç‰©ï¼ˆé–‹ç™ºç’°å¢ƒï¼‰
â”‚   â”œâ”€â”€ cache/      307MB     â€»é–‹ç™ºç’°å¢ƒã‚­ãƒ£ãƒƒã‚·ãƒ¥è“„ç©
â”‚   â”œâ”€â”€ static/     1.2MB
â”‚   â””â”€â”€ server/     3.2MB
â”‚   â€»æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã§ã¯50-100MBç¨‹åº¦ï¼ˆcacheã‚¯ãƒªãƒ¼ãƒ³å¾Œï¼‰
â”œâ”€â”€ app/            ~50MB  â† ã‚¢ãƒ—ãƒªã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ lib/            ~30MB  â† ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ public/         ~20MB  â† é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆLP 5814è¡Œå«ã‚€ï¼‰
â””â”€â”€ ãã®ä»–          ~30MB
```

**æ³¨æ„**: .nextã®312MBã¯é–‹ç™ºç’°å¢ƒã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥è“„ç©ã‚’å«ã‚€ã€‚æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã§ã¯é€šå¸¸50-100MBç¨‹åº¦ã€‚

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRESENTATION LAYER (app/)                                  â”‚
â”‚  â€¢ Pages (Next.js App Router)                               â”‚
â”‚  â€¢ API Routes (/api/*) - 23ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                    â”‚
â”‚  â€¢ React Components (components/)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APPLICATION LAYER (lib/)                                   â”‚
â”‚  â€¢ Business Logic                                           â”‚
â”‚  â€¢ Use Cases (actions/)                                     â”‚
â”‚  â€¢ Service Orchestration                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOMAIN LAYER (lib/)                                        â”‚
â”‚  â€¢ AIProviderManager (ai/provider.ts) - æœ€é‡è¦              â”‚
â”‚  â€¢ RAGService (rag/qa-service.ts)                           â”‚
â”‚  â€¢ ConversationManager (conversation/manager.ts)            â”‚
â”‚  â€¢ DripService (drip/drip-service.ts)                       â”‚
â”‚  â€¢ PremiumChecker (premium/)                                â”‚
â”‚  â€¢ CodeGenerator (code/generator.ts)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INFRASTRUCTURE LAYER (lib/)                                â”‚
â”‚  â€¢ Supabase Client (supabase/client.ts)                     â”‚
â”‚  â€¢ Cache (cache/)                                           â”‚
â”‚    - CacheStrategy (ãƒ¡ãƒ¢ãƒªãƒ™ãƒ¼ã‚¹ã€å¸¸æ™‚ç¨¼åƒ)                 â”‚
â”‚    - Redis Client (lib/rate-limit.tsã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³)           â”‚
â”‚      â€»REDIS_URLç’°å¢ƒå¤‰æ•°ã§æœ‰åŠ¹åŒ–                            â”‚
â”‚      â€»æœªè¨­å®šæ™‚ã¯ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¢ã§å‹•ä½œ                          â”‚
â”‚  â€¢ External API Clients                                     â”‚
â”‚    - ClaudeApiClient (claude/client.ts)                     â”‚
â”‚    - GeminiApiClient (gemini/client.ts) - è‡ªå‰å®Ÿè£…          â”‚
â”‚    - LINE Client (line/client.ts)                           â”‚
â”‚    - Stripe SDK                                             â”‚
â”‚  â€¢ Logger (utils/logger.ts)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆå®Œå…¨ç‰ˆï¼‰

```
gas-generator/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                      # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ23å€‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ webhook/              # LINE Webhookï¼ˆæœ€é‡è¦ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ route.ts          # 1500è¡Œã€å…¨æ©Ÿèƒ½ã®å…¥å£
â”‚   â”‚   â”œâ”€â”€ stripe/webhook/       # Stripe Webhookï¼ˆ430è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ rag/query/            # RAG Q&A
â”‚   â”‚   â”œâ”€â”€ system-recommendation/# AIç›¸è«‡ï¼ˆé–‹ç™ºä¸­ï¼‰
â”‚   â”‚   â”œâ”€â”€ admin/                # ç®¡ç†è€…APIï¼ˆ5ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”‚   â”œâ”€â”€ premium/
â”‚   â”‚   â”‚   â”œâ”€â”€ sessions/
â”‚   â”‚   â”‚   â”œâ”€â”€ tracking-links/
â”‚   â”‚   â”‚   â””â”€â”€ vision-stats/
â”‚   â”‚   â”œâ”€â”€ cron/                 # å®šæœŸå®Ÿè¡Œï¼ˆ4ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ cleanup/
â”‚   â”‚   â”‚   â”œâ”€â”€ drip/             # ãƒ‰ãƒªãƒƒãƒ—é…ä¿¡
â”‚   â”‚   â”‚   â””â”€â”€ process-queue/
â”‚   â”‚   â”œâ”€â”€ subscription/         # ã‚µãƒ–ã‚¹ã‚¯ç®¡ç†ï¼ˆ3ï¼‰
â”‚   â”‚   â”œâ”€â”€ share/                # ã‚·ã‚¹ãƒ†ãƒ å…±æœ‰ï¼ˆ2ï¼‰
â”‚   â”‚   â”œâ”€â”€ systems/              # ã‚«ã‚¿ãƒ­ã‚°API
â”‚   â”‚   â”œâ”€â”€ demo-proxy/           # iframeãƒ—ãƒ­ã‚­ã‚·
â”‚   â”‚   â”œâ”€â”€ health/               # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ debug/                # ãƒ‡ãƒãƒƒã‚°ï¼ˆ3ï¼‰
â”‚   â”œâ”€â”€ systems/catalog/          # ã‚·ã‚¹ãƒ†ãƒ ã‚«ã‚¿ãƒ­ã‚°ãƒšãƒ¼ã‚¸
â”‚   â”‚   â””â”€â”€ page.tsx              # 39ã‚·ã‚¹ãƒ†ãƒ å®šç¾©ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼‰
â”‚   â”œâ”€â”€ demo/                     # ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ admin/                    # ç®¡ç†ç”»é¢
â”‚   â”œâ”€â”€ styles/                   # ã‚°ãƒ­ãƒ¼ãƒãƒ«CSS
â”‚   â”‚   â”œâ”€â”€ lp.css                # LPå°‚ç”¨
â”‚   â”‚   â””â”€â”€ part3.css             # ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
â”‚   â””â”€â”€ page.tsx                  # ãƒ›ãƒ¼ãƒ ï¼ˆLPé…ä¿¡ï¼‰
â”‚
â”œâ”€â”€ lib/                          # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ30+ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
â”‚   â”œâ”€â”€ ai/                       # AIå‡¦ç†
â”‚   â”‚   â”œâ”€â”€ provider.ts           # AIProviderManagerï¼ˆæœ€é‡è¦ã€250è¡Œï¼‰
â”‚   â”‚   â””â”€â”€ recommendation-prompt.ts # AIç›¸è«‡ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆé–‹ç™ºä¸­ï¼‰
â”‚   â”œâ”€â”€ claude/                   # Claude API
â”‚   â”‚   â””â”€â”€ client.ts             # ClaudeApiClient
â”‚   â”œâ”€â”€ gemini/                   # Gemini APIï¼ˆè‡ªå‰å®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ client.ts             # GeminiApiClientï¼ˆRESTç›´æ¥ï¼‰
â”‚   â”œâ”€â”€ rag/                      # RAGã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”‚   â”œâ”€â”€ embedding-service.ts  # ãƒ™ã‚¯ãƒˆãƒ«åŒ–ï¼ˆOpenAI embeddingsï¼‰
â”‚   â”‚   â”œâ”€â”€ qa-service.ts         # QAå‡¦ç†ï¼ˆClaudeï¼‰
â”‚   â”‚   â””â”€â”€ keyword-search.ts     # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
â”‚   â”œâ”€â”€ supabase/                 # DBæ“ä½œ
â”‚   â”‚   â”œâ”€â”€ client.ts             # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
â”‚   â”‚   â”œâ”€â”€ types.ts              # å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ queries.ts            # æ±ç”¨ã‚¯ã‚¨ãƒª
â”‚   â”‚   â””â”€â”€ subscription-queries.ts # ã‚µãƒ–ã‚¹ã‚¯ã‚¯ã‚¨ãƒª
â”‚   â”œâ”€â”€ line/                     # LINE Bot
â”‚   â”‚   â”œâ”€â”€ client.ts             # LINEã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ message-templates.ts  # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ conversation/             # ä¼šè©±ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ manager.ts            # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆæœ€å¤§20ã€30åˆ†TTLï¼‰
â”‚   â”‚   â””â”€â”€ memory.ts             # ä¼šè©±ãƒ¡ãƒ¢ãƒª
â”‚   â”œâ”€â”€ code/                     # ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ generator.ts          # GASç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ file-generator.ts     # ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ï¼ˆGoogle Driveçµ±åˆäºˆå®šï¼‰
â”‚   â”œâ”€â”€ drip/                     # ãƒ‰ãƒªãƒƒãƒ—ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³
â”‚   â”‚   â”œâ”€â”€ drip-messages.ts      # 7æ—¥é–“ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
â”‚   â”‚   â””â”€â”€ drip-service.ts       # é…ä¿¡ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ premium/                  # ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒã‚§ãƒƒã‚¯
â”‚   â”œâ”€â”€ systems/                  # ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†
â”‚   â”‚   â””â”€â”€ system-data.ts        # ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—
â”‚   â”œâ”€â”€ cache/                    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆé‡è¦ï¼‰
â”‚   â”‚   â”œâ”€â”€ cache-strategy.ts     # ãƒ¡ãƒ¢ãƒªãƒ™ãƒ¼ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆå¸¸æ™‚ç¨¼åƒï¼‰
â”‚   â”‚   â””â”€â”€ conversation-cache.ts # ä¼šè©±ã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”‚   â”œâ”€â”€ rate-limit.ts             # Rate Limitingï¼ˆRedis or Memoryï¼‰
â”‚   â”œâ”€â”€ auth/                     # èªè¨¼
â”‚   â”œâ”€â”€ constants/                # å®šæ•°
â”‚   â”‚   â””â”€â”€ config.ts             # å…¨è¨­å®šï¼ˆ104è¡Œã€æœ€é‡è¦ï¼‰
â”‚   â””â”€â”€ utils/                    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â””â”€â”€ logger.ts             # ãƒ­ã‚®ãƒ³ã‚°
â”‚
â”œâ”€â”€ components/                   # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ layout/                   # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ admin/                    # ç®¡ç†ç”»é¢
â”‚   â”œâ”€â”€ AIConsultationChat.tsx    # AIç›¸è«‡UIï¼ˆé–‹ç™ºä¸­ï¼‰
â”‚   â””â”€â”€ RecommendationResult.tsx  # æ¨è–¦çµæœï¼ˆé–‹ç™ºä¸­ï¼‰
â”‚
â”œâ”€â”€ public/                       # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ lp-page.html              # ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ï¼ˆ5814è¡Œï¼‰
â”‚   â”œâ”€â”€ agency/                   # ä»£ç†åº—ç®¡ç†ç”»é¢
â”‚   â””â”€â”€ demos/                    # ãƒ‡ãƒ¢HTMLï¼ˆ4ä»¶ï¼‰
â”‚
â”œâ”€â”€ netlify-tracking/             # ä»£ç†åº—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ netlify/functions/        # Netlify Functionsï¼ˆ32å€‹ã€JSï¼‰
â”‚   â”‚   â”œâ”€â”€ line-webhook.js       # LINEé€£æº
â”‚   â”‚   â”œâ”€â”€ agency-billing-stats.js # è«‹æ±‚ãƒ‡ãƒ¼ã‚¿
â”‚   â”‚   â”œâ”€â”€ track-visit.js        # è¨ªå•è¿½è·¡
â”‚   â”‚   â””â”€â”€ ...                   # ãã®ä»–29 Functions
â”‚   â”œâ”€â”€ frontend/                 # é™çš„ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆgitç®¡ç†å¤–ï¼‰
â”‚   â””â”€â”€ netlify.toml              # Netlifyè¨­å®š
â”‚
â”œâ”€â”€ migrations/                   # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ6ä»¶ï¼‰
â”‚   â”œâ”€â”€ 001_subscription_and_rag_tables.sql
â”‚   â”œâ”€â”€ 002_stripe_tables.sql
â”‚   â”œâ”€â”€ 005_drip_campaign.sql
â”‚   â”œâ”€â”€ 006_agency_conversions_extend.sql
â”‚   â””â”€â”€ 007_consultation_history.sqlï¼ˆé–‹ç™ºä¸­ï¼‰
â”‚
â”œâ”€â”€ types/                        # å‹å®šç¾©
â”‚   â”œâ”€â”€ qrcode.d.ts               # QRã‚³ãƒ¼ãƒ‰å‹
â”‚   â””â”€â”€ claude.d.ts               # Claude APIå‹
â”‚
â”œâ”€â”€ CLAUDE.md                     # é–‹ç™ºãƒ­ã‚°ï¼ˆ2530è¡Œï¼‰
â”œâ”€â”€ ARCHITECTURE.md               # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ package.json                  # ä¾å­˜é–¢ä¿‚ï¼ˆ20ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰
â”œâ”€â”€ tsconfig.json                 # TypeScriptè¨­å®š
â””â”€â”€ next.config.js                # Next.jsè¨­å®š
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. LINE Bot GASã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LINE Userâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ 1. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆãƒ†ã‚­ã‚¹ãƒˆ or ç”»åƒï¼‰
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/webhook (LINE Webhook)            â”‚
â”‚ â€¢ ç½²åæ¤œè¨¼ï¼ˆHMAC-SHA256ï¼‰               â”‚
â”‚ â€¢ ã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥åˆ¤å®šï¼ˆmessage/follow/etcï¼‰â”‚
â”‚ â€¢ 3ç§’ä»¥å†…ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¿…é ˆï¼ˆLINEåˆ¶é™ï¼‰      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â†’ 2a. ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
     â”‚   â–¼
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ ConversationManager             â”‚
     â”‚   â”‚ â€¢ ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—/ä½œæˆ            â”‚
     â”‚   â”‚ â€¢ ä¼šè©±å±¥æ­´ãƒ­ãƒ¼ãƒ‰ï¼ˆæœ€å¤§20ä»¶ï¼‰     â”‚
     â”‚   â”‚ â€¢ ã‚­ãƒ£ãƒƒã‚·ãƒ¥: ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¢       â”‚
     â”‚   â”‚   (Redisã‚ªãƒ—ã‚·ãƒ§ãƒ³)             â”‚
     â”‚   â”‚ â€¢ 30åˆ†TTL                       â”‚
     â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â–¼
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ AIProviderManager               â”‚
     â”‚   â”‚ â€¢ Primary: Claude Sonnet 4      â”‚
     â”‚   â”‚   Model: claude-sonnet-4-20250514â”‚
     â”‚   â”‚   Timeout: 45ç§’                 â”‚
     â”‚   â”‚   Max Tokens: 32K               â”‚
     â”‚   â”‚ â€¢ Fallback: Gemini 3 Pro        â”‚
     â”‚   â”‚   Model: gemini-3-pro-preview   â”‚
     â”‚   â”‚   1å›å¤±æ•—ã§å³åˆ‡ã‚Šæ›¿ãˆ            â”‚
     â”‚   â”‚ â€¢ GASã‚³ãƒ¼ãƒ‰ç”Ÿæˆ                 â”‚
     â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â–¼
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ CodeGenerator                   â”‚
     â”‚   â”‚ â€¢ ã‚³ãƒ¼ãƒ‰æ¤œè¨¼ï¼ˆsyntax checkï¼‰     â”‚
     â”‚   â”‚ â€¢ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLæŠ½å‡º        â”‚
     â”‚   â”‚ â€¢ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆæœ€å¤§5ä»¶ï¼‰          â”‚
     â”‚   â”‚   â€»ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¢ä½¿ç”¨             â”‚
     â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â–¼
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ Supabase                        â”‚
     â”‚   â”‚ â€¢ conversations ãƒ†ãƒ¼ãƒ–ãƒ«ä¿å­˜     â”‚
     â”‚   â”‚ â€¢ sessions ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°          â”‚
     â”‚   â”‚ â€¢ ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡è¨˜éŒ²             â”‚
     â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â–¼
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ LINE Reply Message              â”‚
     â”‚   â”‚ â€¢ GASã‚³ãƒ¼ãƒ‰é€ä¿¡                  â”‚
     â”‚   â”‚ â€¢ QuickReplyï¼ˆã‚·ã‚¹ãƒ†ãƒ ä¸€è¦§ç­‰ï¼‰   â”‚
     â”‚   â”‚ â€¢ Rate Limit: 20/æ™‚é–“ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰â”‚
     â”‚   â”‚   â€»ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¢ã¾ãŸã¯Redis      â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â†’ 2b. ç”»åƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚¨ãƒ©ãƒ¼è¨ºæ–­ï¼‰
         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ LINE Content API                â”‚
         â”‚ â€¢ ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆ10MBåˆ¶é™ï¼‰   â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Claude Vision API               â”‚
         â”‚ â€¢ ã‚¨ãƒ©ãƒ¼ç”»åƒåˆ†æ                 â”‚
         â”‚ â€¢ ä¿®æ­£ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ                 â”‚
         â”‚ â€¢ 1å›ã®è§£æã§å®Œçµ               â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ LINE Reply Message              â”‚
         â”‚ â€¢ ä¿®æ­£æ¡ˆé€ä¿¡                     â”‚
         â”‚ â€¢ ã‚¨ãƒ©ãƒ¼åŸå› èª¬æ˜                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. RAG Q&Aãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ 1. è³ªå•é€ä¿¡ï¼ˆLINE or Webï¼‰
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/rag/query                         â”‚
â”‚ â€¢ ANTHROPIC_API_KEY ãƒã‚§ãƒƒã‚¯            â”‚
â”‚ â€¢ Timeout: 30ç§’                        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KeywordSearchService                   â”‚
â”‚ â€¢ æ—¥æœ¬èªå½¢æ…‹ç´ è§£æï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰          â”‚
â”‚ â€¢ system_documents ãƒ†ãƒ¼ãƒ–ãƒ«å…¨æ–‡æ¤œç´¢    â”‚
â”‚ â€¢ ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆTF-IDFé¢¨ï¼‰              â”‚
â”‚ â€¢ PostgreSQL ILIKEä½¿ç”¨                 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæŠ½å‡ºï¼ˆTop 5ï¼‰
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QAService                              â”‚
â”‚ â€¢ Claude Sonnet 4ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé€ä¿¡     â”‚
â”‚ â€¢ å›ç­”ç”Ÿæˆï¼ˆæœ€å¤§2000ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰          â”‚
â”‚ â€¢ æƒ…å ±æºï¼ˆsourcesï¼‰è¨˜éŒ²                 â”‚
â”‚ â€¢ ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢è¨ˆç®—                      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response                               â”‚
â”‚ {                                      â”‚
â”‚   answer: "...",                       â”‚
â”‚   sources: ["doc1", "doc2"],           â”‚
â”‚   confidence: "high",                  â”‚
â”‚   search_method: "keyword"             â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Stripeæ±ºæ¸ˆãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LINE Userâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ 1. "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã‚’è¦‹ã‚‹"
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LINE Bot                               â”‚
â”‚ â€¢ Payment Linké€ä¿¡                      â”‚
â”‚   Basic: 10,000å††/æœˆ                   â”‚
â”‚   Pro:   50,000å††/æœˆ                   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stripe Checkout                        â”‚
â”‚ â€¢ ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰å…¥åŠ›ï¼ˆ4242 4242...ï¼‰      â”‚
â”‚ â€¢ metadata.lineUserId ä¿å­˜             â”‚
â”‚ â€¢ æ±ºæ¸ˆå®Œäº†                              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. Webhooké€ä¿¡ï¼ˆ5åˆ†ä»¥å†…ï¼‰
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/stripe/webhook                    â”‚
â”‚ â€¢ ç½²åæ¤œè¨¼ï¼ˆHMAC-SHA256ï¼‰               â”‚
â”‚ â€¢ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ¤œè¨¼ï¼ˆ5åˆ†ä»¥å†…ï¼‰         â”‚
â”‚ â€¢ ã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥åˆ¤å®š                      â”‚
â”‚   - checkout.session.completed         â”‚
â”‚   - customer.subscription.updated      â”‚
â”‚   - customer.subscription.deleted      â”‚
â”‚   - charge.refunded                    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â†’ 3a. stripe_events ãƒ†ãƒ¼ãƒ–ãƒ«ãƒã‚§ãƒƒã‚¯
     â”‚   ï¼ˆé‡è¤‡é˜²æ­¢ï¼ševent_idï¼‰
     â”‚
     â”œâ”€â†’ 3b. metadata.lineUserId æŠ½å‡º
     â”‚
     â”œâ”€â†’ 3c. Supabaseæ›´æ–°ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ users ãƒ†ãƒ¼ãƒ–ãƒ«                   â”‚
     â”‚   â”‚ â€¢ subscription_status æ›´æ–°       â”‚
     â”‚   â”‚   - é‡‘é¡ã§åˆ¤å®š: >=50K â†’ professionalâ”‚
     â”‚   â”‚   -          : <50K â†’ basic     â”‚
     â”‚   â”‚ â€¢ stripe_customer_id ä¿å­˜        â”‚
     â”‚   â”‚ â€¢ payment_start_date è¨˜éŒ²        â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ user_subscriptions ãƒ†ãƒ¼ãƒ–ãƒ«      â”‚
     â”‚   â”‚ â€¢ status = 'active'             â”‚
     â”‚   â”‚ â€¢ plan_id é–¢é€£ä»˜ã‘              â”‚
     â”‚   â”‚ â€¢ start_date, end_date è¨˜éŒ²     â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ payment_history ãƒ†ãƒ¼ãƒ–ãƒ«         â”‚
     â”‚   â”‚ â€¢ æ±ºæ¸ˆå±¥æ­´è¨˜éŒ²ï¼ˆç›£æŸ»ç”¨ï¼‰         â”‚
     â”‚   â”‚ â€¢ amount, status, stripe_id     â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â†’ 3d. LINEé€šçŸ¥é€ä¿¡ï¼ˆéåŒæœŸï¼‰
         "ğŸ’ æ±ºæ¸ˆãŒå®Œäº†ã—ã¾ã—ãŸï¼"
         å¤±æ•—ã—ã¦ã‚‚Webhookã¯200è¿”å´
```

### 4. ãƒ‰ãƒªãƒƒãƒ—ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LINE Userâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ 1. å‹ã ã¡è¿½åŠ ï¼ˆfollow eventï¼‰
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/webhook                           â”‚
â”‚ â€¢ DripService.startDrip(userId)        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase users ãƒ†ãƒ¼ãƒ–ãƒ«                 â”‚
â”‚ â€¢ drip_status = 'active'               â”‚
â”‚ â€¢ drip_day = 1                         â”‚
â”‚ â€¢ drip_started_at = NOW()              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ ... 1æ™‚é–“å¾Œï¼ˆå¤–éƒ¨Cronï¼‰...
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/cron/drip                     â”‚
â”‚ â€¢ Authorization: Bearer <CRON_SECRET>  â”‚
â”‚ â€¢ 1æ™‚é–“ã”ã¨å®Ÿè¡Œ                         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DripService.processDripMessages()      â”‚
â”‚ â€¢ drip_status='active'ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—    â”‚
â”‚ â€¢ é…ä¿¡æ™‚é–“ãƒã‚§ãƒƒã‚¯ï¼ˆJST 10:00-18:00ï¼‰   â”‚
â”‚ â€¢ drip_day ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡       â”‚
â”‚ â€¢ é€ä¿¡æˆåŠŸ â†’ drip_day++                â”‚
â”‚ â€¢ Day 7å®Œäº† â†’ drip_status='completed'  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â†’ Day 1: "æ´»ç”¨ãƒ’ãƒ³ãƒˆ"ï¼ˆCTAå¼·åº¦â˜…â˜†â˜†â˜†â˜†ï¼‰
     â”œâ”€â†’ Day 2: "æ™‚é–“çš„ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ"ï¼ˆâ˜…â˜…â˜†â˜†â˜†ï¼‰
     â”œâ”€â†’ Day 3: "å°å…¥äº‹ä¾‹"ï¼ˆâ˜…â˜…â˜†â˜†â˜†ï¼‰
     â”œâ”€â†’ Day 4: "ã‚ã‚‹ã‚ã‚‹èª²é¡Œ"ï¼ˆâ˜…â˜…â˜…â˜†â˜†ï¼‰
     â”œâ”€â†’ Day 5: "é¢è«‡Q&A"ï¼ˆâ˜…â˜…â˜…â˜†â˜†ï¼‰
     â”œâ”€â†’ Day 6: "æ©Ÿä¼šæå¤±"ï¼ˆâ˜…â˜…â˜…â˜…â˜†ï¼‰
     â””â”€â†’ Day 7: "æœ€çµ‚ã”æ¡ˆå†…"ï¼ˆâ˜…â˜…â˜…â˜…â˜…ï¼‰
             â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ drip_logs ãƒ†ãƒ¼ãƒ–ãƒ«              â”‚
         â”‚ â€¢ é€ä¿¡ãƒ­ã‚°è¨˜éŒ²ï¼ˆç›£æŸ»ãƒ»åˆ†æç”¨ï¼‰   â”‚
         â”‚ â€¢ status, sent_at, error_messageâ”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœæ­¢æ¡ä»¶ï¼ˆè‡ªå‹•ã§drip_status='stopped'ï¼‰:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒBotã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
- æœ‰æ–™ãƒ—ãƒ©ãƒ³è³¼å…¥
- ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆunfollow eventï¼‰
```

### 5. AIç›¸è«‡ãƒ•ãƒ­ãƒ¼ï¼ˆé–‹ç™ºä¸­ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web User â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ 1. LPã€ŒAIç›¸è«‡ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /system-recommendation                 â”‚
â”‚ â€¢ ãƒ¢ãƒ¼ãƒ€ãƒ«ã¾ãŸã¯ãƒ•ãƒ«ãƒšãƒ¼ã‚¸è¡¨ç¤º          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. GET /api/system-recommendation
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ã¤ã®è³ªå•å–å¾—                           â”‚
â”‚ â€¢ sessionIdç”Ÿæˆï¼ˆUUIDï¼‰                 â”‚
â”‚ â€¢ questionsé…åˆ—è¿”å´                     â”‚
â”‚   1. æ¥­ç¨®                              â”‚
â”‚   2. èª²é¡Œæ¥­å‹™                           â”‚
â”‚   3. æœˆé–“é¡§å®¢æ•°                         â”‚
â”‚   4. å‰Šæ¸›å¸Œæœ›æ™‚é–“                       â”‚
â”‚   5. äºˆç®—æ„Ÿ                            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ5ã¤ã®è³ªå•ã«å›ç­”ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/system-recommendation        â”‚
â”‚ Body: {                                â”‚
â”‚   sessionId: "...",                    â”‚
â”‚   answers: [                           â”‚
â”‚     {questionId: 1, answer: "å°å£²æ¥­"}, â”‚
â”‚     {questionId: 2, answer: "åœ¨åº«ç®¡ç†"},â”‚
â”‚     {questionId: 3, answer: "500"},    â”‚
â”‚     {questionId: 4, answer: "40æ™‚é–“"}, â”‚
â”‚     {questionId: 5, answer: "æœˆé¡5ä¸‡"} â”‚
â”‚   ]                                    â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SystemDataService                      â”‚
â”‚ â€¢ page.tsx ã‹ã‚‰39ã‚·ã‚¹ãƒ†ãƒ ãƒ­ãƒ¼ãƒ‰         â”‚
â”‚ â€¢ JSONåœ§ç¸®ï¼ˆ7000ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰              â”‚
â”‚   - ä¸è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‰Šé™¤                  â”‚
â”‚   - descriptionçŸ­ç¸®                    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AIProviderManager                      â”‚
â”‚ â€¢ Claude Sonnet 4å‘¼ã³å‡ºã—               â”‚
â”‚ â€¢ ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆ7000ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰     â”‚
â”‚   + ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­”ï¼ˆ500ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰         â”‚
â”‚ â€¢ Prompt Cachingæ´»ç”¨ï¼ˆ2å›ç›®ä»¥é™90%å‰Šæ¸›ï¼‰â”‚
â”‚ â€¢ æ¨è–¦ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œï¼ˆClaudeåˆ¤æ–­ï¼‰        â”‚
â”‚ â€¢ Timeout: 45ç§’                        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response                               â”‚
â”‚ {                                      â”‚
â”‚   recommendations: [                   â”‚
â”‚     {                                  â”‚
â”‚       systemId: "31",                  â”‚
â”‚       systemName: "åœ¨åº«å›è»¢ç‡ç®¡ç†",     â”‚
â”‚       priority: 1,                     â”‚
â”‚       reason: "å°å£²æ¥­ã§åœ¨åº«ç®¡ç†ã«...",  â”‚
â”‚       estimatedTimeSaving: "æœˆ20æ™‚é–“"  â”‚
â”‚     },                                 â”‚
â”‚     {systemId: "30", priority: 2, ...},â”‚
â”‚     {systemId: "01", priority: 3, ...} â”‚
â”‚   ],                                   â”‚
â”‚   analysisText: "è²´ç¤¾ã®èª²é¡Œã‚’..."      â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â†’ 4a. consultation_history ãƒ†ãƒ¼ãƒ–ãƒ«è¨˜éŒ²ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
     â”‚
     â””â”€â†’ 4b. RecommendationResultã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¡¨ç¤º
             - ä¸Šä½3ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼
             - å„ã‚«ãƒ¼ãƒ‰: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ â†’ /systems/catalogé·ç§»
```

---

## APIè¨­è¨ˆ

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§ï¼ˆ23å€‹ã€å®Ÿæ¸¬ï¼‰

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | Method | èªè¨¼ | Timeout | ç”¨é€” |
|---------------|--------|------|---------|------|
| **LINE Bot** |
| `/api/webhook` | POST | LINEç½²å | 3ç§’ | LINE Webhookï¼ˆæœ€é‡è¦ã€1500è¡Œï¼‰ |
| **RAG** |
| `/api/rag/query` | POST | - | 30ç§’ | ã‚·ã‚¹ãƒ†ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆQ&A |
| `/api/rag/embed` | POST | ADMIN | 60ç§’ | ãƒ™ã‚¯ãƒˆãƒ«åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ |
| **æ±ºæ¸ˆ** |
| `/api/stripe/webhook` | POST | Stripeç½²å | 30ç§’ | Stripe Webhookï¼ˆ430è¡Œï¼‰ |
| `/api/subscription` | GET/POST | - | 10ç§’ | ã‚µãƒ–ã‚¹ã‚¯æƒ…å ±å–å¾—ãƒ»ä½œæˆ |
| `/api/subscription/cancel` | POST | - | 10ç§’ | ã‚µãƒ–ã‚¹ã‚¯ã‚­ãƒ£ãƒ³ã‚»ãƒ« |
| `/api/subscription/change-plan` | POST | - | 10ç§’ | ãƒ—ãƒ©ãƒ³å¤‰æ›´ |
| **ã‚·ã‚¹ãƒ†ãƒ ã‚«ã‚¿ãƒ­ã‚°** |
| `/api/systems` | GET | - | 10ç§’ | å…¬é–‹ã‚·ã‚¹ãƒ†ãƒ ä¸€è¦§ï¼ˆSupabaseï¼‰ |
| `/api/share/create` | POST | - | 10ç§’ | ã‚·ã‚¹ãƒ†ãƒ å…±æœ‰ãƒªãƒ³ã‚¯ç”Ÿæˆ |
| `/api/share/[shortId]` | GET | - | 10ç§’ | å…±æœ‰ã‚³ãƒ¼ãƒ‰å–å¾— |
| **AIç›¸è«‡** |
| `/api/system-recommendation` | GET | - | 5ç§’ | è³ªå•å–å¾— |
| `/api/system-recommendation` | POST | - | 45ç§’ | æ¨è–¦åˆ†æï¼ˆClaudeï¼‰ |
| **ç®¡ç†è€…** |
| `/api/admin/analytics` | GET | ADMIN_API_KEY | 30ç§’ | åˆ†æãƒ‡ãƒ¼ã‚¿ |
| `/api/admin/premium` | POST | ADMIN_API_KEY | 10ç§’ | ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»˜ä¸ |
| `/api/admin/sessions` | GET | ADMIN_API_KEY | 10ç§’ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ |
| `/api/admin/tracking-links` | GET/POST | ADMIN_API_KEY | 10ç§’ | ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒªãƒ³ã‚¯ç®¡ç† |
| `/api/admin/vision-stats` | GET | ADMIN_API_KEY | 10ç§’ | Vision APIçµ±è¨ˆ |
| **Cron** |
| `/api/cron/cleanup` | GET | CRON_SECRET | 60ç§’ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— |
| `/api/cron/process-queue` | GET | CRON_SECRET | 300ç§’ | ã‚­ãƒ¥ãƒ¼å‡¦ç† |
| `/api/cron/drip` | GET | CRON_SECRET | 300ç§’ | ãƒ‰ãƒªãƒƒãƒ—é…ä¿¡ |
| **ãƒ‡ãƒãƒƒã‚°** |
| `/api/debug/subscription` | GET | - | 10ç§’ | ã‚µãƒ–ã‚¹ã‚¯çŠ¶æ…‹ç¢ºèª |
| `/api/debug/setup` | GET | - | 5ç§’ | ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç¢ºèª |
| `/api/debug/stripe` | GET | - | 5ç§’ | Stripeè¨­å®šç¢ºèª |
| **ãã®ä»–** |
| `/api/health` | GET | - | 5ç§’ | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ |
| `/api/demo-proxy` | GET | - | 30ç§’ | iframeãƒ—ãƒ­ã‚­ã‚· |

### APIèªè¨¼æ–¹å¼

| èªè¨¼æ–¹å¼ | ç”¨é€” | å®Ÿè£… | æ¤œè¨¼ã‚³ãƒ¼ãƒ‰ |
|---------|------|------|----------|
| **LINEç½²åæ¤œè¨¼** | LINE Webhook | HMAC-SHA256ï¼ˆ`X-Line-Signature`ï¼‰ | `crypto.createHmac('sha256', SECRET).update(body).digest('base64')` |
| **Stripeç½²åæ¤œè¨¼** | Stripe Webhook | HMAC-SHA256ï¼ˆ`stripe-signature`ï¼‰ + ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ¤œè¨¼ï¼ˆ5åˆ†ä»¥å†…ï¼‰ | `stripe.webhooks.constructEvent()` |
| **ADMIN_API_KEY** | ç®¡ç†è€…API | `Authorization: Bearer <KEY>` | ãƒ˜ãƒƒãƒ€ãƒ¼ä¸€è‡´ç¢ºèª |
| **CRON_SECRET** | Cronã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | `Authorization: Bearer <SECRET>` | ãƒ˜ãƒƒãƒ€ãƒ¼ä¸€è‡´ç¢ºèª |

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ï¼ˆçµ±ä¸€ï¼‰

```typescript
// æˆåŠŸ
{
  success: true,
  data: { ... },
  message?: string,
  timestamp: string  // ISO 8601
}

// ã‚¨ãƒ©ãƒ¼
{
  success: false,
  error: string,      // ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥
  message: string,    // äººé–“å¯èª­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  code?: string,      // ã‚¢ãƒ—ãƒªå›ºæœ‰ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
  timestamp: string
}
```

### Rate Limitingï¼ˆlib/constants/config.tsï¼‰

```typescript
RATE_LIMITS = {
  PER_USER_PER_HOUR: 20,      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š20ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“
  GLOBAL_PER_MINUTE: 50,      // å…¨ä½“ã§50ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†
  CLAUDE_API_PER_MINUTE: 5,   // Claude API 5å›/åˆ†
  CLAUDE_API_PER_DAY: 100     // Claude API 100å›/æ—¥
}

// å®Ÿè£…: lib/rate-limit.ts
// - REDIS_URLè¨­å®šæ™‚: Redisã‚¹ãƒˆã‚¢ä½¿ç”¨
// - æœªè¨­å®šæ™‚: ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¢ã§å‹•ä½œ
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ERå›³ï¼ˆä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã€å®Ÿæ¸¬ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ users           â”‚1     âˆâ”‚ conversations    â”‚âˆ     1â”‚ sessions        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK line_user_id â”‚       â”‚ PK id            â”‚       â”‚ PK id           â”‚
â”‚    email        â”‚       â”‚ FK line_user_id  â”‚       â”‚ FK line_user_id â”‚
â”‚    username     â”‚       â”‚ FK session_id    â”‚       â”‚    last_active  â”‚
â”‚    subscription â”‚       â”‚    role          â”‚       â”‚    context      â”‚
â”‚    _status      â”‚       â”‚    content       â”‚       â”‚    status       â”‚
â”‚    stripe_id    â”‚       â”‚    timestamp     â”‚       â”‚    memory       â”‚
â”‚    drip_status  â”‚       â”‚    tokens_used   â”‚       â”‚    created_at   â”‚
â”‚    drip_day     â”‚       â”‚    model_used    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    drip_started â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    monthly_usageâ”‚
â”‚    blocked_at   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚1
        â”‚
        â”‚âˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_           â”‚âˆ     1â”‚ subscription_    â”‚
â”‚ subscriptions   â”‚â”€â”€â”€â”€â”€â”€â”€â”‚ plans            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK id           â”‚       â”‚ PK id            â”‚
â”‚ FK user_id      â”‚       â”‚    name          â”‚
â”‚    (line_user_id)â”‚      â”‚    price         â”‚
â”‚ FK plan_id      â”‚       â”‚    features JSONBâ”‚
â”‚    status       â”‚       â”‚    limits JSONB  â”‚
â”‚    start_date   â”‚       â”‚    stripe_price_ â”‚
â”‚    end_date     â”‚       â”‚    id            â”‚
â”‚    created_at   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ systems         â”‚1     âˆâ”‚ system_documents â”‚1     âˆâ”‚ system_         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”‚ embeddings      â”‚
â”‚ PK id           â”‚       â”‚ PK id            â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    name         â”‚       â”‚ FK system_id     â”‚       â”‚ PK id           â”‚
â”‚    slug         â”‚       â”‚    title         â”‚       â”‚ FK document_id  â”‚
â”‚    category     â”‚       â”‚    content       â”‚       â”‚    embedding    â”‚
â”‚    is_published â”‚       â”‚    version       â”‚       â”‚    vector(1536) â”‚
â”‚    download_    â”‚       â”‚    created_at    â”‚       â”‚    chunk_index  â”‚
â”‚    count        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    chunk_text   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ stripe_events   â”‚       â”‚ payment_history  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK event_id     â”‚       â”‚ PK id            â”‚
â”‚    type         â”‚       â”‚ FK user_id       â”‚
â”‚    data JSONB   â”‚       â”‚    amount        â”‚
â”‚    processed_at â”‚       â”‚    currency      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    stripe_       â”‚
                          â”‚    payment_id    â”‚
                          â”‚    status        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    created_at    â”‚
â”‚ refunds         â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK id           â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FK user_id      â”‚       â”‚ drip_logs        â”‚
â”‚    amount       â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    reason       â”‚       â”‚ PK id            â”‚
â”‚    stripe_      â”‚       â”‚ FK line_user_id  â”‚
â”‚    refund_id    â”‚       â”‚    day           â”‚
â”‚    created_at   â”‚       â”‚    message_type  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    status        â”‚
                          â”‚    error_message â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    sent_at       â”‚
â”‚ agencies        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK id           â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    name         â”‚       â”‚ agency_          â”‚
â”‚    email        â”‚       â”‚ conversions      â”‚
â”‚    commission_%â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    created_at   â”‚       â”‚ PK id            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ FK agency_id     â”‚
     â”‚1                   â”‚ FK line_user_id  â”‚
     â”‚                    â”‚    line_display_ â”‚
     â”‚âˆ                   â”‚    name          â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    device_type   â”‚
â”‚ tracking_links  â”‚       â”‚    browser       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚    os            â”‚
â”‚ PK id           â”‚       â”‚    session_id    â”‚
â”‚ FK agency_id    â”‚       â”‚    converted_at  â”‚
â”‚    short_code   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    target_url   â”‚
â”‚    click_count  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    created_at   â”‚       â”‚ consultation_    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ history          â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚ PK id            â”‚
                          â”‚    session_id    â”‚
                          â”‚ FK line_user_id  â”‚
                          â”‚    answers JSONB â”‚
                          â”‚    recommend     â”‚
                          â”‚    JSONB         â”‚
                          â”‚    created_at    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          ï¼ˆé–‹ç™ºä¸­ï¼‰
```

### ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°

#### usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

```sql
CREATE TABLE users (
  line_user_id TEXT PRIMARY KEY,
  email TEXT,
  username TEXT,
  subscription_status TEXT DEFAULT 'free',  -- 'free' | 'basic' | 'professional'
  is_premium BOOLEAN DEFAULT false,
  stripe_customer_id TEXT,
  payment_start_date TIMESTAMPTZ,
  blocked_at TIMESTAMPTZ,  -- ã‚¹ãƒ‘ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯
  drip_status TEXT DEFAULT 'inactive',  -- 'inactive' | 'active' | 'completed' | 'stopped'
  drip_day INTEGER DEFAULT 1,
  drip_started_at TIMESTAMPTZ,
  monthly_usage_count INTEGER DEFAULT 0,  -- æœˆé–“APIä½¿ç”¨å›æ•°
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_users_subscription ON users(subscription_status);
CREATE INDEX idx_users_drip ON users(drip_status, drip_day);
```

#### conversationsï¼ˆä¼šè©±å±¥æ­´ï¼‰

```sql
CREATE TABLE conversations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  line_user_id TEXT REFERENCES users(line_user_id),
  session_id UUID REFERENCES sessions(id),
  role TEXT NOT NULL,  -- 'user' | 'assistant'
  content TEXT NOT NULL,
  timestamp TIMESTAMPTZ DEFAULT NOW(),
  tokens_used INTEGER,  -- ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡
  model_used TEXT       -- 'claude-sonnet-4' | 'gemini-3-pro'
);

CREATE INDEX idx_conversations_user ON conversations(line_user_id);
CREATE INDEX idx_conversations_session ON conversations(session_id);
CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
```

#### sessionsï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰

```sql
CREATE TABLE sessions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  line_user_id TEXT REFERENCES users(line_user_id),
  last_active_at TIMESTAMPTZ DEFAULT NOW(),
  context JSONB,  -- ä¼šè©±ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
  status TEXT DEFAULT 'active',  -- 'active' | 'completed' | 'expired'
  memory JSONB,  -- çŸ­æœŸè¨˜æ†¶ï¼ˆé‡è¦æƒ…å ±æŠ½å‡ºï¼‰
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_sessions_user ON sessions(line_user_id);
CREATE INDEX idx_sessions_active ON sessions(last_active_at) WHERE status = 'active';
```

#### subscription_plansï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒ—ãƒ©ãƒ³ï¼‰

```sql
CREATE TABLE subscription_plans (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name TEXT NOT NULL,  -- 'basic' | 'professional'
  price DECIMAL(10, 2) NOT NULL,
  billing_cycle TEXT NOT NULL,  -- 'monthly' | 'yearly'
  contract_months INTEGER DEFAULT 6,
  features JSONB,  -- {"systems": 3, "downloads_per_month": 1}
  limits JSONB,    -- {"max_systems": 3, "max_downloads": 1}
  stripe_price_id TEXT,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆæœŸãƒ‡ãƒ¼ã‚¿
INSERT INTO subscription_plans (name, price, billing_cycle, contract_months, features, limits, stripe_price_id) VALUES
('basic', 10000.00, 'monthly', 6, '{"systems": 3, "downloads_per_month": 1}', '{"max_systems": 3, "max_downloads": 1}', 'price_basic_xxx'),
('professional', 50000.00, 'monthly', 6, '{"systems": "unlimited", "downloads_per_month": 5}', '{"max_downloads": 5}', 'price_pro_xxx');
```

#### system_embeddingsï¼ˆãƒ™ã‚¯ãƒˆãƒ«åŸ‹ã‚è¾¼ã¿ï¼‰

```sql
-- pgvectoræ‹¡å¼µæ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–
CREATE EXTENSION IF NOT EXISTS vector;

CREATE TABLE system_embeddings (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  document_id UUID REFERENCES system_documents(id),
  embedding vector(1536),  -- OpenAI embeddingsï¼ˆ1536æ¬¡å…ƒï¼‰
  chunk_index INTEGER,
  chunk_text TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ãƒ™ã‚¯ãƒˆãƒ«é¡ä¼¼åº¦æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆIVFFlatï¼‰
CREATE INDEX idx_embeddings_vector ON system_embeddings
USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);  -- ã‚¯ãƒ©ã‚¹ã‚¿æ•°ï¼ˆãƒ‡ãƒ¼ã‚¿é‡ã«å¿œã˜ã¦èª¿æ•´ï¼‰
```

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è¡Œæ•° |
|---------|------|-----------|------|
| `001_subscription_and_rag_tables.sql` | ã‚µãƒ–ã‚¹ã‚¯ + RAGãƒ†ãƒ¼ãƒ–ãƒ« | âœ… å®Ÿè¡Œæ¸ˆã¿ | ~500è¡Œ |
| `002_stripe_tables.sql` | Stripeæ±ºæ¸ˆãƒ†ãƒ¼ãƒ–ãƒ« | âœ… å®Ÿè¡Œæ¸ˆã¿ | ~200è¡Œ |
| `005_drip_campaign.sql` | ãƒ‰ãƒªãƒƒãƒ—ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ | âœ… å®Ÿè¡Œæ¸ˆã¿ | ~150è¡Œ |
| `006_agency_conversions_extend.sql` | ä»£ç†åº—ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | âœ… å®Ÿè¡Œæ¸ˆã¿ | ~100è¡Œ |
| `007_consultation_history.sql` | AIç›¸è«‡å±¥æ­´ | â³ é–‹ç™ºä¸­ | ~50è¡Œ |

---

## ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        INTERNET                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                â”‚
          â”‚ HTTPS                          â”‚ HTTPS
          â”‚                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Netlify CDN       â”‚          â”‚  Render Web Service         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ LPï¼ˆHTML 5814è¡Œï¼‰â”‚          â”‚ â€¢ Next.js 14 App            â”‚
â”‚ â€¢ ä»£ç†åº—ãƒãƒ¼ã‚¿ãƒ«    â”‚          â”‚ â€¢ Node.js 18.17.0           â”‚
â”‚ â€¢ 32 Functions (JS)â”‚          â”‚ â€¢ 2GB RAM Standard          â”‚
â”‚                    â”‚          â”‚ â€¢ 678MB node_modules        â”‚
â”‚ Domain:            â”‚          â”‚ â€¢ 312MB .nextï¼ˆé–‹ç™ºç’°å¢ƒï¼‰   â”‚
â”‚ taskmateai.net     â”‚          â”‚   â€»æœ¬ç•ª: 50-100MBç¨‹åº¦      â”‚
â”‚                    â”‚          â”‚ â€¢ --max-old-space-size=1536â”‚
â”‚ Deploy:            â”‚          â”‚                             â”‚
â”‚ â€¢ Git push trigger â”‚          â”‚ Domain:                     â”‚
â”‚ â€¢ CLI manual       â”‚          â”‚ gasgenerator.onrender.com   â”‚
â”‚   netlify deploy   â”‚          â”‚                             â”‚
â”‚   --prod           â”‚          â”‚ Build:                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ npm ci --include=dev &&     â”‚
                                â”‚ npm run build               â”‚
                                â”‚                             â”‚
                                â”‚ Start:                      â”‚
                                â”‚ node --expose-gc            â”‚
                                â”‚   --max-old-space-size=1536 â”‚
                                â”‚   node_modules/.bin/next    â”‚
                                â”‚   start                     â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                 â”‚                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
              â”‚ Supabase       â”‚ â”‚ Redis          â”‚ â”‚ External   â”‚
              â”‚ PostgreSQL     â”‚ â”‚ â€»ã‚ªãƒ—ã‚·ãƒ§ãƒ³    â”‚ â”‚ APIs       â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ â€¢ Tokyo region â”‚ â”‚ REDIS_URLè¨­å®š  â”‚ â”‚ â€¢ Claude   â”‚
              â”‚ â€¢ pgvector     â”‚ â”‚ ã§æœ‰åŠ¹åŒ–       â”‚ â”‚   Sonnet 4 â”‚
              â”‚ â€¢ Row Level    â”‚ â”‚                â”‚ â”‚ â€¢ Gemini   â”‚
              â”‚   Security     â”‚ â”‚ æœªè¨­å®šæ™‚ï¼š     â”‚ â”‚   3 Pro    â”‚
              â”‚ â€¢ 12 Tables    â”‚ â”‚ Memory Store   â”‚ â”‚ â€¢ LINE API â”‚
              â”‚ â€¢ Auto Backup  â”‚ â”‚ ã§å‹•ä½œ         â”‚ â”‚ â€¢ Stripe   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç’°å¢ƒå¤‰æ•°ç®¡ç†ï¼ˆå®Œå…¨ç‰ˆã€44å€‹å®Ÿæ¸¬ï¼‰

#### Renderï¼ˆãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªï¼‰

```bash
# === AI ===
ANTHROPIC_API_KEY=sk-ant-api03-...  # Claude Sonnet 4
CLAUDE_MODEL=claude-sonnet-4-20250514  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ã‚Šï¼‰
GEMINI_API_KEY=AIza...  # Gemini 3 Proï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
GEMINI_MODEL=gemini-3-pro-preview  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
OPENAI_API_KEY=sk-...  # RAGåŸ‹ã‚è¾¼ã¿ç”¨ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

# === Supabase ===
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...(anon key)
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJ...(service_role key)

# === LINE ===
LINE_CHANNEL_SECRET=xxx
LINE_CHANNEL_ACCESS_TOKEN=xxx
NEXT_PUBLIC_LINE_FRIEND_URL=https://line.me/R/ti/p/@xxx  # å‹ã ã¡è¿½åŠ URL

# === Stripe ===
STRIPE_SECRET_KEY=sk_test_xxx  # æœ¬ç•ª: sk_live_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx
STRIPE_PAYMENT_LINK=https://buy.stripe.com/test_xxx  # Basic
STRIPE_PAYMENT_LINK_PRO=https://buy.stripe.com/test_xxx  # Pro
NEXT_PUBLIC_STRIPE_PAYMENT_LINK=https://buy.stripe.com/test_xxx
NEXT_PUBLIC_STRIPE_PROFESSIONAL_PAYMENT_LINK=https://buy.stripe.com/test_xxx
NEXT_PUBLIC_STRIPE_PRICE_BASIC=price_xxx
NEXT_PUBLIC_STRIPE_PRICE_PROFESSIONAL=price_xxx

# === ç®¡ç†è€… ===
ADMIN_API_KEY=xxx
ADMIN_DASHBOARD_URL=https://xxx  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
ADMIN_ORIGIN=https://xxx  # CORSç”¨
ADMIN_ALLOWED_IPS=192.168.1.1,10.0.0.1  # ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³

# === ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ===
COOKIE_SECRET=xxx  # ã‚»ãƒƒã‚·ãƒ§ãƒ³æš—å·åŒ–
ENCRYPTION_SECRET=xxx  # ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–
WEBHOOK_SECRET=xxx  # æ±ç”¨Webhookæ¤œè¨¼
CRON_SECRET=xxx  # Cronã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆèªè¨¼

# === ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ç›¸è«‡æ©Ÿèƒ½ ===
ENGINEER_SUPPORT_GROUP_ID=Cxxx  # LINE ã‚°ãƒ«ãƒ¼ãƒ—ID
ENGINEER_USER_IDS=U001,U002,U003  # ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š

# === ãƒ‰ãƒªãƒƒãƒ—ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ ===
CONSULTATION_BOOKING_URL=https://calendly.com/xxx  # é¢è«‡äºˆç´„URL

# === ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»Redisï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ ===
REDIS_URL=redis://xxx:6379  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€æœªè¨­å®šæ™‚ã¯ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¢ä½¿ç”¨
                            # lib/rate-limit.tsã€lib/cache/ ã§ä½¿ç”¨
                            # è¨­å®šæ¨å¥¨ã ãŒå¿…é ˆã§ã¯ãªã„

# === ãã®ä»– ===
NEXT_PUBLIC_APP_URL=https://gasgenerator.onrender.com
NEXT_PUBLIC_BASE_URL=https://gasgenerator.onrender.com
NEXT_PUBLIC_APP_ENV=production  # 'development' | 'production'
NODE_ENV=production
PORT=10000  # Renderè‡ªå‹•è¨­å®š
NETLIFY_WEBHOOK_URL=https://xxx.netlify.app/.netlify/functions/xxx  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
ALLOWED_ORIGINS=https://line.me,https://api.line.me  # CORSã€ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š
LOG_LEVEL=info  # 'debug' | 'info' | 'warn' | 'error'
ENABLE_METRICS=true  # ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†æœ‰åŠ¹åŒ–

# === ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒã‚¹ã‚¿ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆéæ¨å¥¨ã€å‰Šé™¤äºˆå®šï¼‰ ===
PREMIUM_MASTER_CODE_=xxx
PREMIUM_MASTER_ACTIVATION_AMEBAS=xxx

# === Vercelï¼ˆæœªä½¿ç”¨ï¼‰ ===
VERCEL_ENV=production  # Vercelãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ã¿
```

**é‡è¦ãªæ³¨è¨˜**:
- **REDIS_URL**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€‚è¨­å®šæ™‚ã¯Redisã‚¹ãƒˆã‚¢ã€æœªè¨­å®šæ™‚ã¯ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¢ã§å‹•ä½œã€‚
- **OPENAI_API_KEY**: RAGåŸ‹ã‚è¾¼ã¿ç”¨ã€‚æœªè¨­å®šæ™‚ã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã®ã¿ã€‚
- **@sendgrid/mail**: package.jsonã«å­˜åœ¨ã™ã‚‹ãŒ**ã‚³ãƒ¼ãƒ‰å†…æœªä½¿ç”¨**ã€‚å‰Šé™¤æ¨å¥¨ã€‚

#### Netlifyï¼ˆLP + Functionsï¼‰

```bash
# Supabaseï¼ˆFunctionsç”¨ï¼‰
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_KEY=eyJ...(service_role key)

# LINEï¼ˆFunctionsç”¨ï¼‰
LINE_CHANNEL_ACCESS_TOKEN=xxx

# ãã®ä»–
NETLIFY_NEXT_PLUGIN_SKIP=true  # é‡è¦: Next.jsãƒ—ãƒ©ã‚°ã‚¤ãƒ³å›é¿
NETLIFY=true  # è‡ªå‹•è¨­å®š
```

### ãƒ“ãƒ«ãƒ‰è¨­å®š

#### Renderï¼ˆrender.yamlï¼‰

```yaml
services:
  - type: web
    name: gasgenerator
    runtime: node
    region: oregon  # ã¾ãŸã¯ singapore
    plan: standard
    buildCommand: npm ci --include=dev && npm run build
    startCommand: node --expose-gc --max-old-space-size=1536 node_modules/.bin/next start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        generateValue: true
    healthCheckPath: /api/health
```

#### Netlifyï¼ˆnetlify.tomlï¼‰

```toml
[build]
  publish = "frontend"
  functions = "netlify/functions"

[[headers]]
  for = "/*"
  [headers.values]
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    X-Frame-Options = "SAMEORIGIN"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

[functions]
  node_bundler = "esbuild"
  directory = "netlify/functions"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# ç’°å¢ƒå¤‰æ•°ï¼ˆNetlify UIè¨­å®šå¿…é ˆï¼‰
# SUPABASE_URL
# SUPABASE_SERVICE_KEY
# LINE_CHANNEL_ACCESS_TOKEN
# NETLIFY_NEXT_PLUGIN_SKIP=true
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 1. Webhookç½²åæ¤œè¨¼

#### LINE Webhookï¼ˆapp/api/webhook/route.tsï¼‰

```typescript
import crypto from 'crypto'

function validateLineSignature(body: string, signature: string): boolean {
  const hash = crypto
    .createHmac('sha256', process.env.LINE_CHANNEL_SECRET!)
    .update(body)
    .digest('base64')

  return hash === signature
}

// ä½¿ç”¨ä¾‹
const signature = request.headers.get('x-line-signature')
const rawBody = await request.text()

if (!validateLineSignature(rawBody, signature)) {
  return NextResponse.json({ error: 'Invalid signature' }, { status: 401 })
}
```

#### Stripe Webhookï¼ˆapp/api/stripe/webhook/route.tsï¼‰

```typescript
import Stripe from 'stripe'

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!)

function verifyStripeSignature(body: string, signature: string): Stripe.Event {
  return stripe.webhooks.constructEvent(
    body,
    signature,
    process.env.STRIPE_WEBHOOK_SECRET!
  )
}

// ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ¤œè¨¼ï¼ˆ5åˆ†ä»¥å†…ï¼‰
const timestamp = parseInt(signature.split(',')[0].split('=')[1])
const now = Math.floor(Date.now() / 1000)
if (Math.abs(now - timestamp) > 300) {
  throw new Error('Request too old')
}
```

### 2. ãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒé˜²æ­¢

```typescript
// Stripe Webhook
const { data: existing } = await supabaseAdmin
  .from('stripe_events')
  .select('event_id')
  .eq('event_id', event.id)
  .single()

if (existing) {
  logger.info('Duplicate event, skipping', { eventId: event.id })
  return NextResponse.json({ received: true })  // æ—¢ã«å‡¦ç†æ¸ˆã¿
}

// ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
await supabaseAdmin.from('stripe_events').insert({
  event_id: event.id,
  type: event.type,
  data: event.data,
  processed_at: new Date().toISOString()
})
```

### 3. Rate Limitingï¼ˆlib/rate-limit.tsï¼‰

```typescript
// è¨­å®šå€¤ï¼ˆlib/constants/config.tsï¼‰
export const RATE_LIMITS = {
  PER_USER_PER_HOUR: 20,      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š20ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“
  GLOBAL_PER_MINUTE: 50,      // å…¨ä½“ã§50ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†
  CLAUDE_API_PER_MINUTE: 5,   // Claude API 5å›/åˆ†
  CLAUDE_API_PER_DAY: 100     // Claude API 100å›/æ—¥ï¼ˆã‚³ã‚¹ãƒˆåˆ¶å¾¡ï¼‰
}

// å®Ÿè£…: lib/rate-limit.ts
// Rediså®Ÿè£…ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰+ Memory Storeï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
class RedisStore implements RateLimitStore {
  private redis: any

  constructor() {
    if (process.env.REDIS_URL) {
      import('ioredis').then(({ default: Redis }) => {
        this.redis = new Redis(process.env.REDIS_URL!)
      }).catch(() => {
        console.warn('Redis not available, falling back to memory store')
      })
    }
  }

  async increment(key: string): Promise<{ count: number; ttl: number }> {
    if (!this.redis) {
      return memoryStore.increment(key)  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    }

    const multi = this.redis.multi()
    multi.incr(key)
    multi.expire(key, 60)  // 1åˆ†
    const results = await multi.exec()
    return { count: results[0][1], ttl: 60 }
  }
}

// Memory Storeï¼ˆå¸¸æ™‚ç¨¼åƒï¼‰
class MemoryStore implements RateLimitStore {
  private store = new Map<string, { count: number; expires: number }>()

  async increment(key: string): Promise<{ count: number; ttl: number }> {
    const now = Date.now()
    const record = this.store.get(key)

    if (!record || record.expires < now) {
      const expires = now + 60000  // 1åˆ†
      this.store.set(key, { count: 1, expires })
      return { count: 1, ttl: 60 }
    }

    record.count++
    return {
      count: record.count,
      ttl: Math.ceil((record.expires - now) / 1000)
    }
  }
}
```

### 4. Row Level Securityï¼ˆRLSï¼‰

```sql
-- Supabase RLSãƒãƒªã‚·ãƒ¼ä¾‹
ALTER TABLE conversations ENABLE ROW LEVEL SECURITY;

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ä¼šè©±ã®ã¿é–²è¦§å¯èƒ½
CREATE POLICY "Users can view own conversations"
  ON conversations FOR SELECT
  USING (line_user_id = current_setting('app.user_id'));

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ä¼šè©±ã®ã¿æŒ¿å…¥å¯èƒ½
CREATE POLICY "Users can insert own conversations"
  ON conversations FOR INSERT
  WITH CHECK (line_user_id = current_setting('app.user_id'));

-- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã¯å…¨ã¦é–²è¦§å¯èƒ½
CREATE POLICY "Admins can view all conversations"
  ON conversations FOR SELECT
  USING (current_setting('app.is_admin') = 'true');
```

### 5. ç’°å¢ƒå¤‰æ•°ã®ç§˜åŒ¿åŒ–

- **Render**: Environment Variablesï¼ˆæš—å·åŒ–ä¿å­˜ã€è‡ªå‹•ãƒã‚¹ã‚­ãƒ³ã‚°ï¼‰
- **Netlify**: Environment Variablesï¼ˆæš—å·åŒ–ä¿å­˜ï¼‰
- **Git**: `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã«å«ã‚€ï¼ˆå¿…é ˆï¼‰
- **ã‚³ãƒ¼ãƒ‰**: `process.env.*` ã§ã‚¢ã‚¯ã‚»ã‚¹ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ç¦æ­¢

### 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆmiddleware.tsï¼‰

```typescript
// middleware.ts
export function middleware(request: NextRequest) {
  const response = NextResponse.next()

  response.headers.set('X-Content-Type-Options', 'nosniff')
  response.headers.set('X-Frame-Options', 'SAMEORIGIN')
  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin')
  response.headers.set('Permissions-Policy', 'geolocation=(), microphone=(), camera=()')
  response.headers.set('X-XSS-Protection', '1; mode=block')  // æ—§ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ

  return response
}

export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico).*)',
  ],
}
```

### 7. CORSè¨­å®šï¼ˆlib/constants/config.tsï¼‰

```typescript
export const SECURITY_CONFIG = {
  MIN_WEBHOOK_SECRET_LENGTH: 8,
  MAX_REQUEST_BODY_SIZE: 10000,  // 10KBï¼ˆDoSå¯¾ç­–ï¼‰
  CORS_ALLOWED_ORIGINS: process.env.NODE_ENV === 'production'
    ? ['https://line.me', 'https://api.line.me', 'https://webhook.line.me']
    : ['http://localhost:3000', 'http://127.0.0.1:3000']
} as const
```

---

## ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

### 1. æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æˆ¦ç•¥

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ‰‹æ³• | ç¾çŠ¶ | ä¸Šé™ | åˆ¶ç´„ |
|---------------|-----------------|------|------|------|
| **Render Web Service** | è‡ªå‹•/æ‰‹å‹•ã‚¹ã‚±ãƒ¼ãƒ« | 1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆ2GBï¼‰ | 10ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ | Standard plan |
| **Netlify Functions** | ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹è‡ªå‹• | åŒæ™‚125å®Ÿè¡Œ | åŒæ™‚1000å®Ÿè¡Œ | ç„¡æ–™ãƒ—ãƒ©ãƒ³åˆ¶é™ |
| **Supabase** | è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° | Free Tier | Proï¼ˆæ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°ï¼‰ | pgBouncer |
| **Redis** | ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆæœªè¨­å®šå¯èƒ½æ€§ï¼‰ | Redis Cluster | æ‰‹å‹•è¨­å®š |

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### Cachingæˆ¦ç•¥ï¼ˆ3å±¤ã€å®Ÿè£…æ¸ˆã¿ï¼‰

```typescript
// lib/cache/cache-strategy.tsï¼ˆãƒ¡ãƒ¢ãƒªãƒ™ãƒ¼ã‚¹ã€å¸¸æ™‚ç¨¼åƒï¼‰
export class CacheStrategy {
  private caches: Map<string, Map<string, CacheEntry<any>>> = new Map()

  // åˆæœŸåŒ–ã•ã‚Œã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  // - line-api: 1åˆ†TTLã€æœ€å¤§50ä»¶
  // - claude-api: 5åˆ†TTLã€æœ€å¤§20ä»¶
  // - user-session: 30åˆ†TTLã€æœ€å¤§100ä»¶
  // - code-generation: 1æ™‚é–“TTLã€æœ€å¤§10ä»¶
}

// lib/rate-limit.tsï¼ˆRedis or Memoryï¼‰
// Layer 1: Memory Storeï¼ˆå¸¸æ™‚ç¨¼åƒï¼‰
const memoryStore = new MemoryStore()

// Layer 2: Redis Storeï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€REDIS_URLè¨­å®šæ™‚ï¼‰
const redisStore = new RedisStore()  // è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ to Memory

// ä½¿ç”¨ä¾‹
async function getCachedData(key: string): Promise<any> {
  // 1. Memory Cacheï¼ˆæœ€é€Ÿï¼‰
  const memCached = cacheStrategy.get('cache-name', key)
  if (memCached) return memCached

  // 2. Redis Cacheï¼ˆé«˜é€Ÿã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  if (redis) {
    const redisCached = await redis.get(key)
    if (redisCached) {
      cacheStrategy.set('cache-name', key, JSON.parse(redisCached))
      return JSON.parse(redisCached)
    }
  }

  // 3. Databaseï¼ˆãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼‰
  const data = await supabaseAdmin.from('table').select('*')
  if (redis) await redis.setex(key, 1800, JSON.stringify(data))
  cacheStrategy.set('cache-name', key, data)
  return data
}
```

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æœ€é©åŒ–ï¼ˆlib/conversation/manager.tsï¼‰

```typescript
// ãƒ¡ãƒ¢ãƒªå‰Šæ¸›è¨­å®šï¼ˆå®Ÿè£…å€¤ï¼‰
const MAX_SESSIONS = 20  // åŒæ™‚ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ï¼ˆæ—§: 100ï¼‰
const SESSION_TIMEOUT = 30 * 60 * 1000  // 30åˆ†ï¼ˆæ—§: 2æ™‚é–“ï¼‰
const MEMORY_CHECK_INTERVAL = 5 * 60 * 1000  // 5åˆ†ã”ã¨ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
const MAX_RECENT_CODES = 5  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã‚³ãƒ¼ãƒ‰æ•°
```

#### Claude API Prompt Caching

```typescript
// lib/ai/recommendation-prompt.ts
// ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆ7000ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
// Anthropic Prompt Caching: https://docs.anthropic.com/claude/docs/prompt-caching
// ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTL: 5åˆ†
// ã‚³ã‚¹ãƒˆå‰Šæ¸›: 90%ï¼ˆ2å›ç›®ä»¥é™ã®APIå‘¼ã³å‡ºã—ï¼‰

const systemPrompt = {
  type: "text",
  text: SYSTEM_PROMPT.replace('{SYSTEMS_JSON}', systemsJson),
  cache_control: { type: "ephemeral" }  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹åŒ–
}
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥

```sql
-- é »ç¹ã«ã‚¯ã‚¨ãƒªã•ã‚Œã‚‹ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_conversations_user ON conversations(line_user_id);
CREATE INDEX idx_conversations_session ON conversations(session_id);
CREATE INDEX idx_sessions_user ON sessions(line_user_id);
CREATE INDEX idx_sessions_active ON sessions(last_active_at) WHERE status = 'active';
CREATE INDEX idx_users_subscription ON users(subscription_status);
CREATE INDEX idx_users_drip ON users(drip_status, drip_day);

-- pgvector IVFFlat ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆRAGï¼‰
CREATE INDEX idx_embeddings_vector ON system_embeddings
USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);  -- ã‚¯ãƒ©ã‚¹ã‚¿æ•°
```

#### Connection Poolingï¼ˆlib/supabase/client.tsï¼‰

```typescript
// Supabaseæ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®š
const supabaseAdmin = createClient(
  process.env.SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!,
  {
    db: {
      schema: 'public'
    },
    auth: {
      persistSession: false,
      autoRefreshToken: false
    },
    global: {
      headers: {
        'x-connection-pool-max': '5'  // ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç’°å¢ƒã§ã¯æœ€å°é™ã«
      }
    }
  }
)
```

### 4. è² è·åˆ†æ•£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Netlify CDN    â”‚  â†’ é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡ï¼ˆLPã€ä»£ç†åº—ãƒãƒ¼ã‚¿ãƒ«ï¼‰
â”‚ (Edge Nodes)   â”‚     ä¸–ç•Œä¸­ã®ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Dynamic Request
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render LB      â”‚  â†’ ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼è² è·åˆ†æ•£
â”‚ (Load Balancer)â”‚     è‡ªå‹•ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â†’ Instance 1ï¼ˆPrimaryï¼‰
     â”œâ”€â†’ Instance 2ï¼ˆStandbyï¼‰
     â””â”€â†’ Instance Nï¼ˆAuto-scaleï¼‰
```

---

## ç›£è¦–ãƒ»ãƒ­ã‚°

### 1. ãƒ­ã‚°åé›†

#### Loggerå®Ÿè£…ï¼ˆlib/utils/logger.tsï¼‰

```typescript
export const logger = {
  info: (message: string, meta?: any) => {
    console.log(JSON.stringify({
      level: 'info',
      timestamp: new Date().toISOString(),
      message,
      ...sanitizeMeta(meta)  // æ©Ÿå¯†æƒ…å ±é™¤å»
    }))
  },

  error: (message: string, meta?: any) => {
    console.error(JSON.stringify({
      level: 'error',
      timestamp: new Date().toISOString(),
      message,
      stack: meta?.error?.stack,
      ...sanitizeMeta(meta)
    }))
  },

  warn: (message: string, meta?: any) => {
    console.warn(JSON.stringify({
      level: 'warn',
      timestamp: new Date().toISOString(),
      message,
      ...sanitizeMeta(meta)
    }))
  }
}

// æ©Ÿå¯†æƒ…å ±é™¤å»ï¼ˆlib/constants/config.ts: LOG_CONFIG.SENSITIVE_KEYSï¼‰
function sanitizeMeta(meta: any): any {
  if (!meta) return {}
  const sanitized = { ...meta }
  const sensitiveKeys = ['password', 'token', 'secret', 'key', 'authorization']

  for (const key of Object.keys(sanitized)) {
    if (sensitiveKeys.some(k => key.toLowerCase().includes(k))) {
      sanitized[key] = '[REDACTED]'
    }
  }

  return sanitized
}
```

#### ä¸»è¦ãƒ­ã‚°ãƒã‚¤ãƒ³ãƒˆ

| ãƒ­ã‚°ç¨®åˆ¥ | å‡ºåŠ›å ´æ‰€ | ç”¨é€” |
|---------|---------|------|
| **Webhookå—ä¿¡** | `app/api/webhook/route.ts` | LINE Botå‹•ä½œç›£è¦–ã€ã‚¨ãƒ©ãƒ¼è¿½è·¡ |
| **AI APIå‘¼ã³å‡ºã—** | `lib/ai/provider.ts` | ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»è¿½è·¡ã€ã‚³ã‚¹ãƒˆè¨ˆç®— |
| **æ±ºæ¸ˆå‡¦ç†** | `app/api/stripe/webhook/route.ts` | èª²é‡‘ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |
| **ã‚¨ãƒ©ãƒ¼** | å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | éšœå®³æ¤œçŸ¥ãƒ»åŸå› ç‰¹å®š |
| **ãƒ‰ãƒªãƒƒãƒ—é…ä¿¡** | `app/api/cron/drip/route.ts` | é…ä¿¡æˆåŠŸç‡ç›£è¦– |
| **Rate Limit** | `lib/rate-limit.ts` | ä¸æ­£åˆ©ç”¨æ¤œçŸ¥ |
| **Redis Fallback** | `lib/rate-limit.ts` | Redisæ¥ç¶šå¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ |

### 2. ãƒ¡ãƒˆãƒªã‚¯ã‚¹

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆlib/constants/config.ts: METRICS_CONFIGï¼‰

```typescript
// åé›†ã™ã¹ããƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆ5åˆ†é–“éš”ã€7æ—¥ä¿æŒï¼‰
{
  // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  "request_count": 1000,
  "request_duration_ms": 250,
  "status_code": 200,

  // AI API
  "claude_api_calls": 500,
  "claude_tokens_input": 50000,
  "claude_tokens_output": 20000,
  "claude_errors": 5,
  "gemini_api_calls": 10,  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  "gemini_tokens": 5000,

  // LINE Bot
  "line_messages_sent": 1000,
  "line_messages_received": 1200,
  "line_errors": 2,

  // æ±ºæ¸ˆ
  "stripe_payments": 10,
  "stripe_revenue_jpy": 500000,
  "stripe_errors": 0,

  // ãƒ‰ãƒªãƒƒãƒ—
  "drip_messages_sent": 150,
  "drip_conversion_rate": 0.05,  // 5%

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  "cache_hits": 800,
  "cache_misses": 200,
  "redis_connected": true  // Redisæ¥ç¶šçŠ¶æ…‹
}
```

#### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ¡ãƒˆãƒªã‚¯ã‚¹

- **Render Dashboard**: CPUã€ãƒ¡ãƒ¢ãƒªã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
- **Supabase Dashboard**: DBæ¥ç¶šæ•°ã€ã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚é–“ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡
- **Netlify Analytics**: Functionå®Ÿè¡Œæ•°ã€ã‚¨ãƒ©ãƒ¼ç‡ã€å®Ÿè¡Œæ™‚é–“

### 3. ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šï¼ˆæ¨å¥¨ã€lib/constants/config.ts: METRICS_CONFIG.ALERT_THRESHOLDSï¼‰

| ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶ | é–¾å€¤ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|------------|------|----------|
| **Render CPU** | > 80% | ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—æ¤œè¨ |
| **Render Memory** | > 1.5GB | ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯èª¿æŸ» |
| **Supabaseæ¥ç¶šæ•°** | > 50 | Connection Poolæ‹¡å¤§ |
| **Claude APIã‚¨ãƒ©ãƒ¼ç‡** | > 5% | Geminiãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç¢ºèª |
| **Stripe Webhookå¤±æ•—** | é€£ç¶š3å› | æ‰‹å‹•ç¢ºèªãƒ»å†é€ |
| **ãƒ‰ãƒªãƒƒãƒ—é…ä¿¡å¤±æ•—ç‡** | > 10% | LINE APIçŠ¶æ…‹ç¢ºèª |
| **å¿œç­”æ™‚é–“** | > 5ç§’ | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æŸ» |
| **ã‚­ãƒ¥ãƒ¼é•·** | > 50 | ãƒ¯ãƒ¼ã‚«ãƒ¼å¢—å¼· |
| **Redisæ¥ç¶šå¤±æ•—** | é€£ç¶š10å› | Redis URLç¢ºèªã€Memory Storeå‹•ä½œç¢ºèª |

### 4. ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼ˆå°†æ¥å®Ÿè£…æ¨å¥¨ï¼‰

```typescript
// Sentryçµ±åˆä¾‹ï¼ˆæœªå®Ÿè£…ï¼‰
import * as Sentry from '@sentry/nextjs'

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 0.1,  // 10%ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹
  integrations: [
    new Sentry.BrowserTracing(),
    new Sentry.Replay({
      maskAllText: true,
      blockAllMedia: true
    })
  ],
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0
})
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥

### 1. Gitæˆ¦ç•¥

```
main ãƒ–ãƒ©ãƒ³ãƒï¼ˆæœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ï¼‰
  â”œâ”€â”€ feature/ai-consultation      â† æ–°æ©Ÿèƒ½é–‹ç™º
  â”œâ”€â”€ hotfix/webhook-error          â† ç·Šæ€¥ä¿®æ­£
  â””â”€â”€ release/v2.2                  â† ãƒªãƒªãƒ¼ã‚¹æº–å‚™

ã‚³ãƒŸãƒƒãƒˆè¦å‰‡:
- feat: æ–°æ©Ÿèƒ½
- fix: ãƒã‚°ä¿®æ­£
- docs: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- refactor: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- test: ãƒ†ã‚¹ãƒˆè¿½åŠ 
- chore: ãã®ä»–

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

### 2. CI/CD

#### Renderï¼ˆè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰

```
GitHub Push (main)
    â†“ Webhook
Render Webhookå—ä¿¡
    â†“
npm ci --include=dev && npm run build
    â†“ 5-10åˆ†
ãƒ“ãƒ«ãƒ‰æˆåŠŸï¼ˆ.next/ ç”Ÿæˆï¼‰
    â€»é–‹ç™ºç’°å¢ƒ: 312MBï¼ˆcacheã‚ã‚Šï¼‰
    â€»æœ¬ç•ªç’°å¢ƒ: 50-100MBï¼ˆcacheãªã—ï¼‰
    â†“
node --expose-gc --max-old-space-size=1536 node_modules/.bin/next start
    â†“
ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆGET /api/healthï¼‰
    â†“
ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ‡æ›¿ï¼ˆã‚¼ãƒ­ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ï¼‰
    â†“
ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†
```

#### Netlifyï¼ˆæ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤æ¨å¥¨ï¼‰

```bash
cd netlify-tracking
cp ../public/lp-page.html frontend/index.html
npx netlify deploy --prod --dir=frontend

# æˆåŠŸç¢ºèª
curl https://taskmateai.net
```

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§ `npm run build` æˆåŠŸï¼ˆ10-15åˆ†ï¼‰
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§ `npm run lint` è­¦å‘Š3ä»¶ä»¥ä¸‹
- [ ] ç’°å¢ƒå¤‰æ•°44å€‹ãŒRenderã«è¨­å®šæ¸ˆã¿ï¼ˆRedisä»»æ„ï¼‰
- [ ] Supabase migrationsãŒå®Ÿè¡Œæ¸ˆã¿ï¼ˆ6ä»¶ï¼‰
- [ ] CLAUDE.md ã«ä»Šå›ã®å¤‰æ›´ã‚’è¨˜éŒ²
- [ ] ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ˜ç¢ºï¼ˆfeat/fix/docsãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰
- [ ] `Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>` å«ã‚€
- [ ] ãƒ–ãƒ©ãƒ³ãƒãŒmainã«ãƒãƒ¼ã‚¸æ¸ˆã¿
- [ ] Render Dashboard ã§ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°ç¢ºèª
- [ ] æœ¬ç•ªç’°å¢ƒã§ `/api/health` ãŒ200 OK
- [ ] LINEã§å‹•ä½œç¢ºèªï¼ˆå‹ã ã¡è¿½åŠ â†’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼‰

### 4. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

```bash
# Render
# Dashboardã‹ã‚‰ "Rollback to <commit>" ã‚’ã‚¯ãƒªãƒƒã‚¯
# ã¾ãŸã¯ CLI:
render rollback --service=gasgenerator --to=<commit-sha>

# Netlify
netlify rollback --site=autogas

# Supabase Migrationï¼ˆæ‰‹å‹•ã§é€†ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼‰
psql $DATABASE_URL < migrations/rollback_007.sql
```

### 5. Blue-Green Deploymentï¼ˆå°†æ¥å®Ÿè£…ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Balancerâ”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
   â”‚       â”‚
   â”‚ 100%  â”‚ 0%
   â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ Blue â”‚ â”‚ Greenâ”‚
â”‚ (v2.1)â”‚ â”‚ (v2.2)â”‚  â† æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒ†ã‚¹ãƒˆ
â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
   â†“ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ‡æ›¿ï¼ˆç¬æ™‚ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Balancerâ”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
   â”‚       â”‚
   â”‚ 0%    â”‚ 100%
   â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ Blue â”‚ â”‚ Greenâ”‚  â† æœ¬ç•ªç¨¼åƒ
â”‚ (v2.1)â”‚ â”‚ (v2.2)â”‚
â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
```

---

## ã‚³ã‚¹ãƒˆæ§‹é€ 

### 1. AI API ã‚³ã‚¹ãƒˆï¼ˆå®Ÿæ¸¬ lib/constants/config.tsï¼‰

#### Claude Sonnet 4

```typescript
CLAUDE_CONFIG = {
  MODEL: 'claude-sonnet-4-20250514',
  MAX_TOKENS: 32000,  // å‡ºåŠ›ä¸Šé™
  COST_PER_INPUT_TOKEN: 0.003 / 1000,   // $3 per million tokens
  COST_PER_OUTPUT_TOKEN: 0.015 / 1000   // $15 per million tokens
}

// ã‚³ã‚¹ãƒˆè¨ˆç®—ä¾‹
const avgInputTokens = 5000   // ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ3K + ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›2K
const avgOutputTokens = 1500  // GASã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
const costPerRequest = (avgInputTokens * 0.003 / 1000) + (avgOutputTokens * 0.015 / 1000)
                     = 0.015 + 0.0225 = $0.0375ï¼ˆç´„5.6å††ï¼‰

// æœˆé–“ã‚³ã‚¹ãƒˆè©¦ç®—ï¼ˆ1æ—¥50ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
æœˆé–“ãƒªã‚¯ã‚¨ã‚¹ãƒˆ = 50 * 30 = 1500å›
æœˆé–“ã‚³ã‚¹ãƒˆ = 1500 * 5.6å†† = 8,400å††
```

#### Gemini 3 Proï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

```typescript
GEMINI_CONFIG = {
  MODEL: 'gemini-3-pro-preview',
  MAX_OUTPUT_TOKENS: 8192,
  COST_PER_INPUT_TOKEN: 0.125 / 1_000_000,   // $0.125 per million tokens
  COST_PER_OUTPUT_TOKEN: 0.50 / 1_000_000    // $0.50 per million tokens
}

// ã‚³ã‚¹ãƒˆè¨ˆç®—ä¾‹ï¼ˆClaudeã®ç´„1/60ï¼‰
const costPerRequest = (5000 * 0.125 / 1_000_000) + (1500 * 0.50 / 1_000_000)
                     = 0.000625 + 0.00075 = $0.001375ï¼ˆç´„0.2å††ï¼‰

// ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‡5%æƒ³å®š
æœˆé–“ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ = 1500 * 0.05 = 75å›
æœˆé–“ã‚³ã‚¹ãƒˆ = 75 * 0.2å†† = 15å††
```

### 2. ã‚¤ãƒ³ãƒ•ãƒ©ã‚³ã‚¹ãƒˆ

| ã‚µãƒ¼ãƒ“ã‚¹ | ãƒ—ãƒ©ãƒ³ | æœˆé¡ | å‚™è€ƒ |
|---------|--------|------|------|
| **Render** | Standardï¼ˆ2GBï¼‰ | $25 | è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯ |
| **Netlify** | ç„¡æ–™ | $0 | 32 Functionsã€125åŒæ™‚å®Ÿè¡Œ |
| **Supabase** | Free Tier | $0 | DB 500MBã€è»¢é€é‡1GB/æœˆ |
| **Redis** | å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ | $5-20 | Upstashç­‰ã€æœªè¨­å®šå¯èƒ½æ€§ |
| **GitHub** | Private Repo | $0 | Organizationç„¡æ–™ |
| **åˆè¨ˆ** | - | **$25-45** | **ç´„3,800-6,800å††/æœˆ** |

### 3. ç·ã‚³ã‚¹ãƒˆè©¦ç®—ï¼ˆæœˆé–“1500ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ³å®šï¼‰

```
AI APIï¼ˆClaudeï¼‰:     8,400å††
AI APIï¼ˆGeminiï¼‰:        15å††
ã‚¤ãƒ³ãƒ•ãƒ©:            3,800å††ï¼ˆRedisæœªä½¿ç”¨ã®å ´åˆï¼‰
-----------------------------------
æœˆé–“ç·ã‚³ã‚¹ãƒˆ:       ç´„12,200å††

ãƒ¦ãƒ¼ã‚¶ãƒ¼1äººã‚ãŸã‚Šï¼ˆ50ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æœˆï¼‰: ç´„410å††
```

### 4. åç›Šæ€§åˆ†æ

```
ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ—ãƒ©ãƒ³ï¼ˆ10,000å††/æœˆï¼‰:
  ã‚³ã‚¹ãƒˆ: ç´„1,000å††ï¼ˆæœˆé–“50ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ³å®šï¼‰
  ç²—åˆ©ç›Š: 9,000å††
  ç²—åˆ©ç‡: 90%

ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ©ãƒ³ï¼ˆ50,000å††/æœˆï¼‰:
  ã‚³ã‚¹ãƒˆ: ç´„5,000å††ï¼ˆæœˆé–“250ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ³å®šï¼‰
  ç²—åˆ©ç›Š: 45,000å††
  ç²—åˆ©ç‡: 90%

æç›Šåˆ†å²ç‚¹: æœˆé–“3ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ™ãƒ¼ã‚·ãƒƒã‚¯ï¼‰ã¾ãŸã¯1ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ—ãƒ­ï¼‰
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š

### 1. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆlib/constants/config.ts: TIMEOUTSï¼‰

```typescript
export const TIMEOUTS = {
  WEBHOOK_RESPONSE: 3000,    // 3ç§’ï¼ˆLINEå¿…é ˆåˆ¶é™ï¼‰
  CLAUDE_API: 45000,         // 45ç§’
  DATABASE_QUERY: 10000,     // 10ç§’
  HTTP_REQUEST: 30000        // 30ç§’
} as const
```

### 2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆlib/constants/config.ts: RATE_LIMITSï¼‰

```typescript
export const RATE_LIMITS = {
  PER_USER_PER_HOUR: 20,          // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š20ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“
  GLOBAL_PER_MINUTE: 50,          // å…¨ä½“ã§50ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†
  CLAUDE_API_PER_MINUTE: 5,       // Claude API 5å›/åˆ†
  CLAUDE_API_PER_DAY: 100         // Claude API 100å›/æ—¥
} as const
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šï¼ˆlib/constants/config.ts: DATABASE_CONFIGï¼‰

```typescript
export const DATABASE_CONFIG = {
  MAX_SESSION_AGE_HOURS: 24,      // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿æŒæ™‚é–“
  MAX_QUEUE_AGE_HOURS: 1,         // ã‚­ãƒ¥ãƒ¼ä¿æŒæ™‚é–“
  MAX_RETRIES: 3,                 // ãƒªãƒˆãƒ©ã‚¤å›æ•°
  CLEANUP_INTERVAL_MINUTES: 60,   // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–“éš”
  MAX_RECENT_CODES: 5             // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã‚³ãƒ¼ãƒ‰æ•°
} as const
```

### 4. ä¼šè©±ãƒ•ãƒ­ãƒ¼è¨­å®šï¼ˆlib/constants/config.ts: CONVERSATION_CONFIGï¼‰

```typescript
export const CONVERSATION_CONFIG = {
  MAX_STEPS: 3,                   // ä¼šè©±ã‚¹ãƒ†ãƒƒãƒ—æ•°
  MAX_REQUIREMENTS_LENGTH: 1000,  // è¦ä»¶æœ€å¤§æ–‡å­—æ•°
  MIN_DETAILS_LENGTH: 10          // è©³ç´°æœ€å°æ–‡å­—æ•°
} as const
```

### 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼ˆlib/constants/config.ts: SECURITY_CONFIGï¼‰

```typescript
export const SECURITY_CONFIG = {
  MIN_WEBHOOK_SECRET_LENGTH: 8,
  MAX_REQUEST_BODY_SIZE: 10000,   // 10KBï¼ˆDoSå¯¾ç­–ï¼‰
  CORS_ALLOWED_ORIGINS: process.env.NODE_ENV === 'production'
    ? ['https://line.me', 'https://api.line.me', 'https://webhook.line.me']
    : ['http://localhost:3000', 'http://127.0.0.1:3000']
} as const
```

### 6. ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨­å®šï¼ˆlib/constants/config.ts: METRICS_CONFIGï¼‰

```typescript
export const METRICS_CONFIG = {
  COLLECTION_INTERVAL_MS: 300000, // 5åˆ†æ¯
  RETENTION_DAYS: 7,              // 7æ—¥ä¿æŒ
  ALERT_THRESHOLDS: {
    ERROR_RATE: 0.05,             // 5%
    RESPONSE_TIME: 5000,          // 5ç§’
    QUEUE_LENGTH: 50
  }
} as const
```

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ç¾çŠ¶: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«0å€‹ï¼ˆå®Ÿæ¸¬ï¼‰

```bash
$ find . -path ./node_modules -prune -o -name "*.test.*" -type f -print | wc -l
0

$ find . -path ./node_modules -prune -o -name "*.spec.*" -type f -print | wc -l
0
```

**é‡è¦**: ç¾åœ¨ã€ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆã¯**æœªå®Ÿè£…**ã€‚

### æ¨å¥¨ã•ã‚Œã‚‹ä»Šå¾Œã®å®Ÿè£…

#### 1. ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

```json
// package.json ã«è¿½åŠ æ¨å¥¨
{
  "devDependencies": {
    "jest": "^29.7.0",
    "@testing-library/react": "^14.0.0",
    "@testing-library/jest-dom": "^6.1.0",
    "jest-environment-jsdom": "^29.7.0"
  },
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage"
  }
}
```

#### 2. ãƒ†ã‚¹ãƒˆå„ªå…ˆåº¦

| å„ªå…ˆåº¦ | ãƒ†ã‚¹ãƒˆå¯¾è±¡ | ç†ç”± |
|--------|-----------|------|
| **æœ€é«˜** | `app/api/webhook/route.ts` | LINE Botã®å¿ƒè‡“éƒ¨ã€1500è¡Œ |
| **æœ€é«˜** | `lib/ai/provider.ts` | AIãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ |
| **é«˜** | `app/api/stripe/webhook/route.ts` | æ±ºæ¸ˆå‡¦ç†ã€é‡‘éŠ­çš„ãƒªã‚¹ã‚¯ |
| **é«˜** | `lib/rag/qa-service.ts` | RAGã‚·ã‚¹ãƒ†ãƒ ã®ç²¾åº¦ |
| **é«˜** | `lib/rate-limit.ts` | Redis/Memoryãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ |
| **ä¸­** | `lib/drip/drip-service.ts` | ãƒ‰ãƒªãƒƒãƒ—é…ä¿¡ãƒ­ã‚¸ãƒƒã‚¯ |
| **ä¸­** | `lib/premium/premium-checker.ts` | ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒã‚§ãƒƒã‚¯ |
| **ä½** | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | UIå‹•ä½œç¢ºèª |

#### 3. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

```
ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸:
- Critical Pathï¼ˆWebhook, AI, Stripeï¼‰: 80%ä»¥ä¸Š
- Business Logicï¼ˆlib/ï¼‰: 70%ä»¥ä¸Š
- API Routesï¼ˆapp/api/ï¼‰: 60%ä»¥ä¸Š
- Componentsï¼ˆcomponents/ï¼‰: 50%ä»¥ä¸Š
```

#### 4. E2Eãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ãƒ„ãƒ¼ãƒ«: Playwrightï¼‰

```typescript
// tests/e2e/line-bot.spec.ts
import { test, expect } from '@playwright/test'

test('LINE Bot GASç”Ÿæˆãƒ•ãƒ­ãƒ¼', async ({ page }) => {
  // 1. Webhookã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
  // 2. Claude API ãƒ¢ãƒƒã‚¯
  // 3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼
})
```

---

## ä»Šå¾Œã®æ‹¡å¼µè¨ˆç”»

### Phase A: AIç›¸è«‡æ©Ÿèƒ½å®Œæˆï¼ˆ2é€±é–“ã€é–‹ç™ºä¸­ï¼‰

- [x] ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆå®Œäº†
- [x] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œæˆï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ« v2.2ï¼‰
- [ ] Backend APIå®Ÿè£…ï¼ˆ3æ™‚é–“ï¼‰
- [ ] Frontend UIå®Ÿè£…ï¼ˆ4æ™‚é–“ï¼‰
- [ ] DB Migrationå®Ÿè¡Œï¼ˆ1æ™‚é–“ï¼‰
- [ ] æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ0.5æ™‚é–“ï¼‰
- [ ] A/Bãƒ†ã‚¹ãƒˆå®Ÿæ–½ï¼ˆ1é€±é–“ï¼‰

### Phase B: Google Driveçµ±åˆï¼ˆ1é€±é–“ï¼‰

- [ ] Google Cloud Projectã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] Service Accountä½œæˆ
- [ ] `lib/code/file-generator.ts` å®Ÿè£…
- [ ] LINE Botã«Driveãƒªãƒ³ã‚¯é€ä¿¡æ©Ÿèƒ½è¿½åŠ 
- [ ] ç’°å¢ƒå¤‰æ•°è¿½åŠ :
  ```
  GOOGLE_DRIVE_API_KEY=
  GOOGLE_DRIVE_FOLDER_ID=
  GOOGLE_SERVICE_ACCOUNT_JSON=
  ```

### Phase C: RAGç²¾åº¦å‘ä¸Šï¼ˆ2é€±é–“ï¼‰

- [ ] æ—¥æœ¬èªå½¢æ…‹ç´ è§£ææ”¹å–„ï¼ˆMeCabçµ±åˆï¼‰
- [ ] Embedding â†’ Claude Embeddingsç§»è¡Œ
- [ ] Hybridæ¤œç´¢ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ + ãƒ™ã‚¯ãƒˆãƒ«ï¼‰å®Ÿè£…
- [ ] Few-shot examplesè¿½åŠ 
- [ ] ã‚·ã‚¹ãƒ†ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå……å®Ÿï¼ˆ39ã‚·ã‚¹ãƒ†ãƒ å…¨ã¦ï¼‰

### Phase D: ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ2é€±é–“ï¼‰

- [ ] Jest + Testing Library ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] Critical Path ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆWebhook, AI, Stripeï¼‰
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè£…
- [ ] E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆPlaywrightï¼‰
- [ ] CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ãƒ†ã‚¹ãƒˆè¿½åŠ 

### Phase E: ç®¡ç†ç”»é¢å¼·åŒ–ï¼ˆ2é€±é–“ï¼‰

- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [ ] ã‚·ã‚¹ãƒ†ãƒ ã‚«ã‚¿ãƒ­ã‚°CMSåŒ–ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰è„±å´ï¼‰
- [ ] ãƒ‰ãƒªãƒƒãƒ—ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³A/Bãƒ†ã‚¹ãƒˆ
- [ ] ä»£ç†åº—ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
- [ ] ãƒ¡ãƒˆãƒªã‚¯ã‚¹å¯è¦–åŒ–ï¼ˆGrafanaç­‰ï¼‰

### Phase F: Redisæœ¬ç•ªå°å…¥ï¼ˆ3æ—¥ï¼‰

- [ ] Rediså¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é¸å®šï¼ˆUpstashæ¨å¥¨ï¼‰
- [ ] REDIS_URLç’°å¢ƒå¤‰æ•°è¨­å®š
- [ ] æœ¬ç•ªç’°å¢ƒã§å‹•ä½œç¢ºèª
- [ ] ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¢ã‹ã‚‰ã®ç§»è¡Œãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | æ¤œè¨¼è€… |
|------|-----------|---------|--------|
| 2026-02-13 | 2.2 | **å®Œå…¨ä¿®æ­£ç‰ˆ**ï¼ˆå†æ¤œè¨¼å®Œäº†ï¼‰<br>- Rediså®Ÿè£…çŠ¶æ³æ˜ç¢ºåŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ç’°å¢ƒå¤‰æ•°ã§æœ‰åŠ¹åŒ–ï¼‰<br>- .nextã‚µã‚¤ã‚ºæ³¨è¨˜è¿½åŠ ï¼ˆé–‹ç™ºç’°å¢ƒcache 307MBå«ã‚€ï¼‰<br>- SendGridå‰Šé™¤æ¨å¥¨æ˜è¨˜<br>- REDIS_URLã‚ªãƒ—ã‚·ãƒ§ãƒ³æ˜è¨˜<br>- ã‚¤ãƒ³ãƒ•ãƒ©å›³Redisè¡¨è¨˜ä¿®æ­£<br>- å…¨ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥æ˜è¨˜<br>- ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: â˜…â˜…â˜…â˜…â˜…ï¼ˆ2å›æ¤œè¨¼ï¼‰ | Claude + ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å®Œå…¨ç…§åˆ |
| 2026-02-13 | 2.1 | **å®Œå…¨ç‰ˆ**ä½œæˆï¼ˆå®Ÿæ¸¬å€¤åæ˜ ï¼‰<br>- ã‚·ã‚¹ãƒ†ãƒ æ•°: 42â†’39ã«ä¿®æ­£<br>- ç’°å¢ƒå¤‰æ•°: 44å€‹ã«æ‹¡å……<br>- æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯: Geminiè‡ªå‰å®Ÿè£…æ˜è¨˜<br>- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚º: å®Ÿæ¸¬å€¤åæ˜ <br>- ã‚³ã‚¹ãƒˆæ§‹é€ è¿½åŠ <br>- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šè¿½åŠ <br>- ãƒ†ã‚¹ãƒˆæˆ¦ç•¥è¿½åŠ  | Claude + ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ç…§åˆ |
| 2026-02-13 | 2.0 | åˆç‰ˆä½œæˆ | Claude |

---

## é€£çµ¡å…ˆãƒ»ãƒªã‚½ãƒ¼ã‚¹

| é …ç›® | URL |
|------|-----|
| **æœ¬ç•ªã‚µã‚¤ãƒˆ** | https://gasgenerator.onrender.com |
| **LP** | https://taskmateai.net |
| **ã‚·ã‚¹ãƒ†ãƒ ã‚«ã‚¿ãƒ­ã‚°** | https://gasgenerator.onrender.com/systems/catalog |
| **GitHub** | https://github.com/IKEMENLTD/gasgenerator |
| **é–‹ç™ºãƒ­ã‚°** | `CLAUDE.md`ï¼ˆ2530è¡Œï¼‰ |
| **ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** | `ARCHITECTURE.md`ï¼ˆæœ¬ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ |

---

## ğŸ“Œ é‡è¦ãªæ³¨æ„äº‹é …

### ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½ç½®ã¥ã‘

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€TaskMateãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**æŠ€è¡“çš„çœŸå®Ÿã®æºï¼ˆSource of Truthï¼‰**ã§ã™ã€‚æ–°è¦é–‹ç™ºè€…ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ã‚·ã‚¹ãƒ†ãƒ ä¿å®ˆã€æ©Ÿèƒ½æ‹¡å¼µã®è¨­è¨ˆã«ãŠã„ã¦ã€ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’**æœ€å„ªå…ˆã§å‚ç…§**ã—ã¦ãã ã•ã„ã€‚

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ãƒ«ãƒ¼ãƒ«

1. **ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã¨ã®åŒæœŸ**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´æ™‚ã¯å¿…ãšæ›´æ–°
2. **æ¤œè¨¼**: è¿½åŠ ãƒ»ä¿®æ­£æ™‚ã¯å®Ÿæ¸¬å€¤ã‚’ç¢ºèªï¼ˆgrepã€duã€å®Ÿãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼ï¼‰
3. **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: å¤‰æ›´å±¥æ­´ã«å¿…ãšè¨˜éŒ²
4. **çŸ›ç›¾ã®å›é¿**: CLAUDE.mdã¨ã®æ•´åˆæ€§ã‚’ä¿ã¤

### æ¬¡å›æ›´æ–°æ™‚ã®ç¢ºèªäº‹é …

- [ ] ã‚·ã‚¹ãƒ†ãƒ æ•°ãŒ39ã®ã¾ã¾ï¼ˆå‰Šé™¤ãƒ»è¿½åŠ ãªã—ï¼‰
- [ ] ç’°å¢ƒå¤‰æ•°ãŒ44å€‹ã®ã¾ã¾ï¼ˆè¿½åŠ ã‚ã‚Œã°æ›´æ–°ï¼‰
- [ ] package.jsonã®ä¾å­˜é–¢ä¿‚å¤‰æ›´åæ˜ 
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚ºå®Ÿæ¸¬ï¼ˆdu -shï¼‰
- [ ] migrationè¿½åŠ åæ˜ 
- [ ] APIæ–™é‡‘å¤‰æ›´åæ˜ ï¼ˆClaude/Geminiï¼‰
- [ ] Redisç¨¼åƒçŠ¶æ³ç¢ºèªï¼ˆREDIS_URLè¨­å®šæœ‰ç„¡ï¼‰
- [ ] SendGridå‰Šé™¤å®Ÿæ–½ç¢ºèª

---

**End of Document**
