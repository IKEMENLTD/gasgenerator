# ğŸš¨ NETLIFY BASE DIRECTORY ä¿®æ­£æ‰‹é †

## ğŸ¯ æ ¹æœ¬åŸå› 

**å•é¡Œ:** NetlifyãŒ**ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆ**ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹ãŸã‚ã€`netlify-tracking/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç„¡è¦–ã•ã‚Œã¦ã„ã‚‹ã€‚

**çµæœ:**
- âŒ `netlify-tracking/netlify.toml` ãŒèª­ã¾ã‚Œãªã„
- âŒ `netlify-tracking/netlify/functions/track-redirect.js` ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œãªã„
- âŒ ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒªãƒ³ã‚¯ (`/t/xxxxx`) ãŒ 404 ã‚¨ãƒ©ãƒ¼

---

## âœ… ä¿®æ­£æ–¹æ³•ï¼ˆ5åˆ†ã§å®Œäº†ï¼‰

### **ã‚¹ãƒ†ãƒƒãƒ— 1: Netlify Dashboard ã‚’é–‹ã**

1. https://app.netlify.com/ ã«ãƒ­ã‚°ã‚¤ãƒ³
2. **gasgenerator** ã‚µã‚¤ãƒˆã‚’é–‹ãï¼ˆã¾ãŸã¯ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ç”¨ã®ã‚µã‚¤ãƒˆï¼‰

### **ã‚¹ãƒ†ãƒƒãƒ— 2: Build settings ã‚’å¤‰æ›´**

1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ **Site settings** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. **Build & deploy** â†’ **Build settings** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **Edit settings** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®š:

```
Base directory: netlify-tracking
Build command: (ç©ºæ¬„ã®ã¾ã¾)
Publish directory: .
```

5. **Save** ã‚’ã‚¯ãƒªãƒƒã‚¯

### **ã‚¹ãƒ†ãƒƒãƒ— 3: Functions directory ã‚’ç¢ºèª**

åŒã˜ Build settings ãƒšãƒ¼ã‚¸ã§:

```
Functions directory: netlify/functions
```

ã“ã‚ŒãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã€‚ãªã‘ã‚Œã°è¿½åŠ ã€‚

### **ã‚¹ãƒ†ãƒƒãƒ— 4: å†ãƒ‡ãƒ—ãƒ­ã‚¤**

1. **Deploys** ã‚¿ãƒ–ã«æˆ»ã‚‹
2. **Trigger deploy** â†’ **Clear cache and deploy site** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…ã¤ï¼ˆ2-5åˆ†ï¼‰

---

## ğŸ“Š ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

### **1. Functions ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª**

Netlify Dashboard:
- **Functions** ã‚¿ãƒ–ã‚’é–‹ã
- ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš:
  ```
  track-redirect
  agency-auth
  agency-create-link
  agency-stats
  agency-links
  agency-billing-stats
  agency-commissions
  agency-analytics
  agency-settings
  agency-register
  agency-change-password
  agency-logout
  ```

### **2. ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒªãƒ³ã‚¯ã‚’ãƒ†ã‚¹ãƒˆ**

1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§æ–°ã—ã„ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
2. ä½œæˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ï¼ˆä¾‹: `https://your-site.netlify.app/t/abc123xyz`ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:**
   - âœ… LINEãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   - ã¾ãŸã¯ "Tracking Link Not Found" ãƒšãƒ¼ã‚¸ï¼ˆãƒªãƒ³ã‚¯ãŒDBã«å­˜åœ¨ã—ãªã„å ´åˆï¼‰

4. **404ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ:**
   - Base directory ã®è¨­å®šãŒåæ˜ ã•ã‚Œã¦ã„ãªã„
   - ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°ã‚’ç¢ºèª

### **3. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°ã‚’ç¢ºèª**

Netlify Dashboard â†’ **Deploys** â†’ æœ€æ–°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã‚¯ãƒªãƒƒã‚¯:

**æ­£å¸¸ãªãƒ­ã‚°ã®ä¾‹:**
```
1:23:45 PM: Build ready to start
1:23:47 PM: build-image version: ...
1:23:47 PM: Base directory: netlify-tracking
1:23:48 PM: Functions directory: netlify/functions
1:23:49 PM: Bundling functions...
1:23:50 PM: âœ“ track-redirect
1:23:50 PM: âœ“ agency-auth
1:23:50 PM: âœ“ agency-create-link
...
1:23:55 PM: Site is live
```

**ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã®ãƒ­ã‚°ä¾‹:**
```
1:23:45 PM: Base directory: (ç©ºæ¬„)
1:23:48 PM: Functions directory not found
```

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### **å•é¡Œ: Base directory ã‚’è¨­å®šã—ãŸã®ã«ã¾ã 404ãŒå‡ºã‚‹**

**åŸå› 1: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ®‹ã£ã¦ã„ã‚‹**

è§£æ±ºæ–¹æ³•:
1. **Deploys** â†’ **Trigger deploy** â†’ **Clear cache and deploy site**

**åŸå› 2: ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„**

ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª:
- `SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY`
- `JWT_SECRET`
- `LINE_OFFICIAL_URL`

**åŸå› 3: ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰ãŒDBã«å­˜åœ¨ã—ãªã„**

è§£æ±ºæ–¹æ³•:
1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§**æ–°ã—ã„ãƒªãƒ³ã‚¯ã‚’ä½œæˆ**
2. æ–°ã—ã„ãƒªãƒ³ã‚¯ã§ãƒ†ã‚¹ãƒˆ

---

## ğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ç¢ºèª

### **Build settings ç”»é¢**

æ­£ã—ã„è¨­å®š:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build settings                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Base directory                      â”‚
â”‚ netlify-tracking                    â”‚ â† é‡è¦!
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Build command                       â”‚
â”‚ (ç©ºæ¬„)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Publish directory                   â”‚
â”‚ .                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Functions directory                 â”‚
â”‚ netlify/functions                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ç¢ºèª:

- [ ] Base directory ãŒ `netlify-tracking` ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Functions directory ãŒ `netlify/functions` ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ç’°å¢ƒå¤‰æ•°ãŒã™ã¹ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸ
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°ã« "Functions directory: netlify/functions" ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹
- [ ] Functions ã‚¿ãƒ–ã« `track-redirect` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹

ã™ã¹ã¦ãƒã‚§ãƒƒã‚¯ã§ããŸã‚‰ã€ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒªãƒ³ã‚¯ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„!

---

## ğŸ†˜ ã¾ã å•é¡ŒãŒã‚ã‚‹å ´åˆ

ä»¥ä¸‹ã®æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„:

1. **Netlify Dashboard â†’ Deploys â†’ æœ€æ–°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°**
   - `Base directory:` ã®è¡Œã‚’ã‚³ãƒ”ãƒ¼
   - `Functions directory:` ã®è¡Œã‚’ã‚³ãƒ”ãƒ¼

2. **Netlify Dashboard â†’ Functions**
   - è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹Functionä¸€è¦§ã‚’ã‚³ãƒ”ãƒ¼

3. **å®Ÿéš›ã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒªãƒ³ã‚¯URL**
   - ä¾‹: `https://your-site.netlify.app/t/abc123xyz`

4. **ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°**
   - F12 â†’ Console ã‚¿ãƒ–ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ã“ã‚Œã‚‰ã®æƒ…å ±ãŒã‚ã‚Œã°ã€ã•ã‚‰ã«è©³ã—ãè¨ºæ–­ã§ãã¾ã™ã€‚
