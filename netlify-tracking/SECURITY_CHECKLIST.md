# セキュリティチェックリスト

## 環境変数
- [ ] ✅ JWT_SECRETは32文字以上のランダムな文字列
- [ ] ✅ Supabase Service Role Keyは環境変数でのみ管理
- [ ] ✅ 本番環境と開発環境で異なるキーを使用
- [ ] ✅ .envファイルは.gitignoreに追加済み

## 認証・認可
- [ ] ✅ パスワードはbcryptでハッシュ化（salt rounds: 10）
- [ ] ✅ JWTトークンの有効期限設定（7日間）
- [ ] ✅ 代理店ステータスチェック（pending/active/rejected/suspended）
- [ ] ✅ ユーザーアカウントのis_activeチェック
- [ ] ✅ 各APIエンドポイントで適切な認証チェック

## データベース
- [ ] ✅ Row Level Security (RLS)ポリシー設定
- [ ] ✅ 代理店は自分のデータのみアクセス可能
- [ ] ✅ SQLインジェクション対策（パラメータ化クエリ使用）
- [ ] ✅ ステータス変更履歴の記録

## API セキュリティ
- [ ] ✅ CORS設定（本番環境では特定ドメインのみ許可推奨）
- [ ] ✅ HTTPSの強制
- [ ] ✅ レート制限の実装（Netlify標準機能）
- [ ] ✅ エラーメッセージで内部情報を漏らさない

## フロントエンド
- [ ] ✅ XSS対策（Alpine.jsの自動エスケープ）
- [ ] ✅ 機密情報をlocalStorageに保存しない（トークンのみ）
- [ ] ✅ CSRFトークンの実装（必要に応じて）

## 監査・ログ
- [ ] ✅ 代理店ステータス変更履歴
- [ ] ✅ ログイン履歴（last_login_at）
- [ ] ✅ エラーログの適切な記録
- [ ] ✅ 機密情報をログに出力しない

## デプロイ前チェック
- [ ] 環境変数が正しく設定されている
- [ ] デバッグログが無効化されている
- [ ] テストアカウントが削除または無効化されている
- [ ] バックアップ体制が整っている

## 定期メンテナンス
- [ ] 依存パッケージの定期更新
- [ ] セキュリティパッチの適用
- [ ] パスワードポリシーの見直し
- [ ] アクセスログの定期監査

## 緊急時対応
- [ ] インシデント対応手順書の作成
- [ ] データバックアップとリストア手順
- [ ] 不正アクセス時の代理店アカウント一時停止手順
- [ ] 連絡体制の確立

## 推奨追加実装
1. **2要素認証（2FA）**
   - TOTP対応
   - SMS認証

2. **IPアドレス制限**
   - 管理画面へのアクセス制限
   - 異常なアクセスパターンの検知

3. **セッション管理**
   - 同時ログイン制限
   - 自動ログアウト機能

4. **暗号化**
   - 機密データの暗号化保存
   - 通信の完全HTTPS化

5. **監査ログ強化**
   - 全操作の記録
   - 改ざん防止措置