<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMate AI - 代理店管理システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 to-green-50 min-h-screen" x-data="agencyDashboard()" x-init="init()" x-cloak>
    <!-- ログイン画面 -->
    <div x-show="!isAuthenticated && !showRegister" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md border border-emerald-100">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-emerald-600 to-green-600 rounded-full mb-4">
                    <i class="fas fa-chart-line text-3xl text-white"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900">代理店管理システム</h1>
                <p class="text-gray-600 mt-2">TaskMate AI パートナーポータル</p>
            </div>

            <form @submit.prevent="login()" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">メールアドレス</label>
                    <input type="email" x-model="loginForm.email" autocomplete="email" required
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                           placeholder="agency@example.com">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">パスワード</label>
                    <input type="password" x-model="loginForm.password" autocomplete="current-password" required
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                           placeholder="••••••••">
                </div>

                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" x-model="loginForm.remember" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                        <span class="ml-2 text-sm text-gray-600">ログイン状態を保持</span>
                    </label>
                    <a href="/agency/reset-password.html" class="text-sm text-emerald-600 hover:text-emerald-700">パスワードを忘れた方</a>
                </div>

                <button type="submit" :disabled="loading"
                        class="w-full bg-gradient-to-r from-emerald-600 to-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-emerald-700 hover:to-green-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span x-show="!loading">ログイン</span>
                    <span x-show="loading" class="inline-flex items-center">
                        <i class="fas fa-spinner fa-spin mr-2"></i> ログイン中...
                    </span>
                </button>

                <div x-show="loginError" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                    <span x-text="loginError"></span>
                </div>
            </form>

            <div class="mt-8 pt-6 border-t border-gray-200 text-center">
                <p class="text-sm text-gray-600">
                    代理店登録をご希望の方は
                    <button @click="showRegister = true" class="text-emerald-600 hover:text-emerald-700 font-medium">こちら</button>
                </p>
            </div>
        </div>
    </div>

    <!-- 新規登録画面 -->
    <div x-show="!isAuthenticated && showRegister" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-lg border border-emerald-100">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-emerald-600 to-green-600 rounded-full mb-4">
                    <i class="fas fa-user-plus text-3xl text-white"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900">代理店新規登録</h1>
                <p class="text-gray-600 mt-2">TaskMate AI パートナー登録</p>
            </div>

            <form @submit.prevent="register()" class="space-y-4">
                <!-- 会社情報 -->
                <div class="space-y-4 pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-700">会社情報</h3>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">会社名 *</label>
                        <input type="text" x-model="registerForm.company_name" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="株式会社〇〇">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">代理店名 *</label>
                        <input type="text" x-model="registerForm.agency_name" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="〇〇営業所">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">住所</label>
                        <input type="text" x-model="registerForm.address"
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="東京都〇〇区...">
                    </div>
                </div>

                <!-- 担当者情報 -->
                <div class="space-y-4 pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-700">担当者情報</h3>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">担当者名 *</label>
                        <input type="text" x-model="registerForm.contact_name" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="山田太郎">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">メールアドレス *</label>
                        <input type="email" x-model="registerForm.email" autocomplete="email" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="contact@company.com">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">電話番号 *</label>
                        <input type="tel" x-model="registerForm.phone" autocomplete="tel" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="03-1234-5678">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">パスワード *</label>
                        <input type="password" x-model="registerForm.password" autocomplete="new-password" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="8文字以上で入力">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">パスワード（確認）*</label>
                        <input type="password" x-model="registerForm.password_confirm" autocomplete="new-password" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="もう一度入力">
                    </div>
                </div>

                <!-- 利用規約 -->
                <div>
                    <label class="flex items-start">
                        <input type="checkbox" x-model="registerForm.agree_terms" required
                               class="mt-1 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                        <span class="ml-2 text-sm text-gray-600">
                            <a href="#" class="text-emerald-600 hover:text-emerald-700">利用規約</a>および
                            <a href="#" class="text-emerald-600 hover:text-emerald-700">プライバシーポリシー</a>
                            に同意します
                        </span>
                    </label>
                </div>

                <button type="submit" :disabled="loading"
                        class="w-full bg-gradient-to-r from-emerald-600 to-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-emerald-700 hover:to-green-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span x-show="!loading">登録する</span>
                    <span x-show="loading" class="inline-flex items-center">
                        <i class="fas fa-spinner fa-spin mr-2"></i> 登録中...
                    </span>
                </button>

                <div x-show="registerError" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                    <span x-text="registerError"></span>
                </div>

                <div x-show="registerSuccess" class="bg-emerald-50 border border-emerald-200 text-emerald-700 px-4 py-3 rounded-lg">
                    <i class="fas fa-check-circle mr-2"></i>
                    <span>登録が完了しました！ログイン画面に移動します...</span>
                </div>
            </form>

            <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                <p class="text-sm text-gray-600">
                    既にアカウントをお持ちの方は
                    <button @click="showRegister = false" class="text-emerald-600 hover:text-emerald-700 font-medium">ログイン</button>
                </p>
            </div>
        </div>
    </div>

    <!-- ダッシュボード -->
    <div x-show="isAuthenticated" class="min-h-screen">
        <!-- ヘッダー -->
        <header class="bg-white shadow-sm border-b border-emerald-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="inline-flex items-center justify-center w-10 h-10 bg-gradient-to-br from-emerald-600 to-green-600 rounded-full">
                            <i class="fas fa-chart-line text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900">TaskMate AI 代理店システム</h1>
                            <p class="text-sm text-gray-600" x-text="`${agencyInfo.name} - ${userInfo.name}さん`"></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <p class="text-sm text-gray-600">今月の成果</p>
                            <p class="text-lg font-bold text-emerald-600" x-text="`¥${stats.monthlyCommission.toLocaleString()}`"></p>
                        </div>
                        <button @click="logout()"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i> ログアウト
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- メインコンテンツ -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- 統計カード -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">作成リンク数</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="stats.totalLinks"></p>
                        </div>
                        <div class="bg-emerald-100 rounded-full p-3">
                            <i class="fas fa-link text-emerald-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">総クリック数</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="stats.totalClicks"></p>
                        </div>
                        <div class="bg-green-100 rounded-full p-3">
                            <i class="fas fa-mouse-pointer text-green-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">コンバージョン数</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="stats.totalConversions"></p>
                        </div>
                        <div class="bg-green-100 rounded-full p-3">
                            <i class="fas fa-users text-green-700"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">コンバージョン率</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="`${stats.conversionRate}%`"></p>
                        </div>
                        <div class="bg-emerald-100 rounded-full p-3">
                            <i class="fas fa-percentage text-emerald-700"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- タブメニュー -->
            <div class="bg-white rounded-xl shadow-lg border border-emerald-100 mb-8">
                <div class="border-b border-emerald-100">
                    <nav class="flex space-x-8 px-6" aria-label="Tabs">
                        <button @click="activeTab = 'create'"
                                :class="activeTab === 'create' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-plus-circle mr-2"></i> リンク作成
                        </button>
                        <button @click="activeTab = 'links'; loadLinks()"
                                :class="activeTab === 'links' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-link mr-2"></i> リンク管理
                        </button>
                        <button @click="activeTab = 'analytics'; loadAnalytics()"
                                :class="activeTab === 'analytics' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-chart-bar mr-2"></i> 分析
                        </button>
                        <button @click="activeTab = 'commissions'; loadCommissions()"
                                :class="activeTab === 'commissions' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-yen-sign mr-2"></i> 報酬
                        </button>
                        <button @click="activeTab = 'settings'"
                                :class="activeTab === 'settings' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-cog mr-2"></i> 設定
                        </button>
                    </nav>
                </div>

                <!-- リンク作成タブ -->
                <div x-show="activeTab === 'create'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">新規トラッキングリンク作成</h2>

                    <form @submit.prevent="createLink()" class="space-y-4 max-w-2xl">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">キャンペーン名 *</label>
                            <input type="text" x-model="newLink.name" required
                                   class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                   placeholder="例: 2024年春のキャンペーン">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">流入元（UTM Source）</label>
                                <input type="text" x-model="newLink.utm_source"
                                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                       placeholder="例: facebook, twitter, line">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">メディア（UTM Medium）</label>
                                <input type="text" x-model="newLink.utm_medium"
                                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                       placeholder="例: social, email, banner">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">キャンペーン（UTM Campaign）</label>
                            <input type="text" x-model="newLink.utm_campaign"
                                   class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                   placeholder="例: spring_sale_2024">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">LINE友達追加URL *</label>
                            <input type="url" x-model="newLink.line_friend_url" required
                                   class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                   placeholder="https://lin.ee/xxxxx">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">リダイレクト先URL（オプション）</label>
                            <input type="url" x-model="newLink.destination_url"
                                   class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                   placeholder="https://example.com/landing">
                            <p class="text-xs text-gray-500 mt-1">未入力の場合はLINE友達追加URLにリダイレクトされます</p>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" :disabled="loading"
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                <span x-show="!loading">リンクを作成</span>
                                <span x-show="loading">
                                    <i class="fas fa-spinner fa-spin mr-2"></i> 作成中...
                                </span>
                            </button>
                            <button type="button" @click="resetForm()"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-medium transition-colors">
                                リセット
                            </button>
                        </div>
                    </form>

                    <!-- 作成成功メッセージ -->
                    <div x-show="createdLink" class="mt-6 bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                        <p class="text-emerald-800 font-semibold mb-2">✅ トラッキングリンクを作成しました！</p>
                        <div class="flex items-center space-x-2">
                            <input type="text" :value="createdLink" readonly
                                   class="flex-1 px-3 py-2 bg-white border border-emerald-300 rounded-lg text-sm">
                            <button @click="copyToClipboard(createdLink)"
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-copy mr-2"></i> コピー
                            </button>
                        </div>
                    </div>
                </div>

                <!-- リンク管理タブ -->
                <div x-show="activeTab === 'links'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">作成済みリンク一覧</h2>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-emerald-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">キャンペーン名</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">トラッキングコード</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">クリック数</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">コンバージョン</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">作成日</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">アクション</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="link in trackingLinks" :key="link.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="link.name"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <code x-text="link.tracking_code" class="bg-gray-100 px-2 py-1 rounded"></code>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="link.visit_count"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="link.conversion_count"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatDate(link.created_at)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button @click="copyToClipboard(getTrackingUrl(link.tracking_code))"
                                                    class="bg-emerald-100 hover:bg-emerald-200 text-emerald-600 px-3 py-1 rounded-lg mr-2 transition-colors">
                                                <i class="fas fa-copy"></i> コピー
                                            </button>
                                            <button @click="viewLinkDetails(link)"
                                                    class="bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-1 rounded-lg transition-colors">
                                                <i class="fas fa-chart-line"></i> 詳細
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 分析タブ -->
                <div x-show="activeTab === 'analytics'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">パフォーマンス分析</h2>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 期間別パフォーマンス -->
                        <div class="bg-white rounded-lg border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">期間別パフォーマンス</h3>
                            <canvas id="performanceChart"></canvas>
                        </div>

                        <!-- コンバージョンファネル -->
                        <div class="bg-white rounded-lg border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">コンバージョンファネル</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-sm text-gray-600">クリック</span>
                                        <span class="text-sm font-semibold" x-text="stats.totalClicks"></span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-8">
                                        <div class="bg-emerald-600 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 100%">100%</div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-sm text-gray-600">LINE友達追加</span>
                                        <span class="text-sm font-semibold" x-text="stats.totalConversions"></span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-8">
                                        <div class="bg-green-600 h-8 rounded-full flex items-center justify-center text-white text-xs" :style="`width: ${stats.conversionRate}%`">
                                            <span x-text="`${stats.conversionRate}%`"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- トップパフォーマンスキャンペーン -->
                    <div class="mt-6 bg-white rounded-lg border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">トップパフォーマンスキャンペーン</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">順位</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">キャンペーン名</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">クリック数</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">コンバージョン</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CVR</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="(campaign, index) in topCampaigns" :key="campaign.id">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full"
                                                      :class="index === 0 ? 'bg-yellow-100 text-yellow-800' : index === 1 ? 'bg-gray-100 text-gray-800' : index === 2 ? 'bg-orange-100 text-orange-800' : 'bg-gray-50 text-gray-600'"
                                                      x-text="index + 1"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="campaign.name"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="campaign.clicks"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="campaign.conversions"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs rounded-full"
                                                      :class="campaign.cvr >= 10 ? 'bg-green-100 text-green-800' : campaign.cvr >= 5 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'"
                                                      x-text="`${campaign.cvr}%`"></span>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 報酬タブ -->
                <div x-show="activeTab === 'commissions'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">報酬管理</h2>

                    <!-- 報酬サマリー -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-gradient-to-r from-emerald-500 to-green-600 rounded-xl p-6 text-white">
                            <p class="text-sm opacity-90">今月の報酬（予定）</p>
                            <p class="text-3xl font-bold mt-2" x-text="`¥${stats.monthlyCommission.toLocaleString()}`"></p>
                            <p class="text-xs mt-2 opacity-75">手数料率: <span x-text="`${agencyInfo.commission_rate}%`"></span></p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <p class="text-sm text-gray-600">前月の報酬</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="`¥${stats.lastMonthCommission.toLocaleString()}`"></p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <p class="text-sm text-gray-600">累計報酬</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="`¥${stats.totalCommission.toLocaleString()}`"></p>
                        </div>
                    </div>

                    <!-- 報酬履歴 -->
                    <div class="bg-white rounded-lg border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">報酬履歴</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">期間</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">コンバージョン数</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">売上</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">手数料率</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">報酬額</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ステータス</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">支払日</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="commission in commissions" :key="commission.id">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="commission.period"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="commission.conversions"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="`¥${commission.sales.toLocaleString()}`"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="`${commission.rate}%`"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900" x-text="`¥${commission.amount.toLocaleString()}`"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs rounded-full"
                                                      :class="commission.status === 'paid' ? 'bg-green-100 text-green-800' : commission.status === 'approved' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'"
                                                      x-text="getStatusLabel(commission.status)"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="commission.payment_date || '-'"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 設定タブ -->
                <div x-show="activeTab === 'settings'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">アカウント設定</h2>

                    <div class="max-w-2xl space-y-6">
                        <!-- 代理店情報 -->
                        <div class="bg-white rounded-lg border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">代理店情報</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">代理店コード</label>
                                    <input type="text" :value="agencyInfo.code" readonly
                                           class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">会社名</label>
                                    <input type="text" x-model="agencyInfo.company_name"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">連絡先メールアドレス</label>
                                    <input type="email" x-model="agencyInfo.contact_email"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">電話番号</label>
                                    <input type="tel" x-model="agencyInfo.contact_phone"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                            </div>
                        </div>

                        <!-- 振込先情報 -->
                        <div class="bg-white rounded-lg border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">振込先情報</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">銀行名</label>
                                    <input type="text" x-model="paymentInfo.bank_name"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">支店名</label>
                                    <input type="text" x-model="paymentInfo.branch_name"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">口座種別</label>
                                    <select x-model="paymentInfo.account_type"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                        <option value="普通">普通</option>
                                        <option value="当座">当座</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">口座番号</label>
                                    <input type="text" x-model="paymentInfo.account_number"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">口座名義</label>
                                    <input type="text" x-model="paymentInfo.account_holder"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button @click="saveSettings()"
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                                <i class="fas fa-save mr-2"></i> 設定を保存
                            </button>
                            <button @click="cancelSettings()"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-medium transition-colors">
                                キャンセル
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>