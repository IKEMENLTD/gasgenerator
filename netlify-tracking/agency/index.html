<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMate AI - ‰ª£ÁêÜÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <!-- ‚ö†Ô∏è „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë≠¶Âëä: cdn.tailwindcss.com„ÅØJIT„Ç≥„É≥„Éë„Ç§„É©„ÅÆ„Åü„ÇÅSRIÊú™ÂØæÂøú -->
    <!-- Êú¨Áï™Áí∞Â¢É„Åß„ÅØ„Éì„É´„ÉâÊôÇ„Å´Tailwind CSS„Çí„Ç≥„É≥„Éë„Ç§„É´„Åó„Å¶‰ΩøÁî®„Åô„Çã„Åì„Å®„ÇíÂº∑„ÅèÊé®Â•® -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js with SRI (Subresource Integrity) -->
    <!-- üîß DEBUGGING: SRI temporarily removed to check if it's blocking Alpine.js -->
    <script src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"
            crossorigin="anonymous"
            defer></script>
    <!-- Original with SRI (restore after debugging):
    <script src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"
            integrity="sha384-xw/ARJaqXKsFgDt0AhxLQ65mGvCjEjWEReZ6OqiLWJUlIi8y+4zOjsJgYY6YGDX0"
            crossorigin="anonymous"
            defer></script>
    -->

    <!-- Font Awesome with SRI -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer">
    <style>
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 to-green-50 min-h-screen" x-data="agencyDashboard()" x-init="init()" x-cloak>
    <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
    <div x-show="!isAuthenticated && !showRegister" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md border border-emerald-100">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-emerald-600 to-green-600 rounded-full mb-4">
                    <i class="fas fa-chart-line text-3xl text-white"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900">‰ª£ÁêÜÂ∫óÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</h1>
                <p class="text-gray-600 mt-2">TaskMate AI „Éë„Éº„Éà„Éä„Éº„Éù„Éº„Çø„É´</p>
            </div>

            <form @submit.prevent="login()" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                    <input type="email" x-model="loginForm.email" autocomplete="email" required
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                           placeholder="agency@example.com">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" x-model="loginForm.password" autocomplete="current-password" required
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" x-model="loginForm.remember" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                        <span class="ml-2 text-sm text-gray-600">„É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„Çí‰øùÊåÅ</span>
                    </label>
                    <a href="/agency/reset-password.html" class="text-sm text-emerald-600 hover:text-emerald-700">„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂøò„Çå„ÅüÊñπ</a>
                </div>

                <button type="submit" :disabled="loading"
                        class="w-full bg-gradient-to-r from-emerald-600 to-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-emerald-700 hover:to-green-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span x-show="!loading">„É≠„Ç∞„Ç§„É≥</span>
                    <span x-show="loading" class="inline-flex items-center">
                        <i class="fas fa-spinner fa-spin mr-2"></i> „É≠„Ç∞„Ç§„É≥‰∏≠...
                    </span>
                </button>

                <div x-show="loginError" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                    <span x-text="loginError"></span>
                </div>
            </form>

            <div class="mt-8 pt-6 border-t border-gray-200 text-center space-y-3">
                <p class="text-sm text-gray-600">
                    ‰ª£ÁêÜÂ∫óÁôªÈå≤„Çí„ÅîÂ∏åÊúõ„ÅÆÊñπ„ÅØ
                    <button @click="showRegister = true" class="text-emerald-600 hover:text-emerald-700 font-medium">„Åì„Å°„Çâ</button>
                </p>
                <p class="text-sm text-gray-600">
                    <a href="/" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-arrow-left mr-1"></i> „É°„Ç§„É≥„Éö„Éº„Ç∏„Å´Êàª„Çã
                    </a>
                </p>
            </div>
        </div>
    </div>

    <!-- Êñ∞Ë¶èÁôªÈå≤ÁîªÈù¢ -->
    <div x-show="!isAuthenticated && showRegister" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-lg border border-emerald-100">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-emerald-600 to-green-600 rounded-full mb-4">
                    <i class="fas fa-user-plus text-3xl text-white"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900">‰ª£ÁêÜÂ∫óÊñ∞Ë¶èÁôªÈå≤</h1>
                <p class="text-gray-600 mt-2">TaskMate AI „Éë„Éº„Éà„Éä„ÉºÁôªÈå≤</p>
            </div>

            <form @submit.prevent="register()" class="space-y-4">
                <!-- ‰ºöÁ§æÊÉÖÂ†± -->
                <div class="space-y-4 pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-700">‰ºöÁ§æÊÉÖÂ†±</h3>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‰ºöÁ§æÂêç *</label>
                        <input type="text" x-model="registerForm.company_name" autocomplete="organization" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="Ê†™Âºè‰ºöÁ§æ„Äá„Äá">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‰ª£ÁêÜÂ∫óÂêç *</label>
                        <input type="text" x-model="registerForm.agency_name" autocomplete="organization" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="„Äá„ÄáÂñ∂Ê•≠ÊâÄ">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‰ΩèÊâÄ</label>
                        <input type="text" x-model="registerForm.address" autocomplete="street-address"
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="Êù±‰∫¨ÈÉΩ„Äá„ÄáÂå∫...">
                    </div>
                </div>

                <!-- ÊãÖÂΩìËÄÖÊÉÖÂ†± -->
                <div class="space-y-4 pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-700">ÊãÖÂΩìËÄÖÊÉÖÂ†±</h3>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÊãÖÂΩìËÄÖÂêç *</label>
                        <input type="text" x-model="registerForm.contact_name" autocomplete="name" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="Â±±Áî∞Â§™ÈÉé">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ *</label>
                        <input type="email" x-model="registerForm.email" autocomplete="email" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="contact@company.com">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÈõªË©±Áï™Âè∑ *</label>
                        <input type="tel" x-model="registerForm.phone" autocomplete="tel" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="03-1234-5678">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">„Éë„Çπ„ÉØ„Éº„Éâ *</label>
                        <input type="password" x-model="registerForm.password" autocomplete="new-password" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="8ÊñáÂ≠ó‰ª•‰∏ä„ÅßÂÖ•Âäõ">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">„Éë„Çπ„ÉØ„Éº„ÉâÔºàÁ¢∫Ë™çÔºâ*</label>
                        <input type="password" x-model="registerForm.password_confirm" autocomplete="new-password" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                               placeholder="„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÂÖ•Âäõ">
                    </div>
                </div>

                <!-- Âà©Áî®Ë¶èÁ¥Ñ -->
                <div>
                    <label class="flex items-start">
                        <input type="checkbox" x-model="registerForm.agree_terms" required
                               class="mt-1 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                        <span class="ml-2 text-sm text-gray-600">
                            <a href="terms.html" target="_blank" class="text-emerald-600 hover:text-emerald-700">Âà©Áî®Ë¶èÁ¥Ñ</a>„Åä„Çà„Å≥
                            <a href="privacy.html" target="_blank" class="text-emerald-600 hover:text-emerald-700">„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº</a>
                            „Å´ÂêåÊÑè„Åó„Åæ„Åô
                        </span>
                    </label>
                </div>

                <button type="submit" :disabled="loading"
                        class="w-full bg-gradient-to-r from-emerald-600 to-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-emerald-700 hover:to-green-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span x-show="!loading">ÁôªÈå≤„Åô„Çã</span>
                    <span x-show="loading" class="inline-flex items-center">
                        <i class="fas fa-spinner fa-spin mr-2"></i> ÁôªÈå≤‰∏≠...
                    </span>
                </button>

                <div x-show="registerError" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                    <span x-text="registerError"></span>
                </div>

                <div x-show="registerSuccess" class="bg-emerald-50 border border-emerald-200 text-emerald-700 px-4 py-3 rounded-lg">
                    <i class="fas fa-check-circle mr-2"></i>
                    <span>ÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Å´ÁßªÂãï„Åó„Åæ„Åô...</span>
                </div>
            </form>

            <div class="mt-6 pt-4 border-t border-gray-200 text-center space-y-3">
                <p class="text-sm text-gray-600">
                    Êó¢„Å´„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„ÅÆÊñπ„ÅØ
                    <button @click="showRegister = false" class="text-emerald-600 hover:text-emerald-700 font-medium">„É≠„Ç∞„Ç§„É≥</button>
                </p>
                <p class="text-sm text-gray-600">
                    <a href="/" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-arrow-left mr-1"></i> „É°„Ç§„É≥„Éö„Éº„Ç∏„Å´Êàª„Çã
                    </a>
                </p>
            </div>
        </div>
    </div>

    <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
    <div x-show="isAuthenticated" class="min-h-screen">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="bg-white shadow-sm border-b border-emerald-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="inline-flex items-center justify-center w-10 h-10 bg-gradient-to-br from-emerald-600 to-green-600 rounded-full">
                            <i class="fas fa-chart-line text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900">TaskMate AI ‰ª£ÁêÜÂ∫ó„Ç∑„Çπ„ÉÜ„É†</h1>
                            <p class="text-sm text-gray-600" x-text="`${agencyInfo.name} - ${userInfo.name}„Åï„Çì`"></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <p class="text-sm text-gray-600">‰ªäÊúà„ÅÆÊàêÊûú</p>
                            <p class="text-lg font-bold text-emerald-600" x-text="`¬•${stats.monthlyCommission.toLocaleString()}`"></p>
                        </div>
                        <a href="/"
                           class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors border border-gray-300 inline-flex items-center">
                            <i class="fas fa-home mr-2"></i> „É°„Ç§„É≥„Éö„Éº„Ç∏
                        </a>
                        <button @click="logout()"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i> „É≠„Ç∞„Ç¢„Ç¶„Éà
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Áµ±Ë®à„Ç´„Éº„Éâ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">‰ΩúÊàê„É™„É≥„ÇØÊï∞</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="stats.totalLinks"></p>
                        </div>
                        <div class="bg-emerald-100 rounded-full p-3">
                            <i class="fas fa-link text-emerald-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Á∑è„ÇØ„É™„ÉÉ„ÇØÊï∞</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="stats.totalClicks"></p>
                        </div>
                        <div class="bg-green-100 rounded-full p-3">
                            <i class="fas fa-mouse-pointer text-green-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥Êï∞</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="stats.totalConversions"></p>
                        </div>
                        <div class="bg-green-100 rounded-full p-3">
                            <i class="fas fa-users text-green-700"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥Áéá</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="`${stats.conversionRate}%`"></p>
                        </div>
                        <div class="bg-emerald-100 rounded-full p-3">
                            <i class="fas fa-percentage text-emerald-700"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- „Çø„Éñ„É°„Éã„É•„Éº -->
            <div class="bg-white rounded-xl shadow-lg border border-emerald-100 mb-8">
                <div class="border-b border-emerald-100">
                    <nav class="flex space-x-8 px-6" aria-label="Tabs">
                        <button @click="activeTab = 'create'"
                                :class="activeTab === 'create' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-plus-circle mr-2"></i> „É™„É≥„ÇØ‰ΩúÊàê
                        </button>
                        <button @click="activeTab = 'links'; loadTrackingLinks()"
                                :class="activeTab === 'links' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-link mr-2"></i> „É™„É≥„ÇØÁÆ°ÁêÜ
                        </button>
                        <button @click="activeTab = 'analytics'; loadAnalytics()"
                                :class="activeTab === 'analytics' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-chart-bar mr-2"></i> ÂàÜÊûê
                        </button>
                        <button @click="activeTab = 'commissions'; loadCommissions()"
                                :class="activeTab === 'commissions' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-yen-sign mr-2"></i> Â†±ÈÖ¨
                        </button>
                        <button @click="activeTab = 'billing'; loadBillingStats()"
                                :class="activeTab === 'billing' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-credit-card mr-2"></i> Ë™≤ÈáëÁä∂Ê≥Å
                        </button>
                        <button @click="activeTab = 'settings'"
                                :class="activeTab === 'settings' ? 'border-emerald-500 text-emerald-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                            <i class="fas fa-cog mr-2"></i> Ë®≠ÂÆö
                        </button>
                    </nav>
                </div>

                <!-- „É™„É≥„ÇØ‰ΩúÊàê„Çø„Éñ -->
                <div x-show="activeTab === 'create'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Êñ∞Ë¶è„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„É™„É≥„ÇØ‰ΩúÊàê</h2>

                    <form @submit.prevent="createLink()" class="space-y-4 max-w-2xl">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">„Ç≠„É£„É≥„Éö„Éº„É≥Âêç *</label>
                            <input type="text" x-model="newLink.name" autocomplete="off" required
                                   class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                   placeholder="‰æã: 2024Âπ¥Êò•„ÅÆ„Ç≠„É£„É≥„Éö„Éº„É≥">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÊµÅÂÖ•ÂÖÉÔºàUTM SourceÔºâ</label>
                                <input type="text" x-model="newLink.utm_source" autocomplete="off"
                                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                       placeholder="‰æã: facebook, twitter, line">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">„É°„Éá„Ç£„Ç¢ÔºàUTM MediumÔºâ</label>
                                <input type="text" x-model="newLink.utm_medium" autocomplete="off"
                                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                       placeholder="‰æã: social, email, banner">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">„Ç≠„É£„É≥„Éö„Éº„É≥ÔºàUTM CampaignÔºâ</label>
                            <input type="text" x-model="newLink.utm_campaign" autocomplete="off"
                                   class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                   placeholder="‰æã: spring_sale_2024">
                        </div>

                        <!-- Info: LINE URL is automatically set from environment -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-start">
                                <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                                <div>
                                    <p class="text-sm text-blue-800 font-medium">„É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÂÖà„Å´„Å§„ÅÑ„Å¶</p>
                                    <p class="text-sm text-blue-700 mt-1">„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„É™„É≥„ÇØ„ÅØËá™ÂãïÁöÑ„Å´TaskMateÂÖ¨ÂºèLINE„Ç¢„Ç´„Ç¶„É≥„Éà„Å∏„É™„ÉÄ„Ç§„É¨„ÇØ„Éà„Åï„Çå„Åæ„Åô„ÄÇ</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" :disabled="loading"
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                <span x-show="!loading">„É™„É≥„ÇØ„Çí‰ΩúÊàê</span>
                                <span x-show="loading">
                                    <i class="fas fa-spinner fa-spin mr-2"></i> ‰ΩúÊàê‰∏≠...
                                </span>
                            </button>
                            <button type="button" @click="resetForm()"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-medium transition-colors">
                                „É™„Çª„ÉÉ„Éà
                            </button>
                        </div>
                    </form>

                    <!-- ‰ΩúÊàêÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏ -->
                    <div x-show="createdLink" class="mt-6 bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                        <p class="text-emerald-800 font-semibold mb-2">‚úÖ „Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„É™„É≥„ÇØ„Çí‰ΩúÊàê„Åó„Åæ„Åó„ÅüÔºÅ</p>
                        <div class="flex items-center space-x-2">
                            <input type="text" :value="createdLink" readonly
                                   class="flex-1 px-3 py-2 bg-white border border-emerald-300 rounded-lg text-sm">
                            <button @click="copyToClipboard(createdLink, $event)"
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-copy mr-2"></i> „Ç≥„Éî„Éº
                            </button>
                        </div>
                    </div>
                </div>

                <!-- „É™„É≥„ÇØÁÆ°ÁêÜ„Çø„Éñ -->
                <div x-show="activeTab === 'links'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">‰ΩúÊàêÊ∏à„Åø„É™„É≥„ÇØ‰∏ÄË¶ß</h2>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-emerald-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„Ç≠„É£„É≥„Éö„Éº„É≥Âêç</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„Ç≥„Éº„Éâ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„ÇØ„É™„ÉÉ„ÇØÊï∞</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‰ΩúÊàêÊó•</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="link in trackingLinks" :key="link.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="link.name"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <code x-text="link.tracking_code" class="bg-gray-100 px-2 py-1 rounded"></code>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="link.visit_count"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="link.conversion_count"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatDate(link.created_at)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button @click="copyToClipboard(getTrackingUrl(link.tracking_code), $event)"
                                                    class="bg-emerald-100 hover:bg-emerald-200 text-emerald-600 px-3 py-1 rounded-lg mr-2 transition-colors">
                                                <i class="fas fa-copy"></i> „Ç≥„Éî„Éº
                                            </button>
                                            <button @click="viewLinkDetails(link)"
                                                    class="bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-1 rounded-lg transition-colors">
                                                <i class="fas fa-chart-line"></i> Ë©≥Á¥∞
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ÂàÜÊûê„Çø„Éñ -->
                <div x-show="activeTab === 'analytics'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂàÜÊûê</h2>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- ÊúüÈñìÂà•„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ -->
                        <div class="bg-white rounded-lg border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">ÊúüÈñìÂà•„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</h3>
                            <canvas id="performanceChart"></canvas>
                        </div>

                        <!-- „Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥„Éï„Ç°„Éç„É´ -->
                        <div class="bg-white rounded-lg border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥„Éï„Ç°„Éç„É´</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-sm text-gray-600">„ÇØ„É™„ÉÉ„ÇØ</span>
                                        <span class="text-sm font-semibold" x-text="stats.totalClicks"></span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-8">
                                        <div class="bg-emerald-600 h-8 rounded-full flex items-center justify-center text-white text-xs" style="width: 100%">100%</div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-sm text-gray-600">LINEÂèãÈÅîËøΩÂä†</span>
                                        <span class="text-sm font-semibold" x-text="stats.totalConversions"></span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-8">
                                        <div class="bg-green-600 h-8 rounded-full flex items-center justify-center text-white text-xs" :style="`width: ${stats.conversionRate}%`">
                                            <span x-text="`${stats.conversionRate}%`"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- „Éà„ÉÉ„Éó„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Ç≠„É£„É≥„Éö„Éº„É≥ -->
                    <div class="mt-6 bg-white rounded-lg border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">„Éà„ÉÉ„Éó„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Ç≠„É£„É≥„Éö„Éº„É≥</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">È†Ü‰Ωç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç≠„É£„É≥„Éö„Éº„É≥Âêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„ÇØ„É™„ÉÉ„ÇØÊï∞</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CVR</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="(campaign, index) in topCampaigns" :key="campaign.id">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full"
                                                      :class="index === 0 ? 'bg-yellow-100 text-yellow-800' : index === 1 ? 'bg-gray-100 text-gray-800' : index === 2 ? 'bg-orange-100 text-orange-800' : 'bg-gray-50 text-gray-600'"
                                                      x-text="index + 1"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="campaign.name"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="campaign.clicks"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="campaign.conversions"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs rounded-full"
                                                      :class="campaign.cvr >= 10 ? 'bg-green-100 text-green-800' : campaign.cvr >= 5 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'"
                                                      x-text="`${campaign.cvr}%`"></span>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Â†±ÈÖ¨„Çø„Éñ -->
                <div x-show="activeTab === 'commissions'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Â†±ÈÖ¨ÁÆ°ÁêÜ</h2>

                    <!-- Â†±ÈÖ¨„Çµ„Éû„É™„Éº -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-gradient-to-r from-emerald-500 to-green-600 rounded-xl p-6 text-white">
                            <p class="text-sm opacity-90">‰ªäÊúà„ÅÆÂ†±ÈÖ¨Ôºà‰∫àÂÆöÔºâ</p>
                            <p class="text-3xl font-bold mt-2" x-text="`¬•${stats.monthlyCommission.toLocaleString()}`"></p>
                            <p class="text-xs mt-2 opacity-75">ÊâãÊï∞ÊñôÁéá: <span x-text="`${agencyInfo.commission_rate}%`"></span></p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <p class="text-sm text-gray-600">ÂâçÊúà„ÅÆÂ†±ÈÖ¨</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="`¬•${stats.lastMonthCommission.toLocaleString()}`"></p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <p class="text-sm text-gray-600">Á¥ØË®àÂ†±ÈÖ¨</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="`¬•${stats.totalCommission.toLocaleString()}`"></p>
                        </div>
                    </div>

                    <!-- Â†±ÈÖ¨Â±•Ê≠¥ -->
                    <div class="bg-white rounded-lg border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Â†±ÈÖ¨Â±•Ê≠¥</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊúüÈñì</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥Êï∞</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â£≤‰∏ä</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊâãÊï∞ÊñôÁéá</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â†±ÈÖ¨È°ç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊîØÊâïÊó•</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="commission in commissions" :key="commission.id">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="commission.period"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="commission.conversions"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="`¬•${commission.sales.toLocaleString()}`"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="`${commission.rate}%`"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900" x-text="`¬•${commission.amount.toLocaleString()}`"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs rounded-full"
                                                      :class="commission.status === 'paid' ? 'bg-green-100 text-green-800' : commission.status === 'approved' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'"
                                                      x-text="getStatusLabel(commission.status)"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="commission.payment_date || '-'"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Ë™≤ÈáëÁä∂Ê≥Å„Çø„Éñ -->
                <div x-show="activeTab === 'billing'" class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900">Á¥π‰ªã„É¶„Éº„Ç∂„Éº„ÅÆË™≤ÈáëÁä∂Ê≥Å</h2>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-600">ÊúÄÁµÇÊõ¥Êñ∞: <span x-text="billingStats.lastUpdated ? formatDateTime(billingStats.lastUpdated) : '-'"></span></span>
                            <button @click="loadBillingStats()"
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i> Êõ¥Êñ∞
                            </button>
                        </div>
                    </div>

                    <!-- „Çµ„Éû„É™„Éº„Ç´„Éº„Éâ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl p-6 text-white">
                            <p class="text-sm opacity-90">ÁèæÂú®„ÅÆË™≤Èáë‰∏≠„É¶„Éº„Ç∂„Éº</p>
                            <p class="text-3xl font-bold mt-2" x-text="billingStats.summary?.activeSubscribers || 0"></p>
                            <p class="text-xs mt-2 opacity-75">
                                <i class="fas fa-check-circle mr-1"></i> „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥
                            </p>
                        </div>

                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <p class="text-sm text-gray-600">Á∑è„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥Êï∞</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="billingStats.summary?.totalConversions || 0"></p>
                            <p class="text-xs mt-2 text-gray-500">
                                <i class="fas fa-user-plus mr-1"></i> LINEÂèãÈÅîËøΩÂä†Ê∏à„Åø
                            </p>
                        </div>

                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <p class="text-sm text-gray-600">Á¥ØË®àÂ†±ÈÖ¨Ôºà‰∫àÂÆöÔºâ</p>
                            <p class="text-2xl font-bold text-emerald-600 mt-2" x-text="`¬•${(billingStats.summary?.totalCommission || 0).toLocaleString()}`"></p>
                            <p class="text-xs mt-2 text-gray-500">
                                <i class="fas fa-calculator mr-1"></i> ÊâãÊï∞ÊñôÁéá: <span x-text="`${billingStats.summary?.commissionRate || 0}%`"></span>
                            </p>
                        </div>

                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <p class="text-sm text-gray-600">ÊîØÊâï„ÅÑÊ∏à„ÅøÂ†±ÈÖ¨</p>
                            <p class="text-2xl font-bold text-gray-900 mt-2" x-text="`¬•${(billingStats.summary?.paidCommission || 0).toLocaleString()}`"></p>
                            <p class="text-xs mt-2 text-gray-500">
                                <i class="fas fa-check mr-1"></i> Á¢∫ÂÆöÊ∏à„Åø
                            </p>
                        </div>
                    </div>

                    <!-- ÂÄãÂà•„É¶„Éº„Ç∂„Éº„ÅÆË™≤ÈáëÁä∂ÊÖã„ÉÜ„Éº„Éñ„É´ -->
                    <div class="bg-white rounded-lg border border-gray-200">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">ÂÄãÂà•„É¶„Éº„Ç∂„Éº„ÅÆË™≤ÈáëÁä∂ÊÖã</h3>
                            <p class="text-sm text-gray-600 mt-1">„ÅÇ„Å™„Åü„ÅåÁ¥π‰ªã„Åó„Åü„É¶„Éº„Ç∂„Éº„ÅÆ„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥Áä∂Ê≥Å„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô</p>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„É¶„Éº„Ç∂„ÉºÂêç</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ë™≤ÈáëÈñãÂßãÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÁµÇ‰∫Ü‰∫àÂÆöÊó•</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">„Éó„É¨„Éü„Ç¢„É†</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‰∫àÂÆöÂ†±ÈÖ¨</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-if="!billingStats.billingUsers || billingStats.billingUsers.length === 0">
                                        <tr>
                                            <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                                <i class="fas fa-inbox text-3xl mb-2"></i>
                                                <p>„Åæ„Å†Ë™≤Èáë„É¶„Éº„Ç∂„Éº„Åå„ÅÑ„Åæ„Åõ„Çì</p>
                                                <p class="text-sm mt-1">„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„É™„É≥„ÇØ„Çí‰ΩúÊàê„Åó„Å¶„ÄÅ„É¶„Éº„Ç∂„Éº„ÇíÁ¥π‰ªã„Åó„Åæ„Åó„Çá„ÅÜÔºÅ</p>
                                            </td>
                                        </tr>
                                    </template>
                                    <template x-for="user in billingStats.billingUsers" :key="user.userId">
                                        <tr class="hover:bg-gray-50" :class="user.isActive ? 'bg-green-50' : ''">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-10 w-10 bg-gradient-to-br from-emerald-400 to-green-500 rounded-full flex items-center justify-center text-white font-semibold">
                                                        <span x-text="user.displayName?.charAt(0) || '?'"></span>
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-gray-900" x-text="user.displayName"></div>
                                                        <div class="text-xs text-gray-500" x-text="`ID: ${user.userId.substring(0, 8)}...`"></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-3 py-1 text-xs font-semibold rounded-full"
                                                      :class="{
                                                          'bg-green-100 text-green-800': user.subscriptionStatus === 'active',
                                                          'bg-blue-100 text-blue-800': user.subscriptionStatus === 'trialing',
                                                          'bg-yellow-100 text-yellow-800': user.subscriptionStatus === 'past_due',
                                                          'bg-red-100 text-red-800': user.subscriptionStatus === 'canceled',
                                                          'bg-gray-100 text-gray-800': user.subscriptionStatus === 'free' || !user.subscriptionStatus
                                                      }">
                                                    <i class="fas fa-circle mr-1" :class="user.isActive ? 'fa-pulse' : ''"></i>
                                                    <span x-text="getSubscriptionStatusLabel(user.subscriptionStatus)"></span>
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <template x-if="user.subscriptionStartedAt">
                                                    <span x-text="formatDate(user.subscriptionStartedAt)"></span>
                                                </template>
                                                <template x-if="!user.subscriptionStartedAt">
                                                    <span class="text-gray-400">-</span>
                                                </template>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <template x-if="user.subscriptionEndDate">
                                                    <span x-text="formatDate(user.subscriptionEndDate)"></span>
                                                </template>
                                                <template x-if="!user.subscriptionEndDate && user.isActive">
                                                    <span class="text-green-600">Á∂ôÁ∂ö‰∏≠</span>
                                                </template>
                                                <template x-if="!user.subscriptionEndDate && !user.isActive">
                                                    <span class="text-gray-400">-</span>
                                                </template>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                                <template x-if="user.isPremium">
                                                    <span class="text-yellow-600">
                                                        <i class="fas fa-crown mr-1"></i> „Éó„É¨„Éü„Ç¢„É†
                                                    </span>
                                                </template>
                                                <template x-if="!user.isPremium">
                                                    <span class="text-gray-400">-</span>
                                                </template>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold">
                                                <template x-if="user.commission > 0">
                                                    <span class="text-emerald-600" x-text="`¬•${user.commission.toLocaleString()}`"></span>
                                                </template>
                                                <template x-if="user.commission === 0">
                                                    <span class="text-gray-400">¬•0</span>
                                                </template>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Ëá™ÂãïÊõ¥Êñ∞ÈÄöÁü• -->
                    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                            <div>
                                <p class="text-sm text-blue-800 font-medium">„É™„Ç¢„É´„Çø„Ç§„É†Ëá™ÂãïÊõ¥Êñ∞</p>
                                <p class="text-sm text-blue-700 mt-1">„Åì„ÅÆ„Éö„Éº„Ç∏„ÅØ30Áßí„Åî„Å®„Å´Ëá™Âãï„ÅßÊúÄÊñ∞„ÅÆË™≤ÈáëÊÉÖÂ†±„Å´Êõ¥Êñ∞„Åï„Çå„Åæ„Åô„ÄÇÊâãÂãï„ÅßÊõ¥Êñ∞„Åó„Åü„ÅÑÂ†¥Âêà„ÅØ„ÄÅÂè≥‰∏ä„ÅÆ„ÄåÊõ¥Êñ∞„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ë®≠ÂÆö„Çø„Éñ -->
                <div x-show="activeTab === 'settings'" class="p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">„Ç¢„Ç´„Ç¶„É≥„ÉàË®≠ÂÆö</h2>

                    <div class="max-w-2xl space-y-6">
                        <!-- ‰ª£ÁêÜÂ∫óÊÉÖÂ†± -->
                        <div class="bg-white rounded-lg border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">‰ª£ÁêÜÂ∫óÊÉÖÂ†±</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‰ª£ÁêÜÂ∫ó„Ç≥„Éº„Éâ</label>
                                    <input type="text" :value="agencyInfo.code" readonly
                                           class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‰ºöÁ§æÂêç</label>
                                    <input type="text" x-model="agencyInfo.company_name" autocomplete="organization"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÈÄ£Áµ°ÂÖà„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                    <input type="email" x-model="agencyInfo.contact_email" autocomplete="email"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÈõªË©±Áï™Âè∑</label>
                                    <input type="tel" x-model="agencyInfo.contact_phone" autocomplete="tel"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                            </div>
                        </div>

                        <!-- ÊåØËæºÂÖàÊÉÖÂ†± -->
                        <div class="bg-white rounded-lg border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">ÊåØËæºÂÖàÊÉÖÂ†±</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÈäÄË°åÂêç</label>
                                    <input type="text" x-model="paymentInfo.bank_name" autocomplete="off"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊîØÂ∫óÂêç</label>
                                    <input type="text" x-model="paymentInfo.branch_name" autocomplete="off"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Âè£Â∫ßÁ®ÆÂà•</label>
                                    <select x-model="paymentInfo.account_type" autocomplete="off"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                        <option value="ÊôÆÈÄö">ÊôÆÈÄö</option>
                                        <option value="ÂΩìÂ∫ß">ÂΩìÂ∫ß</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Âè£Â∫ßÁï™Âè∑</label>
                                    <input type="text" x-model="paymentInfo.account_number" autocomplete="off"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Âè£Â∫ßÂêçÁæ©</label>
                                    <input type="text" x-model="paymentInfo.account_holder" autocomplete="name"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500">
                                </div>
                            </div>
                        </div>

                        <!-- „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë®≠ÂÆö -->
                        <div class="bg-white rounded-lg border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">„Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë®≠ÂÆö</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">„Éë„Çπ„ÉØ„Éº„Éâ</p>
                                        <p class="text-sm text-gray-500">ÂÆöÊúüÁöÑ„Å´„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂ§âÊõ¥„Åó„Å¶„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÇíÂº∑Âåñ„Åó„Åæ„Åó„Çá„ÅÜ</p>
                                    </div>
                                    <button @click="openChangePasswordModal()"
                                            class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors border border-gray-300">
                                        <i class="fas fa-key mr-2"></i> „Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button @click="saveSettings()"
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                                <i class="fas fa-save mr-2"></i> Ë®≠ÂÆö„Çí‰øùÂ≠ò
                            </button>
                            <button @click="cancelSettings()"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-medium transition-colors">
                                „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- „É™„É≥„ÇØË©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
    <div x-show="linkDetailsModal"
         x-cloak
         class="fixed inset-0 z-50 overflow-y-auto"
         @click.self="closeLinkDetailsModal()">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- ËÉåÊôØ„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
            <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75" @click="closeLinkDetailsModal()"></div>

            <!-- „É¢„Éº„ÉÄ„É´„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
                <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                <div class="bg-gradient-to-r from-emerald-600 to-green-600 px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-chart-line text-white"></i>
                            </div>
                            <h3 class="ml-3 text-lg font-semibold text-white">„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„É™„É≥„ÇØË©≥Á¥∞</h3>
                        </div>
                        <button @click="closeLinkDetailsModal()" class="text-white hover:text-gray-200 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>

                <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                <div class="px-6 py-6 max-h-[70vh] overflow-y-auto">
                    <template x-if="selectedLink">
                        <div class="space-y-6">
                            <!-- Âü∫Êú¨ÊÉÖÂ†± -->
                            <div class="bg-gradient-to-r from-emerald-50 to-green-50 rounded-lg p-6 border border-emerald-200">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4">
                                    <i class="fas fa-info-circle text-emerald-600 mr-2"></i>Âü∫Êú¨ÊÉÖÂ†±
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-600 mb-1">„Ç≠„É£„É≥„Éö„Éº„É≥Âêç</label>
                                        <p class="text-base font-semibold text-gray-900" x-text="selectedLink.name"></p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-600 mb-1">‰ΩúÊàêÊó•</label>
                                        <p class="text-base text-gray-900" x-text="formatDateTime(selectedLink.created_at)"></p>
                                    </div>
                                    <div class="col-span-full">
                                        <label class="block text-sm font-medium text-gray-600 mb-1">„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞URL</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="text" :value="getTrackingUrl(selectedLink.tracking_code)" readonly
                                                   class="flex-1 px-3 py-2 bg-white border border-emerald-300 rounded-lg text-sm font-mono">
                                            <button @click="copyToClipboard(getTrackingUrl(selectedLink.tracking_code), $event)"
                                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg transition-colors whitespace-nowrap">
                                                <i class="fas fa-copy mr-2"></i>„Ç≥„Éî„Éº
                                            </button>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-600 mb-1">„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„Ç≥„Éº„Éâ</label>
                                        <code class="inline-block bg-gray-100 px-3 py-1 rounded text-sm" x-text="selectedLink.tracking_code"></code>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-600 mb-1">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                                              :class="selectedLink.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                            <i :class="selectedLink.is_active ? 'fas fa-check-circle' : 'fas fa-times-circle'" class="mr-1"></i>
                                            <span x-text="selectedLink.is_active ? 'ÊúâÂäπ' : 'ÁÑ°Âäπ'"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊåáÊ®ô -->
                            <div class="bg-white rounded-lg border border-gray-200 p-6">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4">
                                    <i class="fas fa-chart-bar text-emerald-600 mr-2"></i>„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ
                                </h4>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <div class="text-center p-4 bg-emerald-50 rounded-lg">
                                        <p class="text-sm text-gray-600 mb-1">„ÇØ„É™„ÉÉ„ÇØÊï∞</p>
                                        <p class="text-2xl font-bold text-emerald-600" x-text="selectedLink.visit_count || 0"></p>
                                    </div>
                                    <div class="text-center p-4 bg-green-50 rounded-lg">
                                        <p class="text-sm text-gray-600 mb-1">„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥</p>
                                        <p class="text-2xl font-bold text-green-600" x-text="selectedLink.conversion_count || 0"></p>
                                    </div>
                                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                                        <p class="text-sm text-gray-600 mb-1">CVR</p>
                                        <p class="text-2xl font-bold text-blue-600" x-text="calculateCVR() + '%'"></p>
                                    </div>
                                    <div class="text-center p-4 bg-yellow-50 rounded-lg">
                                        <p class="text-sm text-gray-600 mb-1">‰∫àÊÉ≥Â†±ÈÖ¨</p>
                                        <p class="text-2xl font-bold text-yellow-600" x-text="'¬•' + calculateCommission()"></p>
                                    </div>
                                </div>
                            </div>

                            <!-- UTM„Éë„É©„É°„Éº„Çø -->
                            <div class="bg-white rounded-lg border border-gray-200 p-6">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4">
                                    <i class="fas fa-tags text-emerald-600 mr-2"></i>UTM„Éë„É©„É°„Éº„Çø
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-600 mb-1">UTM Source</label>
                                        <p class="text-sm text-gray-900" x-text="selectedLink.utm_source || '-'"></p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-600 mb-1">UTM Medium</label>
                                        <p class="text-sm text-gray-900" x-text="selectedLink.utm_medium || '-'"></p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-600 mb-1">UTM Campaign</label>
                                        <p class="text-sm text-gray-900" x-text="selectedLink.utm_campaign || '-'"></p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-600 mb-1">UTM Term</label>
                                        <p class="text-sm text-gray-900" x-text="selectedLink.utm_term || '-'"></p>
                                    </div>
                                    <div class="col-span-full">
                                        <label class="block text-sm font-medium text-gray-600 mb-1">UTM Content</label>
                                        <p class="text-sm text-gray-900" x-text="selectedLink.utm_content || '-'"></p>
                                    </div>
                                </div>
                            </div>

                            <!-- ÊúÄËøë„ÅÆË®™ÂïèÂ±•Ê≠¥ -->
                            <div class="bg-white rounded-lg border border-gray-200 p-6">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4">
                                    <i class="fas fa-history text-emerald-600 mr-2"></i>ÊúÄËøë„ÅÆË®™ÂïèÂ±•Ê≠¥
                                </h4>
                                <template x-if="linkVisits.length > 0">
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-gray-50">
                                                <tr>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Êó•ÊôÇ</th>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">„Éá„Éê„Ç§„Çπ</th>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">„Éñ„É©„Ç¶„Ç∂</th>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">OS</th>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">„É™„Éï„Ç°„É©„Éº</th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white divide-y divide-gray-200">
                                                <template x-for="visit in linkVisits" :key="visit.id">
                                                    <tr>
                                                        <td class="px-4 py-2 whitespace-nowrap text-xs text-gray-900" x-text="formatDateTime(visit.created_at)"></td>
                                                        <td class="px-4 py-2 whitespace-nowrap text-xs">
                                                            <span class="px-2 py-1 rounded-full text-xs"
                                                                  :class="{
                                                                      'bg-blue-100 text-blue-800': visit.device_type === 'mobile',
                                                                      'bg-purple-100 text-purple-800': visit.device_type === 'tablet',
                                                                      'bg-gray-100 text-gray-800': visit.device_type === 'desktop'
                                                                  }"
                                                                  x-text="visit.device_type || 'unknown'"></span>
                                                        </td>
                                                        <td class="px-4 py-2 whitespace-nowrap text-xs text-gray-900" x-text="visit.browser || '-'"></td>
                                                        <td class="px-4 py-2 whitespace-nowrap text-xs text-gray-900" x-text="visit.os || '-'"></td>
                                                        <td class="px-4 py-2 text-xs text-gray-600 truncate max-w-xs" x-text="visit.referrer || '-'"></td>
                                                    </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>
                                </template>
                                <template x-if="linkVisits.length === 0">
                                    <div class="text-center py-8 text-gray-500">
                                        <i class="fas fa-inbox text-3xl mb-2"></i>
                                        <p>„Åæ„Å†Ë®™ÂïèÂ±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- „Éï„ÉÉ„Çø„Éº („Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥) -->
                <div class="bg-gray-50 px-6 py-4 flex flex-wrap gap-3 justify-between items-center">
                    <div class="flex gap-2">
                        <button @click="toggleLinkStatus(selectedLink)"
                                class="px-4 py-2 rounded-lg font-medium transition-colors"
                                :class="selectedLink?.is_active ? 'bg-red-100 hover:bg-red-200 text-red-700' : 'bg-green-100 hover:bg-green-200 text-green-700'">
                            <i :class="selectedLink?.is_active ? 'fas fa-ban' : 'fas fa-check-circle'" class="mr-2"></i>
                            <span x-text="selectedLink?.is_active ? 'ÁÑ°ÂäπÂåñ' : 'ÊúâÂäπÂåñ'"></span>
                        </button>
                        <button @click="deleteLinkWithConfirm(selectedLink)"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="fas fa-trash mr-2"></i>ÂâäÈô§
                        </button>
                    </div>
                    <button @click="closeLinkDetailsModal()"
                            class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-medium transition-colors">
                        Èñâ„Åò„Çã
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- „Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥„É¢„Éº„ÉÄ„É´ -->
    <div x-show="changePasswordModal"
         x-cloak
         class="fixed inset-0 z-50 overflow-y-auto"
         @click.self="closeChangePasswordModal()">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- ËÉåÊôØ„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
            <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75" @click="closeChangePasswordModal()"></div>

            <!-- „É¢„Éº„ÉÄ„É´„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                <div class="bg-gradient-to-r from-emerald-600 to-green-600 px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-key text-white"></i>
                            </div>
                            <h3 class="ml-3 text-lg font-semibold text-white">„Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥</h3>
                        </div>
                        <button @click="closeChangePasswordModal()" class="text-white hover:text-gray-200 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>

                <!-- „Éï„Ç©„Éº„É† -->
                <form @submit.prevent="changePassword()" class="px-6 py-4">
                    <div class="space-y-4">
                        <!-- ÁèæÂú®„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ÁèæÂú®„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ *
                            </label>
                            <div class="relative">
                                <input :type="showCurrentPassword ? 'text' : 'password'"
                                       x-model="changePasswordForm.currentPassword"
                                       required
                                       class="w-full px-4 py-3 pr-10 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                       placeholder="ÁèæÂú®„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
                                <button type="button"
                                        @click="showCurrentPassword = !showCurrentPassword"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <i :class="showCurrentPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Êñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Êñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ *
                            </label>
                            <div class="relative">
                                <input :type="showNewPassword ? 'text' : 'password'"
                                       x-model="changePasswordForm.newPassword"
                                       required
                                       minlength="8"
                                       class="w-full px-4 py-3 pr-10 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                       placeholder="8ÊñáÂ≠ó‰ª•‰∏ä„ÅßÂÖ•Âäõ"
                                       @input="checkPasswordStrength()">
                                <button type="button"
                                        @click="showNewPassword = !showNewPassword"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <i :class="showNewPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                </button>
                            </div>
                            <!-- „Éë„Çπ„ÉØ„Éº„ÉâÂº∑Â∫¶„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
                            <div x-show="changePasswordForm.newPassword.length > 0" class="mt-2">
                                <div class="flex items-center space-x-2">
                                    <div class="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="h-full transition-all duration-300"
                                             :class="{
                                                 'w-1/4 bg-red-500': passwordStrength === 'weak',
                                                 'w-2/4 bg-yellow-500': passwordStrength === 'medium',
                                                 'w-3/4 bg-green-500': passwordStrength === 'strong',
                                                 'w-full bg-emerald-600': passwordStrength === 'very-strong'
                                             }"></div>
                                    </div>
                                    <span class="text-xs font-medium"
                                          :class="{
                                              'text-red-600': passwordStrength === 'weak',
                                              'text-yellow-600': passwordStrength === 'medium',
                                              'text-green-600': passwordStrength === 'strong',
                                              'text-emerald-600': passwordStrength === 'very-strong'
                                          }"
                                          x-text="passwordStrengthLabel"></span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Ëã±Â§ßÊñáÂ≠ó„ÄÅËã±Â∞èÊñáÂ≠ó„ÄÅÊï∞Â≠ó„ÄÅË®òÂè∑„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Çã„Å®Âº∑Â∫¶„Åå‰∏ä„Åå„Çä„Åæ„Åô</p>
                            </div>
                        </div>

                        <!-- Êñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„ÉâÔºàÁ¢∫Ë™çÔºâ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Êñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„ÉâÔºàÁ¢∫Ë™çÔºâ*
                            </label>
                            <div class="relative">
                                <input :type="showConfirmPassword ? 'text' : 'password'"
                                       x-model="changePasswordForm.confirmPassword"
                                       required
                                       class="w-full px-4 py-3 pr-10 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                                       placeholder="„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÂÖ•Âäõ">
                                <button type="button"
                                        @click="showConfirmPassword = !showConfirmPassword"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <i :class="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                </button>
                            </div>
                            <!-- „Éë„Çπ„ÉØ„Éº„Éâ‰∏ÄËá¥„ÉÅ„Çß„ÉÉ„ÇØ -->
                            <div x-show="changePasswordForm.confirmPassword.length > 0" class="mt-2">
                                <p class="text-xs"
                                   :class="changePasswordForm.newPassword === changePasswordForm.confirmPassword ? 'text-green-600' : 'text-red-600'">
                                    <i :class="changePasswordForm.newPassword === changePasswordForm.confirmPassword ? 'fas fa-check-circle' : 'fas fa-times-circle'"></i>
                                    <span x-text="changePasswordForm.newPassword === changePasswordForm.confirmPassword ? '„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Åæ„Åô' : '„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì'"></span>
                                </p>
                            </div>
                        </div>

                        <!-- „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏ -->
                        <div x-show="changePasswordError"
                             class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-circle mr-2"></i>
                                <span x-text="changePasswordError"></span>
                            </div>
                        </div>

                        <!-- ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏ -->
                        <div x-show="changePasswordSuccess"
                             class="bg-emerald-50 border border-emerald-200 text-emerald-700 px-4 py-3 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle mr-2"></i>
                                <span>„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£Â∏∏„Å´Â§âÊõ¥„Åï„Çå„Åæ„Åó„Åü</span>
                            </div>
                        </div>
                    </div>

                    <!-- „Éú„Çø„É≥ -->
                    <div class="mt-6 flex space-x-3">
                        <button type="submit"
                                :disabled="loading"
                                class="flex-1 bg-gradient-to-r from-emerald-600 to-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-emerald-700 hover:to-green-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span x-show="!loading">
                                <i class="fas fa-check mr-2"></i> Â§âÊõ¥„Åô„Çã
                            </span>
                            <span x-show="loading" class="inline-flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Â§âÊõ¥‰∏≠...
                            </span>
                        </button>
                        <button type="button"
                                @click="closeChangePasswordModal()"
                                :disabled="loading"
                                class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„Éº„Éè„É≥„Éâ„É© -->
    <script>
        // Alpine.js„ÅÆÂàùÊúüÂåñ„Çí„É≠„Ç∞
        console.log('üì¶ Scripts loading...');

        // „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„Éº„Éè„É≥„Éâ„É©
        window.addEventListener('error', function(event) {
            console.error('‚ùå Global error caught:',  {
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                error: event.error
            });

            // „Ç®„É©„Éº„ÇíÁîªÈù¢„Å´Ë°®Á§∫Ôºà„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: #fee; color: #c00; padding: 20px; z-index: 99999; font-family: monospace; font-size: 12px; max-height: 300px; overflow: auto;';
            errorDiv.innerHTML = `
                <strong>‚ùå „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü</strong><br>
                <strong>„É°„ÉÉ„Çª„Éº„Ç∏:</strong> ${event.message}<br>
                <strong>„Éï„Ç°„Ç§„É´:</strong> ${event.filename}<br>
                <strong>Ë°å:</strong> ${event.lineno}:${event.colno}<br>
                <strong>„Çπ„Çø„ÉÉ„ÇØ:</strong> ${event.error ? event.error.stack : '„Å™„Åó'}<br>
                <button onclick="this.parentElement.remove()" style="margin-top: 10px; padding: 5px 10px; background: #c00; color: white; border: none; cursor: pointer;">Èñâ„Åò„Çã</button>
            `;
            document.body.appendChild(errorDiv);
        });

        // Uncaught Promise„Ç®„É©„Éº„Éè„É≥„Éâ„É©
        window.addEventListener('unhandledrejection', function(event) {
            console.error('‚ùå Unhandled promise rejection:', event.reason);

            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: #fea; color: #840; padding: 20px; z-index: 99999; font-family: monospace; font-size: 12px; max-height: 300px; overflow: auto;';
            errorDiv.innerHTML = `
                <strong>‚ö†Ô∏è  Promise „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü</strong><br>
                <strong>ÁêÜÁî±:</strong> ${event.reason}<br>
                <button onclick="this.parentElement.remove()" style="margin-top: 10px; padding: 5px 10px; background: #840; color: white; border: none; cursor: pointer;">Èñâ„Åò„Çã</button>
            `;
            document.body.appendChild(errorDiv);
        });

        // Alpine.js„ÅÆÂàùÊúüÂåñ„ÇíÁõ£Ë¶ñ
        document.addEventListener('alpine:init', () => {
            console.log('üéâ Alpine.js initialized successfully!');
        });

        document.addEventListener('alpine:initializing', () => {
            console.log('üîÑ Alpine.js initializing...');
        });

        document.addEventListener('alpine:initialized', () => {
            console.log('‚úÖ Alpine.js fully initialized!');
        });

        // DOMContentLoadedÂæå„Å´Alpine.js„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM Content Loaded');

            // 3ÁßíÂæå„Å´Alpine.js„Åå„Åæ„Å†ÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØË≠¶Âëä
            setTimeout(() => {
                if (!window.Alpine) {
                    console.error('‚ùå Alpine.js is not loaded after 3 seconds!');
                    alert('Alpine.js„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                } else {
                    console.log('‚úÖ Alpine.js is loaded:', window.Alpine);
                }
            }, 3000);
        });
    </script>

    <!-- XSS Protection Utility -->
    <script src="xss-protection.js"></script>
    <script src="dashboard.js"></script>

    <!-- Final diagnostic check -->
    <script>
        console.log('üèÅ All inline scripts loaded');
        console.log('üìä Current state:', {
            agencyDashboard: typeof window.agencyDashboard,
            Alpine: typeof window.Alpine,
            XSSProtection: typeof window.XSSProtection
        });

        // Wait a bit and check if Alpine initialized
        setTimeout(() => {
            console.log('‚è∞ After 2 seconds:', {
                Alpine: typeof window.Alpine,
                AlpineReady: window.Alpine ? 'yes' : 'no'
            });

            if (!window.Alpine) {
                console.error('‚ùå‚ùå‚ùå Alpine.js is NOT loaded after 2 seconds! ‚ùå‚ùå‚ùå');
                console.error('This is likely why the page is white.');
                console.error('Possible causes:');
                console.error('1. Network error loading Alpine.js from CDN');
                console.error('2. SRI hash mismatch (we removed it, so not this)');
                console.error('3. Content Security Policy blocking the script');
                console.error('4. Browser extension blocking the CDN');

                // Show error on page
                document.body.innerHTML = `
                    <div style="padding: 40px; max-width: 800px; margin: 0 auto; font-family: sans-serif;">
                        <h1 style="color: #c00;">‚ùå Alpine.js Failed to Load</h1>
                        <p><strong>The page cannot initialize because Alpine.js did not load from the CDN.</strong></p>
                        <h2>Possible Solutions:</h2>
                        <ol>
                            <li>Check your internet connection</li>
                            <li>Check if a browser extension is blocking CDN resources</li>
                            <li>Check the browser console (F12) for network errors</li>
                            <li>Try disabling ad blockers or privacy extensions</li>
                            <li>Try a different browser</li>
                        </ol>
                        <h2>Technical Details:</h2>
                        <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow: auto;">
Alpine.js URL: https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js
Alpine.js loaded: No
agencyDashboard function: ${typeof window.agencyDashboard}
XSSProtection loaded: ${typeof window.XSSProtection}
                        </pre>
                        <button onclick="location.reload()" style="background: #10b981; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            üîÑ Reload Page
                        </button>
                    </div>
                `;
            } else {
                console.log('‚úÖ Alpine.js loaded successfully!');
            }
        }, 2000);
    </script>
</body>
</html>