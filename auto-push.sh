#!/bin/bash

# ========================================
# 自動Git追加・コミット・プッシュスクリプト
# 使用方法: ./auto-push.sh "コミットメッセージ"
# 例: ./auto-push.sh "Fix bug"
# メッセージなしで実行すると、デフォルトメッセージを使用
# ========================================

# スクリプトのディレクトリに移動
cd "$(dirname "$0")"

# コミットメッセージを取得（引数がない場合はデフォルト）
COMMIT_MSG="${1:-Auto commit and push}"

echo "========================================"
echo "Git 自動プッシュ開始"
echo "========================================"
echo

echo "[1/3] 変更をステージング中..."
if ! git add .; then
    echo "❌ エラー: ファイルの追加に失敗しました"
    exit 1
fi
echo "✅ ステージング完了"

echo
echo "[2/3] コミット中..."
echo "メッセージ: \"$COMMIT_MSG\""
if ! git commit -m "$COMMIT_MSG"; then
    echo "⚠️  変更がないか、コミットに失敗しました"
    echo "プッシュを続行します..."
fi
echo "✅ コミット完了"

echo
echo "[3/3] GitHubへプッシュ中..."
if ! git push origin main 2>&1; then
    echo "❌ エラー: プッシュに失敗しました"
    echo
    echo "トラブルシューティング:"
    echo "1. インターネット接続を確認してください"
    echo "2. GitHub認証情報を確認してください"
    exit 1
fi
echo "✅ プッシュ完了"

echo
echo "========================================"
echo "🎉 全ての変更がGitHubにプッシュされました！"
echo
echo "📡 Netlifyが自動的にデプロイを開始します"
echo "通常2-5分でデプロイが完了します"
echo "========================================"
echo
