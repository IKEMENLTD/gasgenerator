==============================================================================
                入金消込チェッカー 使い方説明書
==============================================================================

■ このシステムでできること
──────────────────────────────────────────────────
  請求書の発行から入金確認・消込までの一連の経理業務を、
  Googleスプレッドシートと連携したWebアプリで一元管理できます。

  ・請求データと入金データの自動突合（消込）
  ・銀行振込の名義から取引先を自動特定（マッチング）
  ・支払期限超過や未マッチ入金の自動アラート
  ・消込率の推移や取引先別の滞留状況をグラフで可視化
  ・督促前の入金済みチェック（誤督促の防止）
  ・月次の消込レポート自動生成
  ・CSV取込による入金データの一括登録
  ・PC・スマホ両対応（ハンバーガーメニュー搭載）

  すべてのデータはGoogleスプレッドシートに保存されるため、
  スプレッドシート側から直接データを確認・編集することも可能です。


■ スプレッドシートのシート構成
──────────────────────────────────────────────────
  アプリが使用するシートは以下の通りです。

  シート名                  内容
  ─────────────────────────────────────
  取引先マスタ              取引先の基本情報
  請求データ                発行した請求書の情報
  入金データ                銀行口座への入金記録
  消込履歴                  請求と入金の突合結果
  振込名義マッチングルール  振込名義→取引先の対応表
  督促チェックリスト        督促前チェックの実行結果
  アラートログ              システムが検知した異常
  月次消込サマリー          月ごとの消込集計
  取引先別消込状況          取引先ごとの消込状況
  設定                      システムの動作設定


==============================================================================
 1. 画面構成
==============================================================================

  画面上部のタブ（スマホではハンバーガーメニュー）で切り替えます。

  タブ名          概要
  ─────────────────────────────────────
  ダッシュボード  全体の状況をひと目で確認
  入金管理        入金の登録・CSV取込・マッチング
  請求管理        請求の登録・督促前チェック
  消込履歴        消込の実行履歴を確認
  取引先          取引先・マッチングルールの管理
  アラート        異常の確認と対応
  レポート        月次サマリー・督促チェック履歴
  設定            システムの動作設定


==============================================================================
 2. 基本の業務フロー
==============================================================================

  (1) 取引先を登録する
  (2) 請求を登録する
  (3) 入金を登録する（手動 or CSV取込）
  (4) 自動マッチング → 振込名義から取引先を特定
  (5) 自動消込 → 請求と入金を突合
      ↓
  ※ 自動で処理できなかったものだけ手動対応

  入金登録時に自動マッチング・自動消込が実行されます。
  手動で再実行したい場合は「入金管理」画面のボタンから実行できます。


==============================================================================
 3. ダッシュボード
==============================================================================

  アプリを開くと最初に表示される画面です。
  現在の経理状況が一覧できます。

  【サマリーカード（画面上部）】
  ・未消込件数 / 未消込金額
  ・消込率
  ・未マッチ入金件数
  ・期限超過件数
  ・本日の入金件数

  【グラフ】
  ・消込率推移 ……… 月ごとの消込率の変化
  ・取引先別滞留状況 … 取引先ごとの未消込金額

  【テーブル】
  ・未消込請求（期限順）… 支払期限が近い順に表示。消込ボタンあり
  ・未マッチ入金 ……… 取引先が特定できていない入金。マッチングボタンあり
  ・本日の入金 ……… 当日に登録された入金
  ・督促前チェック対象 … 期限超過で督促が必要な可能性がある請求


==============================================================================
 4. 取引先を登録する
==============================================================================

  【操作手順】
  1. 「取引先」タブを開く
  2. 「取引先登録」サブタブを選択
  3. 以下を入力する

     項目              必須  説明
     ──────────────────────────────────
     取引先名          *     会社名（例：株式会社ABC）
     担当者名                先方の担当者
     メールアドレス          連絡先メール
     電話番号                連絡先電話
     支払いサイト            翌月末 / 翌々月末 / 30日後 / 60日後 / 即日
     入金パターン            振込時の名義（後述）
     備考                    自由メモ

  4. 「取引先登録」ボタンを押す

  【入金パターンについて】
  銀行振込の際に表示される振込人名義を登録します。
  カンマ区切りで複数登録できます。

    例：株式会社ABCの場合
        → カ）ABC,ABC（株）,エービーシー

  正確に登録しておくと、入金時に自動で取引先が特定されます。
  あとから「マッチングルール」で追加・変更することも可能です。


==============================================================================
 5. 請求を登録する
==============================================================================

  【操作手順】
  1. 「請求管理」タブを開く
  2. 以下を入力する

     項目          必須  説明
     ──────────────────────────────────
     請求書番号    *     請求書のID（例：2024-001）
     取引先        *     プルダウンから選択
     請求金額      *     税込金額
     請求日        *     請求書の発行日
     支払期限      *     入金の締切日
     備考                自由メモ

  3. 「請求登録」ボタンを押す

  ※ 支払期限を正しく入力すると、期限超過アラートが正確に動作します。


==============================================================================
 6. 入金を登録する
==============================================================================

  方法は2通りあります。

  ── 方法A：手動登録 ──

  1. 「入金管理」タブを開く
  2. 以下を入力する

     項目          必須  説明
     ──────────────────────────────────
     入金日        *     銀行明細上の入金日
     振込名義      *     銀行明細に表示される名義（そのまま入力）
     入金金額      *     振込金額
     入金口座            三菱UFJ普通 / みずほ普通 / 三井住友普通 /
                         りそな普通 / ゆうちょ から選択
     備考                自由メモ

  3. 「入金登録」ボタンを押す

  ── 方法B：CSV一括取込 ──

  銀行のWebバンキングからダウンロードしたCSVを取り込めます。

  1. 「入金管理」タブの「CSV一括取込」エリアを使用
  2. CSVファイルを選択（フォーマット：入金日,振込名義,入金金額）
     例：2024/01/15,カ）ABC,100000
  3. 入金口座を選択
  4. 「CSVを取込」ボタンを押す

  【登録後の自動処理】
  入金を登録すると、以下が自動的に実行されます。
  ・自動マッチング：振込名義からルールに基づいて取引先を特定
  ・自動消込：マッチした取引先の未消込請求と金額を突合


==============================================================================
 7. 未マッチ入金を処理する（手動マッチング）
==============================================================================

  振込名義がルールに登録されていない場合、入金は「未マッチ」になります。

  【操作手順】
  1. ダッシュボードの「未マッチ入金」、
     または「入金管理」の入金一覧で「マッチング」ボタンを押す
  2. マッチングモーダルが開く
  3. 取引先をプルダウンから選択
  4. 「この名義をルールに追加」にチェック（推奨）
  5. 「マッチング実行」ボタンを押す

  ※ ルールに追加しておくと、次回から同じ名義は自動マッチングされます。


==============================================================================
 8. 手動で消込する
==============================================================================

  自動消込されなかった場合（金額差異が大きい、対応する入金がない等）
  に手動で消込を行います。

  【操作手順】
  1. ダッシュボードの「未消込請求」、
     または「請求管理」の請求一覧で「消込」ボタンを押す
  2. 消込モーダルが開く
  3. 以下を入力する
     ・入金データ：プルダウンから該当する入金を選択
     ・消込金額：自動入力される（変更可能）
     ・差額理由：振込手数料 / 値引き / 相殺 / その他 / なし
  4. 「消込実行」ボタンを押す


==============================================================================
 9. マッチングルールを管理する
==============================================================================

  振込名義と取引先の対応ルールを管理できます。

  【ルールの確認・追加】
  1. 「取引先」タブ →「マッチングルール」サブタブ
  2. 現在登録されているルール一覧が表示される
  3. 新規追加する場合：
     ・振込名義パターン（例：カ）ABC）
     ・取引先をプルダウンから選択
     ・優先度（数字が小さいほど優先）
  4. 「ルール追加」ボタンを押す

  ※ 手動マッチング時に「この名義をルールに追加」にチェックしても
     同じ結果になります。


==============================================================================
 10. 督促前チェック
==============================================================================

  督促メールを送る前に、実は入金済みかどうかを確認する機能です。
  誤って督促してしまうのを防げます。

  【操作手順】
  1. 「請求管理」タブを開く
  2. 「督促前チェック実行」ボタンを押す
  3. 結果がトースト通知で表示される

  【結果の確認場所】
  ・「レポート」タブ →「督促チェック履歴」サブタブ
  ・ダッシュボードの「督促前チェック対象」テーブル


==============================================================================
 11. アラートを確認・対応する
==============================================================================

  システムが自動で検知した異常を確認し、対応します。

  【アラートの種別】
  種別              意味
  ──────────────────────────────────
  未マッチ入金      取引先が特定できない入金がある
  一部入金          請求金額より少ない入金があった
  過入金            請求金額より多い入金があった
  期限超過未入金    支払期限を過ぎても入金がない

  【操作手順】
  1. 「アラート」タブを開く
  2. フィルタで絞り込み可能（未対応のみ / 種別別）
  3. 対応後、「解決」ボタンを押して完了にする

  ※ ダッシュボード上部にもアラートバナーが表示されます。


==============================================================================
 12. レポートを確認する
==============================================================================

  ── 月次サマリー ──

  1. 「レポート」タブ →「月次サマリー」サブタブ
  2. 月ごとの消込状況（請求件数、消込件数、消込率、金額等）が一覧表示
  3. 「今月分を生成」ボタンで最新データを反映

  ── 督促チェック履歴 ──

  1. 「レポート」タブ →「督促チェック履歴」サブタブ
  2. 過去に実行した督促前チェックの結果を確認


==============================================================================
 13. 消込履歴を確認する
==============================================================================

  過去の消込処理の記録を確認できます。

  1. 「消込履歴」タブを開く
  2. フィルタで絞り込み可能
     ・月でフィルタ（年月を選択）
     ・方法でフィルタ（自動消込 / 手動消込）


==============================================================================
 14. 取引先別の消込状況を確認する
==============================================================================

  1. 「取引先」タブ →「消込状況」サブタブ
  2. 取引先ごとの請求件数・消込率・未消込金額を一覧表示
  3. 「状況を更新」ボタンで最新データを反映


==============================================================================
 15. 設定
==============================================================================

  ── 基本設定 ──

  項目                      説明
  ──────────────────────────────────
  振込手数料許容額（円）    この金額以下の差額は振込手数料とみなし
                            自動消込する（初期値：660円）
  期限超過アラート日数      支払期限から何日後にアラートを出すか
                            （初期値：7日）
  自動マッチング            有効 / 無効

  ── 通知設定 ──

  項目                      説明
  ──────────────────────────────────
  アラート送信先メール      アラート発生時のメール通知先
                            （カンマ区切りで複数指定可）
  Slack Webhook URL         Slackへの通知URL（空欄で無効）

  ── トリガー設定 ──

  「トリガーを設定」ボタンで以下の自動処理スケジュールが設定されます。
  ※ 初回に一度だけ実行してください。

  タイミング        処理内容
  ──────────────────────────────────
  毎日 8:00         自動マッチング＆自動消込
  毎日 17:00        督促前チェック
  毎週月曜 9:00     取引先別状況更新
  毎月1日 9:00      月次レポート生成

  ── データ管理 ──

  ・スプレッドシートを開く … 元データのスプレッドシートを直接開く
  ・日次処理を実行 ……… 自動マッチング＋自動消込＋アラート検知を手動実行
  ・全データ再読込 ……… 画面のデータをすべて再取得


==============================================================================
 16. 毎日の運用ルーティン
==============================================================================

  【朝（業務開始時）】
  1. ダッシュボードを確認
     → 未マッチ入金があれば手動マッチング
     → アラートがあれば内容を確認
  2. 銀行の入金明細を確認し、入金を登録（CSV取込が便利）

  【夕方（業務終了前）】
  1. 本日の入金がすべて登録されているか確認
  2. 督促が必要な請求がないか確認
     →「請求管理」の「督促前チェック実行」で最終確認

  【月末】
  1. 「レポート」→「今月分を生成」で月次サマリーを作成
  2. 「取引先」→「消込状況」→「状況を更新」で最新化
  3. 未消込の請求があれば取引先にフォロー

  ※ トリガーを設定済みであれば、マッチング・消込・督促チェックは
    自動で毎日実行されます。手動操作が必要なのは
    「未マッチ入金の手動マッチング」と「アラート対応」のみです。


==============================================================================
 17. よくある質問
==============================================================================

  Q. 消込が自動で行われない
  A. 以下を確認してください。
     ・入金パターン（マッチングルール）が登録されているか
     ・設定の「自動マッチング」が有効になっているか
     ・振込手数料許容額の設定が適切か（差額が大きいと自動消込されません）

  Q. 同じ取引先から複数の振込名義で入金がある
  A. 「取引先」→「マッチングルール」で、すべての名義パターンを
     同一取引先に紐づけて登録してください。

  Q. 振込手数料が引かれた金額で入金された
  A. 設定の「振込手数料許容額」以内であれば自動消込されます。
     超えている場合は手動消込で「差額理由：振込手数料」を選択してください。

  Q. 1つの入金で複数の請求を消込したい
  A. 手動消込を請求ごとに行ってください。
     入金の消込状況は「一部消込」→「消込完了」と自動で更新されます。

  Q. 誤って消込してしまった
  A. スプレッドシートの「消込履歴」シートから該当行を削除し、
     「請求データ」「入金データ」のステータスを元に戻してください。

  Q. スマホで使いたい
  A. 同じURLをスマホのブラウザで開いてください。
     右上のハンバーガーメニュー（三本線）からタブを切り替えられます。

  Q. データはどこに保存されている？
  A. すべてGoogleスプレッドシートに保存されています。
     「設定」タブの「スプレッドシートを開く」からアクセスできます。


==============================================================================
