===========================================================
  顧客別収益性分析 使い方説明書
===========================================================

【このシステムでできること】
------------------------------------------------------------
顧客ごとの売上・原価・コスト工数データを登録し、収益性を
多角的に分析するGASウェブアプリです。

主な機能:
  - 顧客マスタの登録・管理
  - 売上データ・コスト工数データの月次登録
  - 月次/年次の収益サマリー自動計算
  - ABC分析・デシル分析による顧客ランク分類
  - LTV（顧客生涯価値）分析
  - セグメント分類と戦略マトリクス
  - 担当者別ポートフォリオ分析
  - アクション管理（目標設定・進捗管理）
  - アラート通知（売上減少・休眠検知・粗利率低下）
  - ダッシュボードでKPIとグラフを一覧表示

対象のスプレッドシートに15枚のシートが連携し、
ウェブアプリから全データの登録・閲覧・分析が可能です。


===========================================================
  初期セットアップ
===========================================================

1. スプレッドシートの準備
   - 対象のGoogleスプレッドシートを開きます
   - 初回アクセス時、各シートのヘッダー行が自動生成されます
   - 以下の15シートが使用されます:
     顧客マスタ / 売上データ / コスト工数データ /
     月次収益サマリー / 年次収益サマリー / LTV分析 /
     ABC分析 / デシル分析 / セグメント分類 /
     戦略マトリクス / 担当者ポートフォリオ /
     アクション管理 / アラート設定 / アラートログ /
     ダッシュボード

2. ウェブアプリへのアクセス
   - デプロイされたウェブアプリURLをブラウザで開きます
   - PC・スマートフォン両対応（レスポンシブデザイン）
   - スマホではハンバーガーメニューからタブを切り替えます

3. データ登録の順番（推奨）
   (1) 顧客マスタを登録（顧客管理タブ）
   (2) 売上データを登録（売上登録タブ）
   (3) コスト工数データを登録（コスト登録タブ）
   (4) 分析を実行（アラートタブ「全分析実行」ボタン）


===========================================================
  Webアプリの使い方（全画面の説明）
===========================================================

------------------------------------------------------------
■ 1. ダッシュボード
------------------------------------------------------------
アプリ起動時に最初に表示される画面です。
全体の経営指標と分析結果を一覧できます。

【KPIカード（上部）】
  - 総顧客数 ... 登録されている全顧客数
  - 契約中   ... ステータスが「契約中」の顧客数
  - 年間売上 ... 当年度の売上合計
  - 平均粗利率 ... 全顧客の平均粗利率
  - 年間営業利益 ... 当年度の営業利益合計

【グラフ（中段）】
  - 顧客ランク分布 ... S/A/B/C/Dランクのドーナツグラフ
  - 月次売上・粗利推移 ... 直近12ヶ月の棒グラフ+折れ線
  - セグメント分布 ... セグメント別の円グラフ

【テーブル（下段）】
  - 優良顧客 TOP20 ... 営業利益順の上位20顧客
  - 要注意顧客 ... 粗利率低下やランクダウンした顧客
  - 最近のアラート ... 直近のアラートログ

※ グラフはChart.jsを使用しています。データが空の場合は
  「データなし」のメッセージが表示されます。


------------------------------------------------------------
■ 2. 顧客管理
------------------------------------------------------------
顧客マスタの登録・編集・検索を行います。

【フィルター】
  - 検索 ... 顧客名またはIDで絞り込み
  - ステータス ... 契約中 / 休眠 / 解約 で絞り込み
  - ランク ... S/A/B/C/D で絞り込み

【新規登録の入力項目】
  - 顧客名（必須） ... 会社名または個人名
  - 顧客名（カナ） ... フリガナ
  - 業種 ... IT / 製造 / 小売 など
  - 企業規模 ... 大企業 / 中堅 / 中小 / 個人
  - 所在地 ... 都道府県
  - 流入経路 ... 紹介 / Web / 展示会 / テレアポ / その他
  - 担当者ID ... 社内の担当者ID
  - 担当者名 ... 担当者のフルネーム
  - 初回取引日 ... 取引開始の日付
  - 契約ステータス ... 契約中 / 休眠 / 解約
  - 顧客獲得コスト（CAC） ... その顧客を獲得するために
    かかった費用（LTV/CAC比率の計算に使用）

【操作ボタン】
  - 「+ 新規登録」ボタンで登録フォームを開きます
  - テーブルの各行にある「編集」で既存データを修正
  - 「削除」でデータを削除（確認ダイアログあり）

※ 顧客IDは「C001」のように自動採番されます。


------------------------------------------------------------
■ 3. 売上登録
------------------------------------------------------------
月次の売上データを顧客ごとに登録します。

【フィルター】
  - 年月 ... 表示する対象年月を指定
  - 顧客 ... 特定の顧客で絞り込み

【登録の入力項目】
  - 年月（必須） ... YYYY-MM 形式で選択
  - 顧客（必須） ... ドロップダウンから選択
  - 商品カテゴリ ... 商品やサービスのカテゴリ名
  - 売上金額（必須） ... 該当月の売上額
  - 原価（必須） ... 該当月の原価
  - 取引件数 ... その月の取引回数
  - 担当者名 ... 担当した営業担当者名

※ 粗利額と粗利率は売上金額と原価から自動計算されます。
※ 同じ顧客・同じ月で複数回登録が可能です
  （商品カテゴリ別など）。


------------------------------------------------------------
■ 4. コスト登録
------------------------------------------------------------
顧客対応にかかったコスト・工数を月次で登録します。

【フィルター】
  - 年月 ... 表示する対象年月を指定
  - 顧客 ... 特定の顧客で絞り込み

【登録の入力項目】
  - 年月（必須） ... YYYY-MM 形式で選択
  - 顧客（必須） ... ドロップダウンから選択
  - 営業工数（時間） ... 営業活動に費やした時間
  - 営業人件費 ... 営業担当者の人件費
  - サポート工数（時間） ... サポート対応の時間
  - サポート人件費 ... サポート担当の人件費
  - 訪問回数 ... 顧客への訪問回数
  - 訪問交通費 ... 訪問にかかった交通費
  - 接待費 ... 接待関連の費用
  - 販促費 ... 販促物やキャンペーン費用
  - その他経費 ... 上記以外の経費
  - 登録者 ... データを登録した担当者名

※ コスト合計は全費目を合算して自動計算されます。


------------------------------------------------------------
■ 5. 収益分析
------------------------------------------------------------
月次・年次の収益サマリーを確認します。

【月次タブ】
  - 年月を指定して「表示」で該当月のサマリーを表示
  - 「再計算」ボタンで月次サマリーを再集計
  - 表示項目: 売上 / 粗利 / 粗利率 / コスト /
    営業利益 / 利益率 / 工数 / 時間あたり利益

【年次タブ】
  - 年度（西暦4桁）を指定して「表示」
  - 「再計算」ボタンで年次サマリーを再集計
  - 表示項目: 年間売上 / 年間粗利 / 粗利率 /
    年間コスト / 営業利益 / 利益率 / 売上順位 / ランク

※ 収益性ランクの基準:
    S: 営業利益率 20%以上 かつ 売上上位20%
    A: 営業利益率 15%以上 かつ 売上上位40%
    B: 営業利益率 10%以上
    C: 営業利益率 5%以上
    D: 上記以外


------------------------------------------------------------
■ 6. ABC分析・デシル分析
------------------------------------------------------------
売上の偏在度を分析し、顧客を分類します。

【ABC分析タブ】
  - 顧客を売上順に並べ、累計構成比で3グループに分類
    A: 累計70%まで（上位の重要顧客）
    B: 累計90%まで（中位の顧客）
    C: それ以外（下位の顧客）
  - パレート図で売上の偏りを視覚化
  - 粗利ベースのランクと総合ランクも表示
  - 前年からのランク変動（UP/DOWN/STAY）を表示

【デシル分析タブ】
  - 全顧客を売上順に10グループへ均等分割
  - グループごとの売上合計・構成比・平均粗利率を表示

【分析実行ボタン】
  - ABC分析とデシル分析を同時に再計算します
  - 年次サマリーのデータを元に集計します

※ 分析実行前に、収益分析タブで年次サマリーの
  再計算を済ませておくことを推奨します。


------------------------------------------------------------
■ 7. LTV分析
------------------------------------------------------------
顧客の生涯価値（Life Time Value）を分析します。

【表示項目】
  - 取引年数 ... 初回取引日から現在までの年数
  - 累計売上 / 累計粗利 / 累計コスト / 累計利益
  - 年平均売上 ... 累計売上 / 取引年数
  - 残存年数 ... 業界平均10年 - 取引年数（最低1年）
  - 予測LTV ... 年平均粗利 x 残存年数 + 累計利益
  - 実績LTV ... 累計営業利益
  - CAC ... 顧客獲得コスト（顧客マスタで設定した値）
  - LTV/CAC比率 ... 予測LTV / CAC（3以上が理想）

【LTVランク】
  - S: LTV/CAC 5以上
  - A: LTV/CAC 3以上
  - B: LTV/CAC 2以上
  - C: LTV/CAC 1以上
  - D: LTV/CAC 1未満 または CAC未設定

【LTV再計算ボタン】
  - 全顧客のLTVを一括で再計算します


------------------------------------------------------------
■ 8. セグメント分類
------------------------------------------------------------
顧客を特性に応じてセグメントに分類します。

【分類一覧タブ】
  - 各顧客の評価軸（売上規模/粗利率/成長性/
    取引頻度/工数効率）とセグメント名を表示
  - 推奨戦略と優先度も表示

【戦略マトリクスタブ】
  - セグメントごとの定義・顧客数・売上構成比・
    粗利構成比・推奨アクション・投資優先度・KPI目標

【担当者別タブ】
  - 担当者ごとの顧客ポートフォリオを分析
  - 担当顧客数 / 売上合計 / 粗利率 / ランク別顧客数
  - ポートフォリオバランス評価と改善提案を表示

【再分類ボタン】
  - セグメント分類・戦略マトリクス・担当者ポートフォリオ
    を一括で再計算します


------------------------------------------------------------
■ 9. アクション管理
------------------------------------------------------------
顧客ごとの改善アクションを管理します。

【フィルター】
  - ステータスで絞り込み: 未着手 / 進行中 / 完了

【登録の入力項目】
  - 顧客（必須） ... ドロップダウンから選択
  - 現在ランク ... 現在のS/A/B/C/Dランク
  - 目標ランク ... 目指すランク
  - 推奨アクション ... 例: 訪問頻度を増やす
  - 具体的施策 ... 詳細な施策内容を自由記述
  - 担当者 ... アクションの担当者名
  - 期限 ... 達成目標の日付
  - ステータス ... 未着手 / 進行中 / 完了

※ アクションはセグメント分析の推奨戦略を参考に
  設定すると効果的です。


------------------------------------------------------------
■ 10. アラート管理
------------------------------------------------------------
異常値や変動を自動検知し、メール通知する機能です。

【設定タブ】
  アラート条件の一覧が表示されます。
  デフォルトで以下のアラートが設定済みです:
  - 売上減少アラート（前月比30%以上減少）
  - 休眠アラート（3ヶ月以上取引なし）
  - 粗利率低下アラート（粗利率が10%未満）

  各アラートの有効/無効を切り替えられます。

【ログタブ】
  検出されたアラートの履歴を確認できます。
  検出日 / 顧客名 / 種別 / 内容 / 担当者 / 対応状況

【全分析実行ボタン】
  以下の全処理を一括で実行します:
  1. 月次サマリー集計
  2. 年次サマリー集計
  3. ABC分析
  4. デシル分析
  5. LTV計算
  6. セグメント分類
  7. アラートチェック

  ※ データ量によっては数十秒かかる場合があります。
    処理中はローディング画面が表示されます。

【トリガー設定ボタン】
  毎日自動でアラートチェックを実行するトリガーを
  設定します。検出時はメールで通知されます。


===========================================================
  運用のポイント
===========================================================

1. データ登録の流れ
   毎月の運用サイクル:
   (1) 売上データを登録
   (2) コスト工数データを登録
   (3)「全分析実行」で一括分析
   (4) ダッシュボードで確認
   (5) アクションを見直し・更新

2. 分析の推奨実行順
   手動で個別に実行する場合:
   月次再計算 → 年次再計算 → ABC/デシル分析 →
   LTV再計算 → セグメント再分類

3. CAC（顧客獲得コスト）の設定
   顧客マスタ編集で「顧客獲得コスト」を入力すると
   LTV/CAC比率が計算されます。
   一般的にLTV/CAC比率が3以上であれば健全とされます。

4. 休眠検知
   3ヶ月以上取引のない顧客は自動で「休眠」ステータスに
   変更候補としてアラートが発生します。

5. スマートフォンでの利用
   - 画面左上のハンバーガーメニューからタブ切替
   - グラフは画面幅に合わせて自動リサイズ
   - テーブルは横スクロール対応


===========================================================
  よくある質問
===========================================================

Q: 顧客IDは自分で指定できますか？
A: いいえ。C001、C002...のように自動採番されます。

Q: 同じ顧客の同じ月に売上を複数回登録できますか？
A: はい。商品カテゴリ別など、複数行の登録が可能です。
   サマリー計算時に合算されます。

Q: 分析結果がおかしい場合は？
A:「全分析実行」ボタンで全データを再計算してください。
   元データ（売上・コスト）が正しければ結果も修正されます。

Q: アラートメールが届きません
A: アラートタブの「トリガー設定」を実行してください。
   また、アラート設定の「有効/無効」が有効になっているか
   確認してください。

Q: データを間違えて登録してしまいました
A: 各テーブルの「編集」ボタンで修正するか、
  「削除」ボタンで削除してください。
   削除後は再分析の実行を推奨します。
